'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1468:function(D,L,c){c.r(L);c.d(L,"RtcUtils",function(){return k});D=c(0);var l=c(8),e=c(1498),a=c(33);class k{static F_e(m,w=e.RealtimeChannel.lEf){let v;try{v=a.c(m)}catch(r){throw m=String.format("Failed to JSON-serialize payload : {0}",r),l.ULS.sendTraceTag(18637072,500,10,m),Error.argument("payload",m);}if(v.length>w)throw m=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,w),l.ULS.sendTraceTag(18637074,
500,10,m),Error.argument("payload",m);return v}static deserialize(m,w,v){if(!m)return null;if(Object.getType(m)!==String){var r=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",w,Object.getType(m).getName(),v);l.ULS.sendTraceTag(18637075,500,10,r);return null}r=null;try{r=a.a(m)}catch(z){m=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",w,z,v),l.ULS.sendTraceTag(18637077,
500,10,m)}return r}static xbc(m){if(!m)return"";if("string"===typeof m)return m.toString();try{return a.c(m)}catch(w){return m.toString()}}static rfl(m){let w,v,r;w=0;r=v=null;if(!m)return{mbi:w,obi:v,exception:r};try{const z=m.source;z&&Object.getType(z)===String&&(r=z);const A=m.context;A&&(m=A,w=m.status?m.status:0,v=m.statusText?m.statusText:null)}catch(z){}return{mbi:w,obi:v,exception:r}}}Object(D.a)(k,"RtcUtils",null,[])},1487:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(52),a=c(77),k;(function(r){r[r.SendNotification=
0]="SendNotification";r[r.SendPersistentState=1]="SendPersistentState";r[r.FindSession=2]="FindSession";r[r.Last=3]="Last"})(k||(k={}));Object(D.b)("ApiType",k);var m;(function(r){r[r.AttemptCount=0]="AttemptCount";r[r.SuccessCount=1]="SuccessCount";r[r.DropCount=2]="DropCount";r[r.FailedCount=3]="FailedCount";r[r.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";r[r.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";r[r.ThrottledCount=6]="ThrottledCount";r[r.Last=7]="Last"})(m||(m=
{}));Object(D.b)("EventCountType",m);var w=c(1577);c.d(L,"FrequentLoggingMetrics",function(){return v});class v{constructor(r){this.Svh=this.WNh=null;this.cxi=this.JQh=0;this.Ft=null;this.yVg=this.WCe=0;this.rg=r;this.Xdm();this.Jte=this.BKg=this.GDe=!1;this.Gtc=0}get Iel(){return this.Jte}Yeo(r){this.yVg=r;window.setInterval(Object(e.a)(this,this.FCf,"logMetricsBatchAndReset"),r);this.WCe=(new Date).getTime()}hO(r,z){this.a5n(r)&&!this.BKg||this.Iel||!window.navigator.onLine||this.rg.ePa||(this.Ft[r][z]++,
this.GDe=!0)}Xdm(){this.Ft=Array(3);for(let r=0;3>r;r++){this.Ft[r]=Array(7);for(let z=0;7>z;z++)this.Ft[r][z]=0}}ovk(){const r={};for(let z=0;3>z;z++)for(let A=0;7>A;A++)this.Jym(z,A)&&(r[k[z]+m[A]]=this.Ft[z][A]);r.FSDomain=this.WNh;r.ConnectionDomain=this.Svh;r.FSRetryInterval=this.JQh;r.MaxPayloadSize=this.cxi;r.LogNumber=this.Gtc;1===this.Gtc&&(r.FSLatencies=w.a.instance.ICl(),r.ConLatencies=w.a.instance.txl());return r}Jym(r,z){return 2===r&&3!==z&&0!==z?!1:!0}a5n(r){return 2===r?!1:!0}FCf(){if(this.GDe){this.Gtc++;
if((new Date).getTime()-this.WCe<5E3+this.yVg){var r=a.a.toJSON(this.ovk());l.ULS.sendTraceTag(50644352,500,15,r)}this.WCe=(new Date).getTime();for(r=0;3>r;r++)for(let z=0;7>z;z++)this.Ft[r][z]=0;this.GDe=!1}}WQm(){this.BKg=!0}static get instance(){return v._instance}static create(r){v.instance||(v._instance=new v(r));return v.instance}}v._instance=null;Object(D.a)(v,"FrequentLoggingMetrics",null,[876])},1498:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(52),a=c(438),k=c(871),m=c(85),w=c(2);class v{constructor(sa,
fa){this.status=sa;this.B$b=fa}}Object(D.a)(v,"UserStatusInfo",null,[]);var r=c(46),z=c(1577);class A{constructor(sa,fa){this.data=sa;this.timeStamp=fa}}Object(D.a)(A,"PresenceData",null,[]);class G{constructor(sa){this.AAa=!1;this.Bwb=0;this.Lpe=!1;this.setTimeout=G.e7e;this.clearTimeout=G.X6e;this.rOm=Object(e.a)(this,this.dNm,"logRtcConnectingUsageStatement");this.qw=sa}p2m(){this.AAa||(this.Bwb=this.setTimeout(()=>{this.AAa=!1;this.sui()},8E3),this.AAa=!0,this.Lpe=!1)}g3m(){this.uZ()}I9m(){this.sui()}sui(){this.uZ();
this.Lpe||(this.Lpe=!0,this.rOm())}dNm(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.qw)}uZ(){this.AAa&&this.clearTimeout(this.Bwb);this.Bwb=0;this.AAa=!1}static e7e(sa,fa){return window.setTimeout(sa,fa)}static X6e(sa){window.clearTimeout(sa)}}Object(D.a)(G,"ConnectedUsageKpiLogger",null,[892]);class H{constructor(){this.PRi=this.rVf;this.SRi=this.uVf;this.RRi=this.tVf;this.WRi=this.xVf;this.VRi=this.wVf;this.HVf=this.IVf;this.v_c=this.FVf;this.AKb=
this.DVf;this.BKb=this.EVf;this.QRi=this.sVf;this.hQa=this.jIf;this.dkb=this.kIf}rVf(){}uVf(){}tVf(){}xVf(){}wVf(){}FVf(){}EVf(){}DVf(){}IVf(){}sVf(){}jIf(){}kIf(){}}Object(D.a)(H,"NoopRealtimeChannelMetrics",null,[884,225]);class I{}I.n7c="presenceUpdated";I.updateNotification="updateNotification";I.QLi="persistentStateCleared";I.updatePersistentState="persistentStateUpdated";Object(D.a)(I,"RtcClientMethodNames",null,[]);class K{}K.P9l="realtimeChannelHub";K.n7c="UpdatePresence";K.vO="SendUpdateNotification";
K.bhf="GetCompletePersistentStateWithMetadata";K.updatePersistentState="UpdatePersistentState";K.Gob="UpdateClientInfo";Object(D.a)(K,"RtcHubMethodNames",null,[]);class F{constructor(sa){this.Hv=sa}MAn(sa){this.Hv.on(I.n7c,sa)}FBn(sa){this.Hv.on(I.updateNotification,sa)}LAn(sa){this.Hv.on(I.updatePersistentState,sa)}KAn(sa){this.Hv.on(I.QLi,sa)}guo(sa){this.Hv.off(I.n7c,sa)}quo(sa){this.Hv.off(I.updateNotification,sa)}fuo(sa){this.Hv.off(I.updatePersistentState,sa)}euo(sa){this.Hv.off(I.QLi,sa)}n7c(sa){return this.Hv.invoke(K.n7c,
sa)}Gob(sa){return this.Hv.invoke(K.Gob,sa)}vO(sa,fa){return this.Hv.invoke(K.vO,sa,fa)}bhf(sa){return this.Hv.invoke(K.bhf,sa)}updatePersistentState(sa,fa){return this.Hv.invoke(K.updatePersistentState,sa,fa)}}Object(D.a)(F,"RealtimeChannelProxy",null,[889,890,891]);class J{constructor(){this.mne=this.GBg=!1;this.kne=0;this.$oe=this.zLe=this.yLe=this.nme=!1;this.kue=0;this.I3g=!1;this.H3g=this.G3g=0;this.UJe=!1;this.aKe=this.ZJe=this.cKe=this.VJe=0;this.$Je=!1}get hqk(){return this.mne}get gqk(){return this.kne}get Rik(){return this.nme}get C6n(){return this.yLe}get D6n(){return this.zLe}get SGk(){return this.$oe}get cHd(){return this.kue}get eOn(){return this.I3g}get b0i(){return this.G3g}get dOn(){return this.H3g}get $Nn(){return this.UJe}get aOn(){return this.VJe}get h0i(){return this.cKe}get c0i(){return this.ZJe}get e0i(){return this.aKe}get d0i(){return this.$Je}static createInstance(sa){const {RealtimeChannel:fa}=
c(1498);return sa?Object.assign(new J,{GBg:sa.$("AwayStatusManagerIsEnabled"),mne:sa.$("AwayStatusOneMinuteTimeoutIsEnabled"),kne:sa.pc("AwayCoauthorThresholdMs",9E5),nme:sa.$("RtcAllowCrossDomainAccessEnabled"),yLe:sa.$("ShouldLogOnContentNotification"),zLe:sa.$("ShouldLogOnHostSubscriptionNotification"),$oe:sa.$("RtcClientMetricsEnabled"),kue:sa.pc("RtcFindSessionRequestTimeoutInMS",6E4),I3g:sa.$("RtcJsClientFrequentlyLogsMetrics"),G3g:sa.pc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
H3g:sa.pc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),UJe:sa.$("RtcClientMessageTelemetryEnabled"),VJe:sa.pc("RtcClientMessageTelemetrySampleSize",5),cKe:sa.pc("RtcSendTelemetryMessageIntervalInMS",3E5),ZJe:sa.pc("RtcLogClientMessageMetricsTimeOutInMs",2E4),aKe:sa.pc("RtcMaxPayloadSizeInCharactersOverride",fa.lEf),$Je:sa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new J,{GBg:!1,mne:!1,kne:9E5,nme:!1,yLe:!1,zLe:!0,$oe:!1,kue:9E4,UJe:!1,
VJe:5,cKe:3E5,ZJe:2E4,aKe:fa.lEf,$Je:!1})}}Object(D.a)(J,"RealtimeChannelSettings",null,[888]);var N=c(1700),O=c(68),M=c(153);class T{constructor(sa){this.Uyc=null;this.HRa=0;this.iBb=!1;this.Fm=sa;this.Fm.Esa(Object(e.a)(this,this.Tga,"onConnectionStateChanged"))}Tga(sa,fa){this.HRa=fa.newState}m$m(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Fm.e7d()}wcm(sa){this.Uyc.init(sa)}}Object(D.a)(T,"ARtcMessageHandler",null,[]);var R=c(1127);class W{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(D.a)(W,"PresenceDataEntryForClients",null,[]);var V=c(77);class ba{constructor(sa,fa=""){this.d1j=sa;this.zra=fa}send(){return this.d1j()}get messageId(){return this.zra}}Object(D.a)(ba,"MessageHandler",null,[900]);var ha=c(1603);class ca extends Sys.EventArgs{constructor(sa,fa,Ma,Ua){super();this.HYf=sa;this.reconnectDelay=fa;this.reason=Ma;this.L0f=Ua}}Object(D.a)(ca,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ia=c(1654);class ra{constructor(){this.TMe=this.Fi=
null}get vi(){return this.Fi?this.TMe?this.TMe.getTime()-this.Fi.getTime():(new Date).getTime()-this.Fi.getTime():0}start(){this.Fi=new Date}stop(){this.TMe=new Date}}Object(D.a)(ra,"SimpleStopwatch",null,[]);var da=c(1656),za;(function(sa){sa[sa.contentUpdate=0]="contentUpdate";sa[sa.editorsTableUpdate=1]="editorsTableUpdate";sa[sa.fileNameUpdate=2]="fileNameUpdate";sa[sa.wetContentUpdate=3]="wetContentUpdate";sa[sa.persistedContentUpdate=4]="persistedContentUpdate";sa[sa.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";sa[sa.replicationTelemetry=6]="replicationTelemetry";sa[sa.lockUpdate=7]="lockUpdate";sa[sa.collabServiceContentUpdate=8]="collabServiceContentUpdate";sa[sa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";sa[sa.saveTargetUpdate=10]="saveTargetUpdate";sa[sa.uploadToOcsUpdate=11]="uploadToOcsUpdate";sa[sa.labelUpdate=12]="labelUpdate";sa[sa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";sa[sa.subscribeOrExtend=14]="subscribeOrExtend";
sa[sa.elapsedBootTelemetry=15]="elapsedBootTelemetry";sa[sa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";sa[sa.clientToClientResponseMessage=17]="clientToClientResponseMessage";sa[sa.verifyNotificationPipeline=18]="verifyNotificationPipeline";sa[sa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";sa[sa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";sa[sa.last=21]="last"})(za||(za={}));Object(D.b)("UpdateNotificationType",za);var la=c(1655),na=c(810),Ca=c(811);
class Na extends T{constructor(sa,fa,Ma,Ua,Qa,Ja,Wa,Ya,sb,ob){super(Wa);this.Hv=null;this.pVg=!1;this.zra=0;this.bHe=new M.a;this.WSj=Na.Xxl();this.eGe=w.AFrameworkApplication.K.lb("OwningFeatureCrewForRtcNotificationKpis");this.Pd=sa;this.VXg=this.UXg=0;this.Uyc=fa;this.Uyc.ivd(Object(e.a)(this,this.m$m,"onTooManyUndeliveredMessages"));this._clientId=Ma;this.NZj=Qa;this.Fm.sgk(Object(e.a)(this,this.T7m,"onRefreshProxyRequired"));this.Fm.qgk(Object(e.a)(this,this.R7m,"onRefreshAllPersistentStateRequest"));
this.Fm.zgk(Object(e.a)(this,this.vO,"sendUpdateNotification"));this.Fm.zek(Object(e.a)(this,this.p5m,"onInternalPresenceUpdated"));this.Fm.Aek(Object(e.a)(this,this.q5m,"onInternalUpdateNotificationReceived"));this.Fm.yek(Object(e.a)(this,this.o5m,"onInternalPersistentStateUpdated"));this.Fm.xek(Object(e.a)(this,this.n5m,"onInternalPersistentStateCleared"));this.Fm.ygk(Object(e.a)(this,this.Pfc,"sendPersistentState"));this.Fm.Ogk(Object(e.a)(this,this.Gob,"updateClientInfo"));this.je=Ja;this.qw=
Ua;this.Ft=Ya;this.tV=sb;this.cuc=ob;this.nqa=Object(O.a)(String,w.AFrameworkApplication.sessionStartInfoSettings.Application)||""}T7m(sa,fa){this.Hv=this.NZj(fa.hubConnection);this.Uyc.reset();this.Hv.MAn(Object(e.a)(this,this.Q3,"onPresenceUpdated"));this.Hv.LAn(Object(e.a)(this,this.vQa,"onPersistentStateUpdated"));this.Hv.KAn(Object(e.a)(this,this.Wbc,"onPersistentStateCleared"));this.Hv.FBn(Object(e.a)(this,this.Dba,"onUpdateNotificationReceived"))}Tga(sa,fa){this.HRa=fa.newState;2===fa.newState&&
this.sTn()}sTn(){for(let sa of this.bHe)this.vO(null,new ia.a(sa.key,sa.value,!1,new a.a));this.bHe=new M.a}R7m(sa,fa){fa.l0e();for(sa=0;3>sa;++sa)this.YSn(sa,fa)}YSn(sa,fa){try{this.Hv.bhf(sa).done(Ma=>{fa.mkc(fa.h2e,"GetCompletePresenceSuccess")&&(fa.sMk.I9m(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.qw),this.Fm.hsn(),this.f7m(sa,Ma),this.Fm.yrn(Ma),fa.CLh.ub(sa)&&this.Fm.TQi(sa,fa.CLh.J(sa),new a.a))}).fail(Ma=>{const {RtcUtils:Ua}=c(1468);
fa.mkc(fa.h2e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",Ua.xbc(Ma),this.qw),this.Fm.e7d())}).always(()=>{fa.ry&&fa.ry.stop()})}catch(Ma){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",fa.h2e,Ma.message)}}Pfc(sa,fa){var {RtcUtils:Ma}=c(1468);sa=fa.presence;let Ua;const Qa=
fa.e6a;this.tV.hO(1,0);try{Ua=Ma.F_e(sa,this.cuc)}catch(Wa){this.tV.hO(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Wa.message);Qa.setException(Wa);return}Ma=new m.a;Ma.Z(this._clientId,Object.assign(new W,{Presence:sa,TimeStamp:(new Date).getTime()}));this.Fm.$Qi(fa.type,Ma);if(2!==this.HRa)this.Ft.AKb(),this.tV.hO(1,2),Qa.Cg(null);else{var Ja=this.zra.toString();++this.zra;sa=new ba(()=>this.uTn(fa.type,Ua,Ja),Ja);sa=this.Xhj(0,
fa.type).add(sa);sa.p1d(Wa=>{2===Wa&&this.tV.hO(1,6);Qa.Cg(null)});sa.o1d(()=>{})}}uTn(sa,fa,Ma){let Ua=null;const Qa=new ra,Ja=new ha.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.qw);if(2!==this.HRa)return this.Ft.AKb(),this.tV.hO(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.qw),Ja.WDf(),Ja;this.je&&20>this.UXg&&(Ua=this.je.jg("WebServiceCall","Send Presence Message"),this.UXg++);Qa.start();Ja.GUc(1);try{this.Hv.updatePersistentState(sa,
fa).done(()=>{this.Ft.v_c();this.tV.hO(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ma,this.qw);Ja.Njb(1);Qa&&(Qa.stop(),Qa.vi>this.Pd.b0i?this.tV.hO(1,4):this.tV.hO(1,5))}).fail(Wa=>{const {RtcUtils:Ya}=c(1468);this.iBb||(this.Ft.AKb(),this.tV.hO(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ma,Ya.xbc(Wa),this.qw));Ja.Njb(2)}).always(()=>{Ua&&Ua.stop()})}catch(Wa){l.ULS.sendTraceTag(593072906,
500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Wa.message),this.tV.hO(1,3),Ja.Njb(2)}return Ja}Gob(sa,fa){({RtcUtils:sa}=c(1468));const Ma=fa.RGk,Ua=fa.e6a;let Qa;try{Qa=sa.F_e(Ma,this.cuc)}catch(Ja){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Ja.message);Ua.setException(Ja);return}try{this.Hv.Gob(Qa).done(()=>{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(Ja=>{const {RtcUtils:Wa}=
c(1468);this.iBb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Wa.xbc(Ja));Ua.Cg(null)})}catch(Ja){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",Ja.message),Ua.Cg(null)}}vO(sa,fa){({RtcUtils:sa}=c(1468));const Ma=fa.type,Ua=fa.FM,Qa=fa.p2k,Ja=fa.e6a;let Wa;this.tV.hO(0,0);try{Wa=sa.F_e(Ua,this.cuc)}catch(sb){this.tV.hO(0,3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
sb.message);Ja.setException(sb);return}if(2!==this.HRa)Qa?this.bHe.Z(Ma,Ua):(this.Ft.AKb(),this.tV.hO(0,2)),Ja.Cg(null);else{var Ya=this.zra.toString();++this.zra;fa=new ba(()=>this.aUn(Ma,Wa,Ya),Ya);fa=this.Xhj(1,Ma).add(fa);fa.p1d(sb=>{2===sb&&this.tV.hO(0,6);Ja.Cg(null)});fa.o1d(()=>{})}}aUn(sa,fa,Ma){let Ua=null;const Qa=new ra,Ja=new ha.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.qw);if(2!==this.HRa)return this.Ft.AKb(),this.tV.hO(0,2),l.ULS.sendTraceTag(7934172,
500,15,"Connection is lost - unable to send the message for [{0}]",this.qw),Ja.WDf(),Ja;this.je&&3===sa&&20>this.VXg&&(Ua=this.je.jg("WebServiceCall","Send WetContent Update"),this.VXg++);Qa.start();Ja.GUc(1);this.Hv.vO(sa,fa).done(()=>{this.Ft.v_c();this.tV.hO(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ma,this.qw);Ja.Njb(1);Qa&&(Qa.stop(),Qa.vi>this.Pd.b0i?this.tV.hO(0,4):this.tV.hO(0,5))}).fail(Wa=>{const {RtcUtils:Ya}=c(1468);this.iBb||
(this.Ft.AKb(),this.tV.hO(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ma,Ya.xbc(Wa),this.qw));Ja.Njb(2)}).always(()=>{Ua&&Ua.stop()});return Ja}yia(){this.Hv.guo(Object(e.a)(this,this.Q3,"onPresenceUpdated"));this.Hv.fuo(Object(e.a)(this,this.vQa,"onPersistentStateUpdated"));this.Hv.euo(Object(e.a)(this,this.Wbc,"onPersistentStateCleared"));this.Hv.quo(Object(e.a)(this,this.Dba,"onUpdateNotificationReceived"))}p5m(sa,fa){this.Q3(fa.Tpa,
fa.LDd)}Q3(sa){this.Ft.BKb();this.vQa(0,sa)}o5m(sa,fa){this.vQa(fa.type,fa.Tpa)}f7m(sa,fa){const Ma={};for(let Ua in fa)Ma[Ua]=fa[Ua].Presence;this.QFi(sa,Ma,fa)}vQa(sa,fa){this.Ft.BKb();this.QFi(sa,fa)}QFi(sa,fa,Ma=null){var {RtcUtils:Ua}=c(1468);if(l.ULS.O8(500,100))for(var Qa in fa);delete fa[this._clientId];if(!V.a.isEmpty(fa)){for(var Ja in fa)Qa=Ja,fa[Qa]=Ua.deserialize(fa[Ja],"Presence",Qa,!1,this.cuc);Ua=new m.a;Ja=(new Date).getTime();for(let Wa in fa){Qa=fa[Wa];let Ya=Wa,sb;Ma?(sb=Ma[Ya],
sb.Presence=Qa):sb=Object.assign(new W,{Presence:Qa,TimeStamp:Ja});Ua.Z(Ya,sb)}this.Fm.$Qi(sa,Ua);switch(sa){case 0:this.pVg||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.qw),this.pVg=!0,w.AFrameworkApplication.Gg&&w.AFrameworkApplication.Gg.PQm());this.Fm.MQi(fa,[]);break;default:this.Fm.Zrn(sa,fa)}}}n5m(sa,fa){this.Wbc(fa.gzd)}Wbc(sa){this.Ft.BKb();if(l.ULS.O8(500,100))for(let fa=0;fa<sa.length;++fa);sa.length&&(this.Fm.wsn(sa),this.Fm.Yrn(sa),this.Fm.MQi({},
sa))}q5m(sa,fa){this.Dba(fa.type,fa.FM)}Dba(sa,fa=null){this.Pd.C6n&&0===sa&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===sa&&this.eGe&&0<this.eGe.length){var Ma=Object.assign(new la.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.eGe,vetoPillar:"RealTimeCoauth"});(Ma=R.a.getInstance(Ma))&&Ma.logKpiUsage(this.WSj)}this.Pd.D6n&&13===sa&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
fa||"<none>"));this.Ft.BKb();5===sa?(fa=(sa=this.Ten(fa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",sa.reason,sa.reconnectDelay):"Received client reconnection request from the server without params.",l.ULS.sendTraceTag(18637071,500,50,fa),this.Fm.e7d(sa)):(fa=c(1468).RtcUtils.deserialize(fa,String.format("UpdateNotification-{0}",za[sa]),null,!1,this.cuc),this.Fm.vsn(sa,fa))}Ten(sa){try{if(!sa||""===sa)return null;const fa=JSON.parse(sa);
return new ca(fa[da.a.B_f],fa[da.a.ZNn],fa[da.a.cOn],fa[da.a.L0f])}catch(fa){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",fa.message),null}}Xhj(sa,fa){return this.Uyc.fXl(this.gXl(sa,fa))}gXl(sa,fa){return sa+","+fa}static Xxl(){var sa=new Map;sa.set("SkipAria","True");sa=Object.assign(new na.a,{extendedProperties:sa});return Object.assign(new Ca.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:sa,blockFutureEmissionDurationInMs:3E5})}}
Object(D.a)(Na,"RtcMessageHandler",T,[]);class Ta{fAh(sa,fa=""){const {MaxOutstandingThrottler:Ma}=c(1651);return Ma.createInstance(sa,fa)}KUk(sa,fa=""){const {MaxRateThrottler:Ma}=c(1653);return Ma.createInstance(sa,fa)}}Object(D.a)(Ta,"ThrottlerFactory",null,[886]);var Fa=c(69),qa=c(1657);class ja{constructor(sa){this.Pd=null;this.Ah=!1;this.sa=new Fa.a;this.qDe=new m.a;this.oDe=new m.a;this.tOe=sa;this.jTb=this.tOe.fAh(fa=>fa.send(),"GlobalMaxOustandingThrottler");this.jTb.ivd(()=>{this.sa.raiseEvent("TMUDM")})}init(sa){this.Ah||
(this.Pd=sa,this.jTb.init(this.Pd.fob,this.Pd.r0l),this.Ah=!0)}fXl(sa){var {MaxRateThrottler:fa}=c(1653),{MaxOutstandingThrottler:Ma}=c(1651);this.Ah||this.init(new qa.a(fa.gDh,Ma.EDh,Ma.rDh,ja.rSm));({value:fa}=this.qDe.Gc(sa)).returnValue||(({value:fa}=this.oDe.Gc(sa)).returnValue||(fa="MaxOutstandingThrottler-"+sa,fa=this.tOe.fAh(Object(e.a)(this.jTb,this.jTb.add,"add"),fa),fa.init(this.Pd.fob,this.Pd.qSm),fa.ivd(()=>{this.sa.raiseEvent("TMUDM")}),this.oDe.add(sa,fa)),Ma="MaxRateThrottler-"+sa,
fa=this.tOe.KUk(Object(e.a)(fa,fa.add,"add"),Ma),fa.init(this.Pd.qUm),this.qDe.add(sa,fa));return fa}reset(){for(let sa of this.qDe)sa.value.GVf();for(let sa of this.oDe)sa.value.GVf(),sa.value.reset();this.jTb.GVf();this.jTb.reset()}ivd(sa){this.sa.addHandler("TMUDM",sa)}}ja.rSm=1E3;Object(D.a)(ja,"ThrottlerManager",null,[885]);var X;(function(sa){sa[sa.unspecified=0]="unspecified";sa[sa.word=1]="word";sa[sa.excel=2]="excel";sa[sa.powerPoint=3]="powerPoint";sa[sa.test=4]="test";sa[sa.wacFrontEnd=
5]="wacFrontEnd";sa[sa.oneNote=6]="oneNote";sa[sa.visio=7]="visio";sa[sa.officeMobile=8]="officeMobile";sa[sa.cosmosDBChangefeed=9]="cosmosDBChangefeed";sa[sa.last=10]="last"})(X||(X={}));Object(D.b)("RtcClientAppName",X);const ua=(sa,fa,Ma,Ua,Qa,Ja,Wa,Ya,sb=null,ob=null,fc=null,Eb=null)=>{const Ib=J.createInstance(w.AFrameworkApplication.K),Nb=w.AFrameworkApplication.buildVersion?w.AFrameworkApplication.buildVersion:"1.0",pb=Ha(sa,fa,Wa,Nb),Aa=Ib.SGk?c(1816).RealtimeChannelMetrics.createInstance(pb):
new H;var xb=c(1487).FrequentLoggingMetrics.create(Qa);Ib.eOn&&xb.Yeo(Ib.dOn);var gb="";gb=sb&&""!==sb?sb:"/rtc2/";xb.WNh=r.a.LZ(gb);const Xa=gb+"signalr";sb=gb+"findsession";const Va=K.P9l;gb=new Ta;fc=fc||N.a.getInstance();l.ULS.shipAssertTag(556867617,500,Ib.e0i<=c(1498).RealtimeChannel.dxi,"Client attempting to override max payload size beyond absolute limit");const Gb=Math.min(Ib.e0i,c(1498).RealtimeChannel.dxi);xb.cxi=Gb;xb=new Na(Ib,new ja(gb),sa,pb,Xb=>new F(Xb.createHubProxy(Va)),Ya,fc,Aa,
xb,Gb);ob||(ob=c(1704).FindSessionStrategy.createInstance(fa,Qa,sb,Ya,Nb,Wa,sa,pb,fc,Ja,Ua,Eb));ob.cHd=Ib.cHd;fa=new G(pb);Ma=Ma?Ma.split(","):null;sa=new (c(1498).RealtimeChannel)(sa,Ma,pb,Ya,()=>$.hubConnection(Xa),ob,xb,fa,fc,Aa,Ib,Qa);sa.init();return sa},Ha=(sa,fa,Ma)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",sa,Ea(X[Ma]),Ea("browser"),fa),Ea=sa=>sa?sa.charAt(0).toLocaleUpperCase()+sa.substring(1,sa.length):sa;c.d(L,"RealtimeChannel",function(){return wa});class wa{constructor(sa,
fa,Ma,Ua,Qa,Ja,Wa,Ya,sb,ob,fc,Eb){this.RMe=!1;this.c5=null;this.K1=new m.a;this.unc=1;this.$ca=null;this.El=!1;this.oBe=(new Date(0)).getTime();this.l6g=0;this._clientId=sa;this.wsd=fa;this.s9=0;this.je=Ua;this.Kpe=Ya;this.F0j=Wa;this.ICj=sb;this.OHj=Qa;this.S7a=Ja;this.qw=Ma;this.Ft=ob;this.Pd=fc;this.rg=Eb;this.J2j=1>100*Math.random()}get UPa(){return this.S7a.UPa}set UPa(sa){this.S7a.UPa=sa}get kmb(){return this.F0j}get Fm(){return this.ICj}init(){this.Fm.rgk(Object(e.a)(this,this.KDd,"disconnectAndCreateNewConnection"));
this.Fm.Rgk(Object(e.a)(this,this.H$m,"onUpdatePersistentStateRequestReceivedInternal"));this.Fm.Qgk(Object(e.a)(this,this.G$m,"onUpdatePersistentStateClearedRequestReceived"));this.rg.$Yb(this.Ft);w.AFrameworkApplication.rJ(()=>{const {FrequentLoggingMetrics:sa}=c(1487);this.Ft.HVf();sa.instance&&sa.instance.FCf()});this.xAh();this.t5k();this.Fm.Bgk(Object(e.a)(this,this.owo,"updateConnectionQueryString"))}t5k(){try{const Ma=$.signalR;if(!Ma)throw Error.invalidOperation("Failed to retrieve Signalr object");
const Ua=Ma.version;if(!Ua)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===Ua){var sa=Ma.transports;if(!sa)throw Error.invalidOperation("Failed to retrieve transports object");var fa=sa.longPolling;if(!fa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!fa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");fa.supportsKeepAlive=this.cXk()}}catch(Ma){l.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Ma.message)}}cXk(){return()=>!1}xAh(){const sa=++this.unc;this.oBe=(new Date(0)).getTime();this.$ca=this.OHj();this.Fm.esn(this.$ca);this.$ca.stateChanged(fa=>{this.t2m(fa,sa)});this.$ca.connectionSlow(Object(e.a)(this,this.B9m,"onSlowConnection"));this.$ca.error(Object(e.a)(this,this.t9m,"onSignalRError"));this.$ca.log=Object(e.a)(this,this.u9m,"onSignalRLog")}mkc(sa,fa){return sa!==this.unc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
fa),!1):!0}connect(){2!==this.s9&&1!==this.s9&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.qw),this.Kpe.p2m(),z.a.instance.Zeo(),this.Tga(1,this.s9),this.cej())}cej(){const sa=this.unc;this.RMe=!1;this.Ft.PRi();this.S7a.jSl(Object(e.a)(this,this.pMk,"connectSignalrConnection"),Object(e.a)(this,this.YDi,"onFailureToConnect"),Object(e.a)(this.kmb,this.kmb.wcm,"initThrottlerManager"),Object(e.a)(this,this.mkc,"verifyConnectionToken"),sa)}YDi(sa=null){this.Ft.RRi();
let fa=null;!sa||"documentsessiondeleted"!==(fa=sa.toLowerCase())&&"documentsessionexpired"!==fa?this.KDd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.qw,sa),this.disconnect())}KDd(sa,fa=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.c5);sa=(sa=2===this.s9||1===this.s9)&&!this.kmb.iBb;let Ma=!0,Ua=0;fa&&Object.getType(fa)!==Object.getType(Sys.EventArgs.Empty)&&
fa.HYf&&""!==fa.HYf&&(sa=!0,this.S7a.W0n(fa.HYf),Ma=fa.L0f,Ua=fa.reconnectDelay);sa&&this.Tga(1,this.s9);++this.unc;this.kmb.yia();this.kgo(Ma);this.S7a.Q6k();this.xAh();sa&&window.setTimeout(Object(e.a)(this,this.cej,"startConnecting"),Math.min(Ua,3E4))}owo(){let sa=null;const fa=({correlationId:sa}=this.S7a.UWh()).returnValue;this.$ca.qs=fa;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.qw,sa)}pMk(sa){const {FrequentLoggingMetrics:fa}=
c(1487);this.oBe=(new Date).getTime();let Ma=null;this.$ca.qs=({correlationId:Ma}=this.S7a.UWh()).returnValue;this.Pd.Rik&&(this.$ca.url=sa,fa.instance&&(fa.instance.Svh=r.a.LZ(sa)));let Ua=null;this.je&&(Ua=this.je.jg("WebServiceCall","ConnectToServer"));l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.qw);sa={};this.wsd&&(sa.transport=1===this.wsd.length?this.wsd[0]:this.wsd);sa.pingInterval=null;z.a.instance.u_c(1,0);sa.waitForPageLoad=!1;this.$ca.start(sa,null).done(Qa=>
{this.Ft.SRi();z.a.instance.u_c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Qa.id,Ma)}).fail(Qa=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.S7a.AW,Ma,this.qw);this.YDi();this.Ft.QRi(Qa);z.a.instance.u_c(1,1,!1);this.Fm.QQi(0,{["CorrelationId"]:Ma,["ErrorDetails"]:Qa,["ConnectionState"]:k.a[this.s9]})}).always(()=>{const {FrequentLoggingMetrics:Qa}=
c(1487);Ua&&Ua.stop();Qa.instance&&(Qa.instance.Jte=!1)})}disconnect(){const {FrequentLoggingMetrics:sa}=c(1487);0===this.s9?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.qw):(this.Ft.VRi(),sa.instance&&(sa.instance.Jte=!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.qw),this.kmb.iBb=!0,this.Kpe.g3m(),this.Tga(0,this.s9),this.KDd(),this.kmb.iBb=!1)}kgo(sa){const fa=this.qzk(),Ma=this.$ca,Ua=this.c5,
Qa=()=>{if(this.RMe)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.RMe=!0,Ma.stop(!0,sa)}catch(Ja){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",Ja.message)}};0<fa?(l.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Ua,fa),window.setTimeout(Qa,fa)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Ua),Qa())}qzk(){let sa=0;0===this.$ca.state&&(sa=this.oBe+wa.TFo-
(new Date).getTime(),0>sa&&(sa=0));return sa}get connectionState(){return this.s9}Esa(sa){this.Fm.Esa(sa)}vec(sa){this.Fm.vec(sa)}t3i(sa){this.Pfc(0,sa)}Pfc(sa,fa){const Ma=new a.a;this.Fm.TQi(sa,fa,Ma);return Ma.task}RXa(sa){this.Fm.RXa(sa)}TKb(sa){this.Fm.TKb(sa)}IAc(sa){this.Fm.IAc(sa)}s0c(sa){this.Fm.s0c(sa)}hvd(sa){this.Fm.hvd(sa)}o8d(sa){this.Fm.o8d(sa)}IMc(sa){return this.cZl(sa)}RBb(){return this.PJc(0)}PJc(sa){const fa={};for(let Ma of this.K1)Ma.value.ub(sa)&&(fa[Ma.key]=Ma.value.J(sa).data);
return fa}cZl(sa){return this.K1.ub(sa)&&this.K1.J(sa).ub(0)?this.K1.J(sa).J(0).data:null}H$m(sa,fa){for(let Ma of fa.YBo)this.K1.ub(Ma.key)||this.K1.Z(Ma.key,new M.a),sa=Ma.value,this.K1.J(Ma.key).Z(fa.type,new A(sa.Presence,new Date(sa.TimeStamp))),Ma.key===this._clientId&&0===fa.type&&this.Fm.Krn(sa.Presence)}G$m(sa,fa){for(const Ma of fa.gzd)this.K1.remove(Ma)}bsl(){const sa=new M.a;if(!this.K1.ub(this._clientId))return sa;for(let fa of this.K1.J(this._clientId))sa.Z(fa.key,fa.value.data);return sa}vO(sa,
fa=null,Ma=!1){const Ua=new a.a;this.Fm.QUf(sa,fa,Ma,Ua);return Ua.task}f6(sa){this.Fm.f6(sa)}zec(sa){this.Fm.zec(sa)}Pgb(sa){let fa,Ma;return({value:fa}=this.K1.Gc(sa)).returnValue&&({value:Ma}=fa.Gc(0)).returnValue?new v(this.hZl(Ma),Ma.timeStamp):null}SJc(){const sa={};for(let fa of this.K1)fa.value.Gc(0).returnValue&&(sa[fa.key]=this.Pgb(fa.key));return sa}Gob(sa){const fa=new a.a;this.Fm.ZQi(sa,fa);return fa.task}get clientId(){return this._clientId}get qbo(){return this.J2j}dispose(){const {FrequentLoggingMetrics:sa}=
c(1487);this.El||(this.kmb.yia(),this.rg.f8d(this.Ft),this.Ft.HVf(),sa.instance&&sa.instance.FCf(),this.El=!0)}t2m(sa,fa){this.mkc(fa,"StateChangedSignalR")&&this.Tga(this.Bxh(sa.newState),this.Bxh(sa.oldState))}Tga(sa,fa){var {FrequentLoggingMetrics:Ma}=c(1487),{ClientToClientMessageTelemetry:Ua}=c(1716);if((1!==this.s9||0!==fa||1!==sa)&&this.s9!==fa){const Qa=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.s9,
fa,sa]));l.ULS.sendTraceTag(3290053,500,10,Qa)}if(this.s9!==sa){switch(sa){case 2:Ma.instance&&Ma.instance.WQm();this.c5=this.$ca.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.c5,this.qw);this.VNm(this.$ca);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ma=null;this.je&&(Ma=this.je.jg("WebServiceCall","Receive First Presence"));Ua=this.unc;this.Fm.dsn(Object(e.a)(this,this.mkc,"verifyConnectionToken"),Ua,this.Kpe,Object(e.a)(this,
this.l0e,"clearExistingPersistentState"),this.bsl(),Ma);this.Pd.$Nn&&(Ma=100*Math.random()<=this.Pd.aOn,c(1716).ClientToClientMessageTelemetry.t5b(this.Fm,this.Pd,Ma).start());break;case 1:2===fa&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.c5);break;case 0:if(Ua.instance&&Ua.instance.stop(),this.kmb.iBb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.c5);else{1===fa&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.c5),this.Ft.WRi());2===fa&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.c5);this.KDd();return}}this.s9=sa;this.Fm.lrn(sa,fa)}}VNm(sa){if(sa&&sa.transport&&sa.transport.name){sa=sa.transport.name;var fa=sa.toLowerCase();
"websockets"===fa?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",sa,this.qw):"serversentevents"===fa?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",sa,this.qw):"foreverframe"===fa?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",sa,this.qw):"longpolling"===fa?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",sa,this.qw):"mocktransport"!==fa&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
sa)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}B9m(){if(this.Pd.d0i){const sa=r.a.rT(this.UPa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.c5,sa)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.c5)}t9m(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.c5)}u9m(sa){sa=c(1468).RtcUtils.xbc(sa);if(this.Pd.d0i&&sa.startsWith("Keep alive timed out.")){const fa=
r.a.rT(this.UPa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",sa,fa)}else this.qbo&&2E3>this.l6g&&!sa.startsWith("Invok")&&!sa.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",sa),this.l6g++)}l0e(){let sa;const fa=[];({value:sa}=this.K1.Gc(this._clientId)).returnValue&&this.K1.remove(this._clientId);for(let Ma of this.K1.keys)Array.add(fa,Ma);for(const Ma of fa)this.K1.remove(Ma);sa&&this.K1.Z(this._clientId,sa);this.Fm.Ern(fa)}Bxh(sa){switch(sa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",sa,"Unknown SignalR state");}}hZl(sa){return sa&&sa.timeStamp?(new Date).getTime()-sa.timeStamp.getTime()>(this.Pd.hqk?6E4:this.Pd.gqk)?2:1:1}static createInstance(sa,fa,Ma,Ua,Qa,Ja,Wa,Ya=null,sb=null,ob=null,fc=null,Eb=null,Ib=null){return ua(sa,fa,Ma,Ib,Ua,Qa,Ja,Wa,Ya,sb,ob,Eb,fc)}}wa.dxi=31E3;wa.lEf=8E3;wa.TFo=15E3;Object(D.a)(wa,"RealtimeChannel",null,[859,860])},1577:function(D,L,c){c.d(L,"a",function(){return l});
D=c(0);class l{constructor(){this.p7g=!1;this.avb=null;this.UFg=0;this.iue=this.JBh();this.cbd=this.JBh();this.tqb=this.cTb=0;this.hr=()=>new Date}get oho(){return this.p7g}JBh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}ICl(){return this.iue.toString()}txl(){return this.cbd.toString()}Zeo(){this.avb=this.hr()}u_c(e,a,k=!1){this.oho||(k&&(this.p7g=!0),k=this.hr(),0===e&&5<this.cTb||1===e&&5<this.tqb||(this.UFg<e?(1===this.cTb%2&&(this.iue[this.cTb]=-1,this.cTb++),this.UFg=e,1===
a&&(this.cbd[this.tqb]=-1,this.tqb++),this.cbd[this.tqb]=this.U7f(k),this.tqb++):0===e?(this.iue[this.cTb]=this.U7f(k),this.cTb++):(this.cbd[this.tqb]=this.U7f(k),this.tqb++)))}U7f(e){const a=e.getTime()-this.avb.getTime();this.avb=e;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(e){l._instance=e}}l._instance=null;Object(D.a)(l,"LatencyMetrics",null,[])},1603:function(D,L,c){D=c(0);class l{constructor(){this.QCg=this.Epe=!1;this.callback=null}AWc(a){this.callback=
a;this.bkj()}xwi(a){this.Epe||(this.Epe=!0,this.GHj=a,this.bkj())}bkj(){this.Epe&&this.callback&&!this.QCg&&(this.QCg=!0,this.callback(this.GHj))}}Object(D.a)(l,"CompletionTask",null,[]);c.d(L,"a",function(){return e});class e{constructor(){this.vWg=new l;this.tWg=new l}p1d(a){this.vWg.AWc(a)}o1d(a){this.tWg.AWc(a)}GUc(a){this.vWg.xwi(a)}Njb(a){this.tWg.xwi(a)}WDf(){this.GUc(2);this.Njb(2)}}Object(D.a)(e,"MessageStatus",null,[899])},1651:function(D,L,c){c.r(L);c.d(L,"MaxOutstandingThrottler",function(){return k});
D=c(0);var l=c(52),e=c(69);L=c(1652);var a=c(1603);class k extends L.a{constructor(m,w=""){super(m,w);this.Aac=this.fob=0;this.sa=new e.a;this.fUb=!1;this.Qkd=this.Dbd=this.dbd=this.sOe=0;this.a2=[];this.clearTimeout=k.X6e}add(m){this.gUb||this.init(k.EDh,k.rDh);this.Gwb++;const w=new a.a;this.b9b?this.gbe(m,w):this.Qkd<this.Aac?this.b2c(m,w):(this.gbe(m,w),this.fUb=!1);return w}b2c(m,w){m=this.H4g(m);const v=this.setTimeout(Object(l.a)(this,this.e6m,"onMessageWaitTimeExpired"),this.fob);++this.Qkd;
Array.add(this.a2,v);const r=this.dbd;m.p1d(z=>{w.GUc(z)});m.o1d(z=>{this.dbd===r&&(this.d6m(r,v),w.Njb(z))})}d6m(m,w){this.dbd===m&&(--this.Qkd,this.clearTimeout(w),Array.remove(this.a2,w),this.b9b&&this.STn())}STn(){this.b9b&&!this.fUb&&(this.sOe=this.setTimeout(Object(l.a)(this,this.TTn,"sendThrottledMessageFromTimer"),0),this.fUb=!0)}TTn(){this.fUb=!1;if(this.b9b){const m=this.Rrd,w=this.OXb;this.vDc(!1);this.b2c(m,w)}}e6m(){++this.Dbd;this.Dbd>Math.floor(this.Aac/2)&&(this.Dbd=-1E9,this.sa.raiseEvent("TMUDM"))}ivd(m){this.sa.addHandler("TMUDM",
m)}reset(){this.Gwb=this.Tyc=this.epc=this.Dbd=0;++this.dbd;for(const m of this.a2)this.clearTimeout(m);this.Qkd=0;this.a2=[];this.vDc(!0);this.fUb&&(this.clearTimeout(this.sOe),this.sOe=0,this.fUb=!1)}init(m,w){this.gUb||(this.fob=m,this.Aac=w,this.gUb=!0)}static createInstance(m,w=""){return new k(m,w)}static X6e(m){window.clearTimeout(m)}}k.EDh=15E3;k.rDh=5;Object(D.a)(k,"MaxOutstandingThrottler",L.a,[896,897])},1652:function(D,L,c){c.d(L,"a",function(){return e});D=c(0);var l=c(8);class e{constructor(a,
k=""){this.epc=this.Tyc=0;this.oze=!1;this.OXb=this.Rrd=null;this.gUb=!1;this.H4g=a;this.Yhj=k;this.setTimeout=e.e7e;this.Gwb=this.Tyc=this.epc=0}GVf(){0<this.Gwb&&0<this.epc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Yhj,this.epc,this.Gwb);0<this.Gwb&&0<this.Tyc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Yhj,this.Tyc,this.Gwb)}get b9b(){return this.oze}gbe(a,k){this.Tyc++;this.vDc(!0);this.oze=
!0;this.Rrd=a;this.OXb=k}vDc(a){this.oze=!1;this.OXb&&a&&(this.epc++,this.OXb.WDf());this.OXb=this.Rrd=null}static e7e(a,k){return window.setTimeout(a,k)}}Object(D.a)(e,"ThrottlerBase",null,[])},1653:function(D,L,c){c.r(L);c.d(L,"MaxRateThrottler",function(){return a});D=c(0);var l=c(52);L=c(1652);var e=c(1603);class a extends L.a{constructor(k,m=""){super(k,m);this.Jac=0;this.itc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.gUb||(this.Jac=k,this.gUb=!0)}add(k){this.gUb||
this.init(a.gDh);this.Gwb++;const m=this.currentTime(),w=new e.a;this.itc>m&&(this.itc=m);this.b9b?(this.vDc(!0),this.gbe(k,w)):this.itc+this.Jac<=m?this.b2c(k,w):(this.gbe(k,w),this.setTimeout(Object(l.a)(this,this.RTn,"sendThrottledMessage"),this.itc+this.Jac-m));return w}RTn(){if(this.b9b){const k=this.Rrd,m=this.OXb;this.vDc(!1);this.b2c(k,m)}}b2c(k,m){this.itc=this.currentTime();k=this.H4g(k);k.p1d(w=>{m.GUc(w)});k.o1d(w=>{m.Njb(w)})}static createInstance(k,m=""){return new a(k,m)}}a.gDh=200;
Object(D.a)(a,"MaxRateThrottler",L.a,[898,897])},1654:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a,k,m){super();this.type=e;this.FM=a;this.p2k=k;this.e6a=m}}Object(D.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1656:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l{}l.B_f="rr";l.cOn="rd";l.ZNn="rbp";l.L0f="sa";Object(D.a)(l,"RtcReconnectParams",null,[])},1657:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l{constructor(e,
a,k,m){this.qUm=e;this.fob=a;this.qSm=k;this.r0l=m}}Object(D.a)(l,"ThrottlerManagerSettings",null,[])},1700:function(D,L,c){D=c(0);class l extends Sys.EventArgs{constructor(M,T){super();this.newState=M;this.oldState=T}}Object(D.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(M,T){super();this.RGk=M;this.e6a=T}}Object(D.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(M){super();this.presence=M}}Object(D.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1818),m=c(1817),w=c(1815);class v extends Sys.EventArgs{constructor(M,T=null){super();this.nl=M;this.p6j=T}get type(){return this.nl}get FM(){return this.p6j}}Object(D.a)(v,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(){super()}}Object(D.a)(r,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(M,T,R,W,V,ba){super();this.mkc=M;this.h2e=T;this.sMk=
R;this.CLh=V;this.l0e=W;this.ry=ba}}Object(D.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class A extends Sys.EventArgs{constructor(M){super();this.hubConnection=M}}Object(D.a)(A,"RefreshProxyEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(M,T){super();this.ifa=M;this.errorMessage=T}}Object(D.a)(G,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(M,T,R){super();this.type=M;this.presence=T;this.e6a=R}}Object(D.a)(H,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var I=c(1654);class K extends Sys.EventArgs{constructor(){super()}}Object(D.a)(K,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(M){super();this.gzd=M}}Object(D.a)(F,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(M,T){super();this.type=M;this.YBo=T}}Object(D.a)(J,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var N=c(69);c.d(L,"a",function(){return O});class O{constructor(){this.sa=
new N.a}lrn(M,T){this.sa.raiseEvent("CSC",new l(M,T))}esn(M){this.sa.raiseEvent("RP",new A(M))}e7d(M){this.sa.raiseEvent("RC",M)}hsn(){this.sa.raiseEvent("RMID")}dsn(M,T,R,W,V,ba){this.sa.raiseEvent("RPS",new z(M,T,R,W,V,ba))}$Qi(M,T){this.sa.raiseEvent("UPSR",new J(M,T))}MQi(M,T){this.sa.raiseEvent("PU",new w.a(M,T))}Krn(M){this.sa.raiseEvent("MPU",new a(M))}QUf(M,T,R,W){this.sa.raiseEvent("SUN",new I.a(M,T,R,W))}vsn(M,T){this.sa.raiseEvent("UNR",new v(M,T))}TQi(M,T,R){this.sa.raiseEvent("SP",new H(M,
T,R))}Zrn(M,T){this.sa.raiseEvent("PSU",new m.a(M,T))}Yrn(M){this.sa.raiseEvent("PSC",new k.a(M))}Ern(M){this.sa.raiseEvent("IPSC",new k.a(M))}wsn(M){this.sa.raiseEvent("UPSC",new F(M))}isn(M,T){this.sa.raiseEvent("SPC",new K(M,T))}QQi(M,T){this.sa.raiseEvent("RCF",new G(M,T))}yrn(M){this.sa.raiseEvent("CPSWM",new r(M))}ZQi(M,T){this.sa.raiseEvent("UCI",new e(M,T))}Esa(M){this.sa.addHandler("CSC",M)}vec(M){this.sa.removeHandler("CSC",M)}sgk(M){this.sa.addHandler("RP",M)}rgk(M){this.sa.addHandler("RC",
M)}vgk(M){this.sa.addHandler("RMID",M)}qgk(M){this.sa.addHandler("RPS",M)}Rgk(M){this.sa.addHandler("UPSR",M)}RXa(M){this.sa.addHandler("PU",M)}TKb(M){this.sa.removeHandler("PU",M)}zek(M){this.sa.addHandler("IPU",M)}Ogk(M){this.sa.addHandler("UCI",M)}zgk(M){this.sa.addHandler("SUN",M)}Aek(M){this.sa.addHandler("IUNR",M)}f6(M){this.sa.addHandler("UNR",M)}zec(M){this.sa.removeHandler("UNR",M)}IAc(M){this.sa.addHandler("PSU",M)}s0c(M){this.sa.removeHandler("PSU",M)}yek(M){this.sa.addHandler("IPSU",M)}hvd(M){this.sa.addHandler("PSC",
M)}o8d(M){this.sa.removeHandler("PSC",M)}xek(M){this.sa.addHandler("IPSC",M)}Qgk(M){this.sa.addHandler("UPSC",M)}ygk(M){this.sa.addHandler("SP",M)}Bgk(M){this.sa.addHandler("SPC",M)}static getInstance(){return O._instance||(O._instance=new O)}}O._instance=null;Object(D.a)(O,"RtcEventHub",null,[887])},1704:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(52),a=c(82),k=c(871);class m{}m.Jac="throttling_messageDelay";m.KRc="enabled";m.fob="throttling_timeToWaitForResponse";m.Aac="throttling_maxNumberOfOutstandingMessages";
m.$7h="throttling_globalMaxNumberOfOutstandingMessages";m.errorMessage="errorMessage";m.ncj="url";m.MFa="queryString";m.AW="connectionString";Object(D.a)(m,"RtcFindSessionOutputFieldNameConstants",null,[]);var w=c(2),v=c(46),r=c(35),z=c(286),A=c(1349),G=c(77),H=c(16),I=c(119);class K{constructor(){this.a8h=this.axi=this.bxi=this.gxi=0;this.BUd=!1;this.correlationId=this.AW=this.MFa=this.i2e=this.errorMessage=null}get qLk(){return this.i2e+"?"+this.MFa}}Object(D.a)(K,"FindSessionResponse",null,[]);
var F=c(592);class J{constructor(ca,ia,ra,da,za,la){this.oWa=null;const {FindSessionStrategy:na}=c(1704);this.VZj=ca;ca=String.format("{0}={1}",F.a.clientId,H.a.Pj(da));ca=String.format("{0}&{1}={2}",ca,F.a.userSessionId,H.a.Pj(za));ca=String.format("{0}&{1}={2}",ca,F.a.vrj,H.a.Pj(ra.toString()));ca=String.format("{0}&{1}={2}",ca,F.a.userType,H.a.Pj("1"));ca=String.format("{0}&{1}={2}",ca,F.a.Grj,H.a.Pj(ia));ca=String.format("{0}&{1}={2}",ca,F.a.eth,H.a.Pj(na.TGk));(ia=J.fgf(ra,la))&&(ca=String.format("{0}&{1}",
ca,ia));this.PHj=ca}TSi(){this.oWa=this.VZj()}generate(){this.oWa&&""!==this.oWa||(this.TSi(),l.ULS.sendTraceTag(575784194,500,this.oWa&&""!==this.oWa?50:15,"Query signature delegate called for refresh returned: {0} ",this.oWa));const ca=String.format("{0}={1}",F.a.nKb,H.a.Pj(this.oWa));return String.format("{0}&{1}",ca,this.PHj)}static fgf(ca,ia){return 4===ca?String.format("{0}={1}",F.a.yAi,"1"):ia?ia.Z6h():null}}Object(D.a)(J,"FindSessionQueryStringGenerator",null,[]);var N=c(1487),O=c(1577),M=
c(1468),T=c(1657);class R{}R.Djl="FSType";Object(D.a)(R,"RtcFindSessionRequestHeaders",null,[]);class W{}W.utn="polling";Object(D.a)(W,"RtcFindSessionTypes",null,[]);var V=c(1656);class ba{}ba.LEo="RTC-TokenProofkey";ba.czm="RTC-IsWacJsBootFsRequest";Object(D.a)(ba,"RtcRequestHeaders",null,[]);c.d(L,"FindSessionStrategy",function(){return ha});class ha{constructor(ca,ia,ra,da,za,la,na,Ca,Na,Ta,Fa,qa,ja=null){this.xTg=(new Date(0)).getTime();this.EVg=0;this.Djd=!1;this.T4g=null;this.WVf=36E5;this.wRb=
ha.adi;this.Gpc=0;this.fLb=null;this.HRa=0;this.pfc=this.Uvh=null;this.V_j=[m.KRc,m.errorMessage,m.ncj,m.AW,m.MFa,m.$7h,m.Aac,m.fob,m.Jac];this.U_j=[m.KRc,m.errorMessage];this.AW=this.UPa=null;this.tKg=new J(Fa?Fa:()=>w.AFrameworkApplication.Gm,za,la,na,ca,ia);this.Omc=qa;this.je=da;this.rg=ia;this.mue=ra;this.qw=Ca;this.Fm=Na;this.$pc=ja;this.uKg=!1;this.cHd=9E4;Ta&&Ta.execute(X=>{X.PXa(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.qw);this.tKg.TSi()})});
2>=100*Math.random()&&(this.WVf=3E5);N.FrequentLoggingMetrics.instance&&(N.FrequentLoggingMetrics.instance.JQh=this.WVf)}W0n(ca){this.pfc=ca}init(){this.Fm.vgk(Object(e.a)(this,this.hKn,"resetGetMachineIdDelay"));this.Fm.Esa(Object(e.a)(this,this.Tga,"onConnectionStateChanged"))}Tga(ca,ia){this.HRa=ia.newState;2===ia.newState&&(this.Gpc=0)}UWh(){let ca;ca=this.fLb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.fLb.MFa,ha.jyh,H.a.Pj(ca)),correlationId:ca}}jSl(ca,ia,ra,da,za){this.WSn(()=>
{da(za,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.AW,this.qw),ca(this.T4g),ra(this.hXl()))},la=>{da(za,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.qw),ia(la))},da,za)}Q6k(){this.Ish();this.Sam()}WSn(ca,ia,ra,da){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.AW);if(this.AW)ca();
else{var za=this.vyk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(ca,ia,ra,da)},za)}}sendFindSessionRequestToServerInternal(ca,ia,ra,da){ra(da,"RequestMachineId")&&(this.xTg=(new Date).getTime(),ra=r.a.Ye(),this.XJd(za=>{const la=r.a.Ye();this.FKi(za);this.I2f();ca();za=r.a.Ye()-la;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",za)},za=>{const la=r.a.Ye();this.Ish();N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.hO(2,3);ia(za);
za=r.a.Ye()-la;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",za)},!1),ra=r.a.Ye()-ra,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ra))}Sam(){this.wRb+=ha.qJl;this.wRb=Math.min(this.wRb,ha.aSm)}vyk(){var ca=(new Date).getTime();ca=this.xTg+this.wRb-ca;0>ca&&(ca=0);return ca}FKi(ca){try{this.fLb=ca,this.UPa=ca.qLk,this.AW=ca.AW,this.Uvh=ca.MFa,this.T4g=ca.i2e}catch(ia){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ia.toString())}}Ish(){this.AW=null;this.Jsh()}I2f(){this.Jsh();this.Djd=!0;this.EVg=window.setTimeout(Object(e.a)(this,this.Cxn,"refreshMachineId"),this.WVf)}Jsh(){this.Djd&&(window.clearTimeout(this.EVg),this.Djd=!1)}Cxn(){this.Djd=!1;this.XJd(ca=>{const ia=this.Uvh!==ca.MFa,ra=this.AW!==ca.AW,da=this.AW;this.FKi(ca);0!==this.HRa&&(ra?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",da||"null",ca.AW),this.Fm.e7d()):(this.Fm.isn(ia,ra),
this.I2f()))},()=>{N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.hO(2,3);this.I2f()},!0)}hKn(){this.wRb=ha.adi}hXl(){return new T.a(this.fLb.gxi,this.fLb.bxi,this.fLb.axi,this.fLb.a8h)}kpo(ca){if(Object.getType(ca)!==Object)return null;for(let ia in ca);return this.aTk(ca)}aTk(ca){if(!(m.KRc in ca))return null;const ia=ca[m.KRc];var ra=ia?this.V_j:this.U_j;for(const da of ra)if(!(da in ca))return null;ra=Object.assign(new K,{BUd:ca[m.KRc],errorMessage:ca[m.errorMessage],correlationId:I.a.create().toString()});
ia&&(ra.i2e=ca[m.ncj],ra.MFa=ca[m.MFa],ra.AW=ca[m.AW],ra.a8h=ca[m.$7h],ra.axi=ca[m.Aac],ra.bxi=ca[m.fob],ra.gxi=ca[m.Jac]);return ra}JCl(ca,ia){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.$pc.XNh.continueWith(()=>{this.$pc.XNh.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),ca(this.$pc.YNh)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ia(this.$pc.YNh))})}IYi(ca,ia,
ra,da,za=!1){return la=>{O.a.instance.u_c(0,1);ca&&ca.stop();this.Omc=this.pfc=null;this.qui(la.data,!0,ia);var na=M.RtcUtils.deserialize(la.data.Ae,"FindSession",null);if(na)if(na=this.kpo(na)){if(na.BUd&&na.MFa&&na.AW){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.qw);this.PIm(la.data);ra(na);return}ia.FindSessionFailureReason="FindSessionInvalidResponse";ia.IsRtcEnabled=na.BUd;ia.IsQueryStringEmpty=!na.MFa;ia.IsConnectionStringEmpty=!na.AW;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.qw,na.BUd,!na.MFa,!na.AW)}else ia.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.qw);else ia.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.qw);this.RQi(ia,za);da(null)}}CYi(ca,ia,ra,da=!1){return za=>{O.a.instance.u_c(0,1);ca&&ca.stop();this.Omc=this.pfc=null;this.qui(za.data,!1,ia);let la=null;var na="unknown";let Ca="unknown";za.data&&((na=za.data.Bj)&&ha.z1c in na&&(la=na[ha.z1c].toString()),na=A.a[za.data.status],Ca=za.data.jf.toString());ia.FindSessionFailureReason="FindSessionRequestFailed";ia.HttpErrorCode=Ca;ia.HttpErrorStatus=na;ia[ha.z1c]=la;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
na,Ca,this.qw,la,da);this.RQi(ia,da);ra(Ca)}}XJd(ca,ia,ra=!1){let da=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.qw);const za={};var la=this.tKg.generate();za[z.a.C6]=I.a.create().toString();this.pfc&&""!==this.pfc?la=String.format("{0}&{1}={2}",la,V.a.B_f,this.pfc):this.Omc&&""!==this.Omc&&(la=String.format("{0}&{1}={2}",la,V.a.B_f,this.Omc),za[ba.LEo]="True",za[ba.czm]="True");la=this.mue+"?"+la;ra&&(za[R.Djl]=W.utn);const na={};na.IsNetworkOfflineBeforeSendRequest=
this.rg.ePa;na.HasAvailableConnectionsBeforeSendRequest=this.rg.WOd;na.MaxConnectionsAllowed=this.rg.xac;na.IsRefreshMachineId=ra;this.$pc&&!this.uKg?(this.JCl(this.IYi(null,na,ca,ia,ra),this.CYi(null,na,ia,ra)),this.uKg=!0):(this.je&&(da=this.je.jg("WebServiceCall","GetMachineIdFromTheServer")),N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.hO(2,0),0>this.rg.dZb(la,1,null,za,[ha.jBd,ha.z1c,ha.fWc,ha.A_f,ha.szi,ha.TBi,ha.SBi],1,this.IYi(da,na,ca,ia,ra),this.CYi(da,na,ia,ra),
null,!1,null,this.cHd,"3",null,!0)&&(5<this.Gpc&&200>this.Gpc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Gpc),window.setTimeout(()=>{this.Gpc++;ia("-1")},1E3)))}qui(ca,ia,ra){ra||(ra={});ra.IsNetworkOfflineAfterRequestComplete=this.rg.ePa;ra.IsRequestSucceeded=ia;ca&&(ra.EnqueueTime=ca.TMa,ra.InvokedTime=ca.oH,ra.CompletedTime=ca.FS,ca.Bj&&(ha.jBd in ca.Bj&&(ra.CorrelationId=ca.Bj[ha.jBd]),ha.fWc in
ca.Bj&&(ra[ha.fWc]=ca.Bj[ha.fWc])));l.ULS.sendTraceTag(38633565,500,ia?50:15,M.RtcUtils.xbc(ra))}RQi(ca,ia){ca||(ca={});ca.ConnectionState=k.a[this.HRa];ia||this.Fm.QQi(1,ca)}PIm(ca){try{var ia=!1,ra=!1,da=ca.Bj,za=v.a.LZ(ca.request.get_url());if(da&&ha.A_f in da){const Ta=da[ha.A_f].toString().toLocaleLowerCase();ra="true"===Ta;ia="false"===Ta}da=!1;const Na=0<=za.toLocaleLowerCase().indexOf("collab");ra&&!Na?da=!0:ia&&Na&&(da=!0);if(da){ia={};ia.HostName=za;ia.Status=A.a[ca.status];ia.HttpStatus=
ca.jf.toString();var la=ca.request.get_headers();for(let Ta in la){var na=la[Ta];(za=Ta)&&0<za.length&&(ra=0,na&&(ra=na.toString().length),ia["r_"+za]=ra)}if(ca.Bj){const Ta=new a.a;Ta.add(ha.jBd);Ta.add(ha.fWc);Ta.add(ha.z1c);Ta.add(ha.TBi);Ta.add(ha.SBi);Ta.add(ha.szi);ha.gck(ia,ca.Bj,Ta)}ha.Qbk(ca.request.get_url(),ia);var Ca=G.a.toJSON(ia);l.ULS.sendTraceTag(559437006,500,15,Ca)}}catch(Na){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Na.toString())}}static createInstance(ca,
ia,ra,da,za,la,na,Ca,Na,Ta,Fa,qa=null){return ha.bUk(ca,ia,ra,da,za,la,na,Ca,Na,Ta,Fa,qa)}static bUk(ca,ia,ra,da,za,la,na,Ca,Na,Ta,Fa,qa=null){ca=ca||I.a.create().toString();ca=new ha(ca,ia,ra,da,za,la,na,Ca,Na,Ta,null,Fa,qa);ca.init();return ca}static gck(ca,ia,ra){for(let da of ra)da in ia&&(ca[da]=ia[da])}static Qbk(ca,ia){if(ca){var ra=ca.indexOf("?");if(-1!==ra)for(ca=ca.substr(ra+1).split("&"),ra=0;ra<ca.length;++ra){var da=ca[ra].split("=");if(2===da.length){const za=da[0];if(za&&0<za.length){let la=
0;if(da=da[1])la=da.length;ia["q_"+za]=la}}}}}}ha.qJl=3E3;ha.aSm=3E5;ha.TGk="1.0";ha.adi=1E3;ha.jBd="X-CorrelationId";ha.jyh="corrid";ha.z1c="RtcErrorCode";ha.fWc="X-OfficeCluster";ha.A_f="X-NewEnv";ha.szi="X-MSEdge-Ref";ha.SBi="X-OFFICEFD";ha.TBi="X-OfficeFE";Object(D.a)(ha,"FindSessionStrategy",null,[883])},1716:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(52),a=c(438),k=c(61),m=c(82);class w{constructor(r){this.messageId=r;this.VTn=(new Date).getTime();this.AAf=new m.a}}Object(D.a)(w,"MessageLatencyDetails",
null,[]);c.d(L,"ClientToClientMessageTelemetry",function(){return v});class v{constructor(r,z,A){this.ZJa=null;this.XCe=this.WKe=0;this.Pd=z;this.wWg=A;this.Mxc=!1;this.Fm=r;this.Fm.f6(Object(e.a)(this,this.Stn,"receiveMessage"))}start(){if(this.wWg&&!this.Mxc){const r=this.Pd.h0i;this.XCe=this.Pd.c0i;r<=this.XCe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Pd.h0i,this.Pd.c0i),this.wWg=!1):(this.Mxc=!0,this.WKe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),r))}}sendMessage(){if(this.Mxc){const r=k.a.create().toString();this.ZJa=new w(r);this.Fm.QUf(16,r,!1,new a.a);window.setTimeout(()=>{this.fLm(r)},this.XCe)}}fLm(r){this.ZJa&&this.ZJa.messageId===r&&(0<this.ZJa.AAf.count?(r=this.ZJa.AAf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",r)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.ZJa=null)}stop(){this.WKe&&(window.clearInterval(this.WKe),this.Mxc=!1)}Stn(r,z){16===z.type?this.Fm.QUf(17,z.FM,!1,new a.a):17===z.type&&this.Mxc&&z.FM&&this.processMessage(z.FM)}processMessage(r){r&&this.ZJa&&r.toString()===this.ZJa.messageId&&(r=(new Date).getTime()-this.ZJa.VTn,this.ZJa.AAf.add(r))}static get instance(){return v._instance}static t5b(r,z,A){return v.instance||(v._instance=new v(r,z,A))}}v._instance=null;Object(D.a)(v,"ClientToClientMessageTelemetry",null,[])},1815:function(D,
L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.Tpa=e;this.LDd=a}}Object(D.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1816:function(D,L,c){c.r(L);c.d(L,"RealtimeChannelMetrics",function(){return m});D=c(0);var l=c(8),e=c(185),a=c(77),k=c(1468);class m{constructor(){this.eYg=this.fYg=this.gYg=this.aYg=this.$Xg=this.bYg=this.Luc=this.KEe=0;this.cJa=this.OBe=this.ktc=this.ABe=this.vVa=this.nBe=this.x$a=this.Xsc=this.qUb=this.mBe=this.eed=
this.QSb=null;this.iDe=this.buc=this.R4g=this.VDg=0;this.xWg=!1;this.PRi=this.rVf;this.SRi=this.uVf;this.RRi=this.tVf;this.WRi=this.xVf;this.VRi=this.wVf;this.HVf=this.IVf;this.v_c=this.FVf;this.AKb=this.DVf;this.BKb=this.EVf;this.QRi=this.sVf;this.hQa=this.jIf;this.dkb=this.kIf}rVf(){this.KEe++;this.mBe=new Date;this.QSb||(this.QSb=new Date)}uVf(){this.Luc++;this.x$a=new Date;this.eed||(this.eed=this.x$a);this.ktc=this.x$a;this.ILk()}tVf(){this.bYg++;this.nBe=new Date}xVf(){this.$Xg++;this.qUb=new Date}wVf(){this.aYg++;
this.Xsc=new Date}FVf(){this.vVa=new Date;this.gYg++}EVf(){this.cJa||(this.cJa=new Date);this.fYg++}DVf(){this.ABe=new Date;this.eYg++}IVf(){!this.xWg&&this.KEe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.DIk())),this.xWg=!0)}sVf(w){let v,r;({mbi:w,obi:v,exception:r}=k.RtcUtils.rfl(w));w&&w!==e.a.tB&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:w,["HttpErrorStatus"]:v,["Exception"]:r})),e.a.luf(w)&&this.VDg++,e.a.jyf(w)&&this.R4g++)}jIf(){this.OBe=new Date}kIf(){this.qUb=
this.ktc=new Date}DIk(){return{["numberOfConnectionAttempts"]:this.KEe,["numberOfSuccessfulConnections"]:this.Luc,["numberOfFailedConnections"]:this.bYg,["numberOfDisconnectedConnections"]:this.$Xg,["numberOfExplicitDisconnectedConnections"]:this.aYg,["numberOfSentMessages"]:this.gYg,["numberOfReceivedMessages"]:this.fYg,["numberOfLostMessages"]:this.eYg,["firstConnectionAttempt"]:this.QSb?this.QSb:null,["firstMessageReceived"]:this.cJa?this.cJa:null,["firstConnectionSuccess"]:this.eed?this.eed:null,
["lastConnectionAttempt"]:this.mBe?this.mBe:null,["lastConnectionSuccess"]:this.x$a?this.x$a:null,["lastConnectionFailure"]:this.nBe?this.nBe:null,["lastMessageSent"]:this.vVa?this.vVa:null,["lastMessageLost"]:this.ABe?this.ABe:null,["lastDisconnect"]:this.qUb?this.qUb:null,["lastExplicitDisconnect"]:this.Xsc?this.Xsc:null,["lastTimeOnline"]:this.ktc?this.ktc:null,["lastTimeOffline"]:this.OBe?this.OBe:null,["maxDisconnectedTimeMs"]:this.buc,["maxExplicitDisconnectedTimeMs"]:this.iDe,["clientConnectionErrors"]:this.VDg,
["serverConnectionErrors"]:this.R4g}}ILk(){this.QSb&&1===this.Luc&&(this.buc=Math.max(this.buc,this.x$a.getTime()-this.QSb.getTime()));this.qUb&&1<this.Luc&&(this.buc=Math.max(this.buc,this.x$a.getTime()-this.qUb.getTime()));this.Xsc&&1<this.Luc&&(this.iDe=Math.max(this.iDe,this.x$a.getTime()-this.Xsc.getTime()))}static createInstance(w){m._instance||(m._instance=new m,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",w));return m._instance}}m._instance=null;Object(D.a)(m,
"RealtimeChannelMetrics",null,[884,225])},1817:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.Tpa=a}}Object(D.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1818:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e){super();this.gzd=e}}Object(D.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1973:function(D,L,c){c.r(L);var l=c(0),e=c(52);class a{constructor(Ba,
ub){this.Jda=null;this.Svc=Ba;this.UYj=ub}init(){this.Svc.continueWith(()=>{this.Jda=this.Svc.result;this.Jda.pZb(Object(e.a)(this,this.Eba,"onUsersUpdated"))})}Eba(){a.fWe(this.Jda.A_a())&&(this.Jda.VXf(Object(e.a)(this,this.Eba,"onUsersUpdated")),this.UYj.IsRealCoauthSession=!0)}get Dum(){return this.Jda?a.fWe(this.Jda.A_a()):!1}static fWe(Ba){let ub=null;for(const ic of Ba)if(ic)if(Ba=ic.isAnonymous||!ic.email?ic.clientId:ic.email.toUpperCase(),!ub)ub=Ba;else if(ub!==Ba)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[756]);var k=c(8),m=c(438),w=c(68),v=c(2),r;(function(Ba){Ba[Ba.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Ba[Ba.notImplemented=1]="notImplemented";Ba[Ba.renderHandled=2]="renderHandled";Ba[Ba.renderHandledWithVeto=3]="renderHandledWithVeto"})(r||(r={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",r);var z=c(80),A=c(77),G=c(121);class H{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){this.g0g=this.oEg=this.KC=null;this.N4=Ba;this.Hqd=new m.a;this.Ma=ic;this.ope=
ub;this.S4=Hc;this.Rg=Vb;this.fHe=Ud;this.xab=Cc;this.pEj=Te;this.cNg=this.WMg=!1;this.Yrd=0;this.mEg=1;this.$pb=Ne;this.Fzc=this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");this.nqa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Cej(){return this.Hqd.task}init(){G.Task.WAA.call(null,this.xab,this.ope,this.fHe).continueWith(()=>{this.KC=this.xab.result;this.oEg=this.ope.result;this.g0g=this.fHe.result;G.Task.WAA.call(null,this.ope.result.y0b,this.fHe.result.gij).continueWith(()=>
{this.mEg=this.oEg.y0b.result;this.Yrd=this.g0g.gij.result;this.KC.pZb(Object(e.a)(this,this.u2d,"onUsersUpdatedEventListener"));this.KC.A_a().length&&this.Eba()})})}u2d(){this.Eba()}Eba(){this.pEj(this.KC.A_a())?(this.KC.VXf(Object(e.a)(this,this.u2d,"onUsersUpdatedEventListener")),this.T3m(this.WMg)):this.Hqd.QU(1);this.WMg=!0}T3m(Ba){this.cNg?this.Cej.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",r[this.Cej.result])}):(this.cNg=
!0,this.knn(0===this.mEg&&!Ba))}knn(Ba){Ba?this.S4.al(4,Object(e.a)(this,this.SLf,"onInteractiveReady")):this.Hqd.QU(1)}SLf(){const Ba=this.Rg.UF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.Yrd);const ub=this.Yrd-Ba,ic={};ic.InteractiveTime=Ba;ic.ReactRenderComplete=this.Yrd;ic.HadTabSwitch=this.$pb();ic.IsModernGallery=this.Fzc;k.ULS.sendTraceTag(594883104,325,50,A.a.toJSON(ic));this.Fzc?(k.ULS.sendTraceTag(42062997,325,15,ub.toString()),this.Hqd.QU(this.fFo(ub)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,ub.toString())}fFo(Ba){const ub=Ba>this.Ma.pc("CoauthorGalleryTimeToRenderDurationMs",1E4),ic="Word"===this.nqa;if(this.$pb())return k.ULS.sendTraceTag(50455714,325,50,ub.toString()),!1;ic&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);ub&&(ic&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Ba.toString()));
return ub}}Object(l.a)(H,"CoauthorGalleryTelemetry",null,[757]);class I{constructor(Ba){this.KC=null;this.Lad={};this.Amd={};this.Grc=null;this.xab=Ba}TLd(Ba){const ub=new m.a;this.init().continueWith(()=>{Ba in this.Lad?ub.QU(this.Lad[Ba]):this.Amd[Ba]=ub});return ub.task}init(){if(this.Grc)return this.Grc.task;this.Grc=new m.a;this.xab.continueWith(()=>{this.KC=this.xab.result;this.KC.pZb(Object(e.a)(this,this.Eba,"onUsersUpdated"));this.Qpj();this.Grc.Cg(null)});return this.Grc.task}Qpj(){const Ba=
this.KC.A_a();Ba.sort(Object(e.a)(this,this.iLk,"comparePresenceUsers"));this.Lad={};for(let ub=0;ub<Ba.length&&Ba[ub]&&Ba[ub].yPa;ub++)this.Ibk(this.Lad,Ba[ub].clientId,ub)}Ibk(Ba,ub,ic){Ba[ub]=ic;ub in this.Amd&&(this.Amd[ub].QU(ic),delete this.Amd[ub])}Eba(){this.Qpj()}iLk(Ba,ub){return Ba.yPa>ub.yPa?1:Ba.yPa<ub.yPa?-1:0}}Object(l.a)(I,"CoauthorPositionFinder",null,[754]);var K=c(524),F=c(376),J=c(546),N=c(82),O=c(119);class M{constructor(){this.HAa=null;this.zmc=Array(32)}xor(Ba){if(!Ba)throw Error.argumentNull("Guid argument cannot be null");
const ub=new M,ic=new Sys.StringBuilder;for(let Hc=0;Hc<Ba.zmc.length;Hc++){const Vb=this.zmc[Hc]^Ba.zmc[Hc];ub.zmc[Hc]=Vb;ic.append(Vb.toString(16));7!==Hc&&11!==Hc&&15!==Hc&&19!==Hc||ic.append("-")}ub.HAa=O.a.Gf(ic.toString());return ub}toString(){return this.HAa.toString()}equals(Ba){if(!Ba)throw Error.argumentNull("Guid argument cannot be null");return this.HAa.equals(Ba.HAa)}static g4b(Ba){if(!Ba)throw Error.argumentNull("String input cannot be null");const ub=new M;ub.HAa=O.a.Gf(Ba);const ic=
ub.HAa.toString();let Hc=0;for(let Ud=0;Ud<ic.length;Ud++){var Vb=Ba.charAt(Ud);if(M.Npm(Vb))Vb=M.W7l(Vb,Ba.charCodeAt(Ud)),ub.zmc[Hc++]=Vb;else if(!M.lpm(Vb))throw Error.argument("String contains characters not valid in Guids");}return ub}static Npm(Ba){return"0"<=Ba&&"9">=Ba||"A"<=Ba&&"F">=Ba||"a"<=Ba&&"f">=Ba}static lpm(Ba){return"{"===Ba||"}"===Ba||"-"===Ba}static W7l(Ba,ub){if("0"<=Ba&&"9">=Ba)return ub-48;if("A"<=Ba&&"F">=Ba)return ub-65+10;if("a"<=Ba&&"f">=Ba)return ub-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(M,"Guid",null,[]);class T{constructor(Ba,ub,ic,Hc){this.Jda=null;this.EGg=this.dXg=!1;this.kUg=0;this.Svc=Ba;this.CNe=ub;this.Ma=ic;this.ZUb=Hc;this.JDj=v.AFrameworkApplication.akc||v.AFrameworkApplication.Qna;this.rVg=new K.a(F.a.Ri())}get n6e(){return this.Ma.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Svc.continueWith(()=>{this.Jda=this.Svc.result;this.Jda.pZb(Object(e.a)(this,this.Eba,"onUsersUpdated"))})}Eba(){this.AIk(this.Jda.A_a())}AIk(Ba){var ub=
0;const ic=new J.a(F.a.Ri());for(const Hc of Ba)if(Hc&&Hc.isAnonymous){v.AFrameworkApplication.Ce("70eb6120;2gfeb930");if(ic.ub(Hc.userName))ic.J(Hc.userName).add(Hc.clientId);else{let Vb;ic.add(Hc.userName,(Vb=new N.a,Vb.add(Hc.clientId),Vb))}Hc.clientId!==this.ZUb?(ub++,2<=ub&&!this.dXg&&this.oLm()):!this.EGg&&this.n6e&&"Guest"===Hc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.EGg=!0)}if(this.n6e&&this.kUg!==ub){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
ub+(this.JDj?1:0));this.kUg=ub;for(let Hc of ic.keys)2<=ic.J(Hc).count&&(Ba=this.eBl(ic.J(Hc)),this.rVg.contains(Ba)||(ub={},ub.guestsWithSameName=ic.J(Hc).count,ub.identifier=Ba,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",ub),this.rVg.add(Ba)))}}oLm(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.dXg=!0;this.n6e&&this.CNe&&this.CNe.continueWith(()=>{window.setTimeout(()=>{this.CNe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}eBl(Ba){if(!Ba||1>=Ba.count)return"";let ub=M.g4b(Ba.J(0));for(let ic=1;ic<Ba.count;ic++)ub=ub.xor(M.g4b(Ba.J(ic)));return ub.toString()}}Object(l.a)(T,"GuestCoauthTelemetry",null,[]);var R=c(231);class W{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(W,"PL",null,[]);var V=c(33);class ba{constructor(){this.ct=this.vt=this.d=0}static F3i(Ba,ub,ic){const Hc=new ba;Hc.d=Ba;Hc.vt=ub;Hc.ct=ic;return V.c(Hc)}}Object(l.a)(ba,"VD",null,
[]);var ha=c(134);class ca{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){this.$4g=!1;this._id=Ba;this.Fi=ub;this.Qr=ic;this.dEe=Hc;this.pOe=Vb;this.Zwb=Ud;this.Rqb=Cc;this.SGj=Te;this.$pb=Ne;this.nqa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Bie(Ba){G.Task.WAA(this.dEe,this.pOe).continueWith(()=>{if(this.dEe.result<=this.pOe.result)Ba.QU(!1);else{var ub=this.Qr-this.Fi,ic=new W;ic.id=this._id;ic.et=this.Qr;ic.st=this.Fi;ic.d=this.Qr-this.Fi;ic.mp=this.dEe.result;
ic.tp=this.pOe.result;ic.ct=this.mwl(this.SGj);ic.vc=this.$pb();var Hc=V.c(ic),Vb="Word"===this.nqa;k.ULS.sendTraceTag(42078597,302,15,Hc);if(Vb){const Ud=new Map;Ud.set("data",Hc);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ud)}ub>this.Zwb.value&&!this.$4g&&!ic.vc&&(this.$4g=!0,Ba.QU(!0),ic=Object.assign(new ha.a,{inStaging:!0,extendedProperties:new Map}),ic.extendedProperties.set("data",Hc),Vb&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",
!1,!0,ic),ub<this.Rqb.value&&k.ULS.sendTraceTag(42078598,302,15,ba.F3i(ub,this.Zwb.value,this.Rqb.value)));Ba.task.isCompleted||Ba.QU(!1)}})}mwl(Ba){switch(Ba){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(ca,"PresenceLatencyActivityLogger",null,[]);class ia{constructor(Ba,ub,ic){this.fDg=this.kEg=this.pad=this.Kad=this.gQb=0;this._id=Ba;this.Zwb=ub;this.Rqb=ic;this.nqa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||
""}get pgh(){return this.gQb}set pgh(Ba){this.gQb=Ba;this.E_e()}get Ith(){return this.Kad}set Ith(Ba){this.Kad=Ba;this.E_e()}get Xph(){return this.pad}set Xph(Ba){this.pad=Ba;this.E_e()}get Jth(){return 0!==this.kEg}get Yph(){return 0!==this.fDg}E_e(){!this.Jth&&this.gQb&&this.Kad&&(this.kEg=this.Bie(this.Kad,"CoauthGalleryLightupDurationTooLong"));!this.Yph&&this.gQb&&this.pad&&(this.fDg=this.Bie(this.pad,"CanvasPresenceLightupDurationTooLong"))}Bie(Ba,ub){const ic=Ba-this.gQb;var Hc=new W;Hc.id=
this._id;Hc.et=Ba;Hc.st=this.gQb;Hc.d=ic;var Vb=V.c(Hc);Ba="Word"===this.nqa;Hc="CanvasPresenceLightupDurationTooLong"===ub?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===ub?k.ULS.sendTraceTag(572289499,302,15,Vb):k.ULS.sendTraceTag(571524118,302,15,Vb);if(Ba){var Ud=new Map;Ud.set("data",Vb);z.Health.instance.recordKpiUsage(Hc,0,"wordcollabrel",Ud)}return ic>this.Zwb.value?(Ud=Object.assign(new ha.a,{inStaging:!0,extendedProperties:new Map}),
Ud.extendedProperties.set("data",Vb),Vb=ic<this.Rqb.value,Ud.extendedProperties.set("cash",Vb?"true":"false"),Ba&&z.Health.instance.recordKpiFailure(Hc,ub,!1,!0,Ud),k.ULS.sendTraceTag(572289500,302,15,ba.F3i(ic,this.Zwb.value,this.Rqb.value)),Vb?2:1):3}}Object(l.a)(ia,"PresenceLightupLatencyLogger",null,[]);var ra=c(39),da=c(164);class za{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc=null,Te=null,Ne=null){this.k1g={};this.npe={};this.QSg=new N.a;this.Hrc=this.KC=this.pj=null;this.Q6g=this.P6g=0;this.Zwb=new R.a(()=>
Cc.bQ("PresenceBootLatencyThreshold",1E4));this.Rqb=new R.a(()=>Cc.bQ("PresenceBootLatencyCutoffThreshold",6E4));this.f7j=new R.a(()=>Cc.bQ("PresenceLightupLatencyThreshold",2E3));this.QIj=new R.a(()=>Cc.bQ("PresenceLightupLatencyCutoffThreshold",1E4));this.aZj=Hc;this.nEg=Ba;this.L3g=ub;this.xab=ic;this.Rg=Vb;this.ZUb=Te;this.$pb=Ud;this.iNg=Ne;this.cCg=!1;this.init()}KHc(Ba,ub,ic=null,Hc=0){ic&&(k.ULS.shipAssertTag(42274970,302,!this.ZUb||this.ZUb===ic,"_myClientId is already set and you are trying to update it to something different"),
this.ZUb=ic);const Vb=new m.a;this.init().continueWith(()=>{this.t7m(Ba);this.Ral(Vb,Ba,ub,Hc)})}get Czi(){return this.ZUb||"{"+v.AFrameworkApplication.userSessionId+"}"}init(){if(this.Hrc)return this.Hrc.task;this.Hrc=new m.a;this.$pb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.nEg.continueWith(()=>{const Ba=this.nEg.result,ub=Ba.y0b,ic=Ba.FVm;ic.continueWith(()=>{ub.continueWith(()=>{this.iNg&&this.iNg.addQosPillar("RealTimeCoauth");this.G7f(ub.result,ic.result);this.Hrc.Cg(null)})})});
this.L3g.continueWith(()=>{this.pj=this.L3g.result;this.pj.Esa(Object(e.a)(this,this.B8m,"onRtcConnection"));this.pj.f6(Object(e.a)(this,this.T1m,"onCoauthorBootReceived"))});this.xab.continueWith(()=>{this.KC=this.xab.result;this.KC.pZb(Object(e.a)(this,this.u2d,"onUsersUpdatedEventListener"));0<this.KC.A_a().length&&this.Eba()});return this.Hrc.task}bUh(){return this.Rg.Gea(ra.a.P6a)?this.Rg.UF(ra.a.P6a):da.a.Rcb?window.performance.timing.fetchStart:-1}B8m(Ba,ub){this.cCg||2!==ub.newState||(Ba=
this.bUh(),Ba=Date.now()-Ba,ub={},ub.clientId=this.Czi,ub.bootTime=Ba,this.cCg=!0,this.pj.vO(15,ub))}T1m(Ba,ub){if(15===ub.type){Ba=Date.now();ub=ub.FM;var ic=ub.bootTime;this.Vjf(ub.clientId).pgh=Ba-ic}}u2d(){this.Eba()}Eba(){const Ba=Date.now();var ub=this.KC.A_a();const ic=new N.a;for(const Hc of ub)this.QSg.contains(Hc.clientId)||(this.QSg.add(Hc.clientId),ic.add(Hc.clientId));if(0<ic.count)for(let Hc of ic)ub=this.Vjf(Hc),ub.Jth||(ub.Ith=Ba)}t7m(Ba){Ba=this.Vjf(Ba);Ba.Yph||(Ba.Xph=Date.now())}Vjf(Ba){return Ba in
this.npe?this.npe[Ba]:this.npe[Ba]=new ia(Ba,this.f7j,this.QIj)}G7f(Ba,ub=0){this.P6g=Ba;this.Q6g=ub?ub:(new Date).getTime()}Ral(Ba,ub,ic,Hc){ic=ic?ic.getTime():(new Date).getTime();ub in this.k1g?Ba.via():(Hc=new ca(ub,this.EUl(),ic,this.TLd(this.Czi),this.TLd(ub),this.Zwb,this.Rqb,Hc,this.$pb),this.k1g[ub]=Hc,Hc.Bie(Ba))}EUl(){return 1===this.P6g?this.Q6g:this.bUh()}TLd(Ba){return this.aZj.TLd(Ba)}}Object(l.a)(za,"PresenceBootTelemetry",null,[755]);var la=c(112),na=c(177),Ca=c(204),Na=c(22),Ta=
c(642);class Fa{get name(){return"Common.App.CoauthTelemetry"}xc(Ba){Ba.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Xd(()=>new a(Ta.a.sq(Ba.Za("Common.IPeopleInfoProvider")),v.AFrameworkApplication.Gg));Ba.register(H,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Xd(()=>new H(v.AFrameworkApplication.ya,Ta.a.sq(Ba.Za("Common.ICoauthoringTelemeryInfoProvider")),
v.AFrameworkApplication.K,la.a.get_instance(),Ca.a.instance,Ta.a.sq(Ba.Za("Common.IPeoplesWell")),Ta.a.sq(Ba.Za("Common.IPeopleInfoProvider")),a.fWe,()=>this.Omh()));Ba.register(za,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Xd(()=>new za(Ta.a.sq(Ba.Za("Common.ICoauthoringTelemeryInfoProvider")),Ta.a.sq(Ba.Za("Common.IRealtimeChannelBasic")),Ta.a.sq(Ba.Za("Common.IPeopleInfoProvider")),Ba.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
Ca.a.instance,()=>this.Omh(),v.AFrameworkApplication.K,null,z.Health.instance));Ba.register(I,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Xd(()=>new I(Ta.a.sq(Ba.Za("Common.IPeopleInfoProvider"))));Ba.register(T,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Xd(()=>new T(Ta.a.sq(Ba.Za("Common.IPeopleInfoProvider")),Ta.a.sq(Ba.Za("Common.ISystemInitiatedFeedback")),v.AFrameworkApplication.K,"{"+
v.AFrameworkApplication.userSessionId+"}"))}init(){v.AFrameworkApplication.K.lp(()=>{Na.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Na.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Na.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();v.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Na.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
Na.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Omh(){return da.a.Rcb&&Ca.a.instance.Gea(ra.a.T7c)?0<Ca.a.instance.UF(ra.a.T7c)[ra.a.Lsj]:!1}static main(){na.a.instance.Kc(new Fa)}}Object(l.a)(Fa,"CoauthTelemetryPackage",null,[1,2]);class qa extends Sys.EventArgs{constructor(){super()}}Object(l.a)(qa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ja;(function(Ba){Ba[Ba.notYetStarted=0]="notYetStarted";Ba[Ba.polling=1]="polling";Ba[Ba.subscribed=2]="subscribed";
Ba[Ba.blocked=3]="blocked";Ba[Ba.permanentlyStopped=4]="permanentlyStopped"})(ja||(ja={}));Object(l.b)("RtcHostNotificationSubscriptionState",ja);var X=c(83),ua=c(1382),Ha=c(69);class Ea{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){this.Mh=!1;this.k$=this.gWb=this.Yda=this.zWa=null;this.vyc=Ea.nle;this.sa=new Ha.a;this.sbb=new ua.a(0);this.sbb.XTe(Object(e.a)(this,this.F9m,"onStateMachineChanged"));this.E0j=Ba;this.Vod=ub;this.D0j=ic;this.XJe=Hc;this.Gb=Vb;this.nf=Ud;Cc.execute(Sf=>{this.Mh||(this.gWb=
Sf,this.gWb.f6(Object(e.a)(this,this.Dba,"onUpdateNotificationReceived")),this.start())});Te.execute(Sf=>{this.Mh||(this.k$=Sf,Sf.PXa(Object(e.a)(this,this.Zga,"onTokenRefreshed")))});this.Vrd=Ne}get Xhc(){return this.sbb.currentState}get Cni(){return!this.nf||this.nf.Ova}get Xni(){return 2===this.Xhc&&this.Vrd()<this.vyc}start(){0!==this.Xhc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",ja[this.Xhc]):(this.sbb.event(1),this.c1f(null))}c1f(){this.zWa=
null;if(this.Cni){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ja[this.Xhc]);let Ba=null;this.XJe&&this.XJe.length&&(Ba={},Ba.etts=this.XJe);this.gWb.vO(14,Ba,!0);this.B1i(this.E0j)}else this.sbb.event(3)}B1i(Ba){this.zWa=X.a.F6(1E3*Ba,Object(e.a)(this,this.c1f,"sendSubscribeEvent"),this.Vod,192,"RtcHostNotificationSubscribe");this.Gb.Xb(this.zWa)}CQn(Ba){Ba=1E3*(Ba+this.D0j);const ub=this.Vrd().getTime()+Ba;this.vyc=new Date(ub);Ba-=this.Vod;
this.Yda?this.Gb.e4(this.Yda,Ba):(this.Yda=X.a.F6(Ba,Object(e.a)(this,this.dpo,"transitionToPollingEvent"),this.Vod/2,194,"RtcHostNotificationTransitionToPolling"),this.Gb.Xb(this.Yda))}dpo(){this.Yda=null;2===this.Xhc&&(this.sbb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.zWa,"Missing task to ensure that we re-subscribe."))}Zga(){this.U1l()}U1l(){3===this.Xhc&&this.Cni&&(this.sbb.event(this.Xni?2:1),this.c1f(null))}Dba(Ba,ub){if(13===ub.type&&(Ba=ub.FM,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:Ba,["DurationBeforeExpirationToResubscribeInSec"]:this.Vod}),ub=Ba.cts,!this.Aro(ub))){if(Ba.sb){var ic=2;this.CQn(Ba.cts)}else ic=1,this.vyc=Ea.nle,this.Yda&&(this.Gb.Se(this.Yda),this.Yda=null);this.sbb.event(ic);this.zWa?this.Gb.e4(this.zWa,1E3*ub):this.B1i(ub)}}Aro(Ba){if(!isNaN(Ba)&&isFinite(Ba)&&0<Ba)return!1;this.Rej(!1);return!0}Rej(Ba){this.zWa&&(this.Gb.Se(this.zWa),this.zWa=null);this.Yda&&(this.Gb.Se(this.Yda),this.Yda=null);this.gWb&&(this.gWb.zec(Object(e.a)(this,
this.Dba,"onUpdateNotificationReceived")),this.gWb=null);this.k$&&(this.k$.SKb(Object(e.a)(this,this.Zga,"onTokenRefreshed")),this.k$=null);Ba||this.sbb.event(4)}F9m(Ba,ub){Ba=ub.newState;const ic=ub.SRf,Hc={};Hc.NewState=ja[Ba];Hc.PreviousState=ja[ic];Hc.PreviousStateHits=ub.TRf;Hc.PreviousStateTransitionTime=ub.URf.toISOString();Hc.IsSubscribed=this.Xni;this.vyc!==Ea.nle&&(Hc.SubscriptionExpiringTime=this.vyc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Ba?15:50,"HostNotificationChanged: {0}",
Hc);this.sa.raiseEvent("HN",new qa(ic,Ba))}dispose(){this.Mh||(this.Mh=!0,this.Rej(!0),this.Yda&&(this.Gb.Se(this.Yda),this.Yda=null))}}Ea.nle=new Date(0);Object(l.a)(Ea,"RtcHostNotificationSubscriptionManager",null,[753,9]);var wa=c(393);class sa{constructor(){this.Ah=this.Mh=!1}get name(){return"RtcHostNotificationSubscription"}xc(Ba){Ba.register(Ea,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Xd(()=>
{const ub=v.AFrameworkApplication.K;return new Ea(ub.pc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),ub.pc("RtcHostNotificationRetryIntervalBufferInSeconds",120),ub.pc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.ASl(ub),v.AFrameworkApplication.uc,wa.SessionStatusManager.instance,Ba.Za("Common.IRealtimeChannelBasic"),Ba.Za("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.K.lp(()=>{!this.Mh&&v.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Ah=!0,Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Mh||(this.Mh=!0,this.Ah&&Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}ASl(Ba){return Ba.Sv("RtcEventTypesToSubscribe")?Ba.XB("RtcEventTypesToSubscribe"):null}static main(){na.a.instance.Kc(new sa)}}Object(l.a)(sa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var fa=c(497),Ma=c(651);
class Ua{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie){this.clientId=Ba;this.SkypeChatThreadId=ic;this.chatThreadDiscoveryUri=Hc;this.inChat=Vb;this.localColbaltSessionId=ub;this.capabilities=Ud;this.email=Cc;this.isReadOnly=Te;this.userName=Ne;this.isAnonymous=Sf;this.presenceStatus=Ie}}Object(l.a)(Ua,"SerializablePresenceUserData",null,[]);class Qa extends fa.a{constructor(Ba,ub,ic,Hc,Vb=null,Ud=null,Cc=null,Te=null,Ne=null,Sf=!1,Ie=!1,pg=!1,ak=null){super(Ba,ub,ic,Hc,Ud,Cc,Te,Ne,Sf,Ie,pg);this.zQ=
Vb;this.presenceStatus=ak}getData(){return new Ua(this.clientId,this.zQ,this.ZCc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}ULd(Ba){return(Ba=Ba.value)?Ba.user:null}clone(){return new Qa(this.clientId,this.userName,this.color,this.capabilities.clone(),this.zQ,this.ZCc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static Czb(Ba){return Ba.clientId?
new Qa(Ba.clientId,Ba.userName,null,new Ma.a(void 0===Ba.capabilities?0:Ba.capabilities),Ba.localColbaltSessionId,Ba.SkypeChatThreadId,Ba.email,null,Ba.chatThreadDiscoveryUri,Ba.isAnonymous,Ba.inChat,Ba.isReadOnly,Ba.presenceStatus):null}static Czh(Ba,ub,ic,Hc=null,Vb=null,Ud=null,Cc=null,Te=null,Ne=!1,Sf=!1,Ie=!1,pg=null){return Ba?new Qa(Ba,ub,null,new Ma.a(void 0===ic?0:ic),Hc,Vb,Ud,Cc,Te,Ie,Ne,Sf,pg):null}}Object(l.a)(Qa,"PresenceUser",fa.a,[1192,1193,17]);class Ja extends Qa{constructor(){super();
this.rdc=this.ZBf=null}EKl(){const Ba=v.AFrameworkApplication.userName,ub=v.AFrameworkApplication.K.lb("UserPrincipalName"),ic=this.ZBf?this.ZBf.zQ:null,Hc=v.AFrameworkApplication.akc||v.AFrameworkApplication.Qna,Vb=this.rdc?this.rdc.getStatus():null;return new Qa(this.clientId,Ba,this.color,this.capabilities,ic,this.ZCc,ub,this.client,this.chatThreadDiscoveryUri,Hc,this.inChat,this.isReadOnly,Vb)}}Object(l.a)(Ja,"MyPresenceUser",Qa,[1246,17]);var Wa=c(223);class Ya{constructor(Ba,ub,ic,Hc,Vb){this.Pd=
Ba;this._clientId=ub;this.SJj=Vb;this.QNj=ic||(()=>null);this.RNj=Hc||(()=>null)}get id(){return this.Pd.id}get Rtd(){return this.Pd.Rtd}get Vtd(){return this.Pd.Vtd}get Utd(){return this.Pd.Utd}get Ttd(){return this.Pd.Ttd}get Std(){return this.Pd.Std}get Xtd(){return this.Pd.Xtd}get GRe(){return this.Pd.GRe}get vhc(){return this.Pd.vhc}get Zce(){return this.Pd.Zce}get $Zd(){return this.Pd.$Zd}get clientId(){return this._clientId}get IMc(){return this.QNj}get Pgb(){return this.RNj}get A6k(){return this.SJj}static createInstance(Ba,
ub,ic,Hc,Vb=!1){return new Ya(Ba,ub,ic,Hc,Vb)}}Object(l.a)(Ya,"PeoplesWellSettings",null,[]);var sb=c(11),ob=c(57),fc=c(157),Eb=c(84),Ib=c(214),Nb=c(239),pb=c(443),Aa=c(357);class xb extends Ib.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(xb,"PeopleButtonProps",Ib.a,[]);var gb=c(400),Xa=c(345),Va=c(16),Gb=c(85);class Xb{constructor(Ba){this.U7c=new Gb.a;this.l6e=null;this.clientId=
Ba}S2n(Ba){this.ACn();this.uWn(Ba);for(const ub of Ba)ub.clientId!==this.clientId&&this.keh(ub)}get Xdg(){const Ba=[];for(let ub of this.U7c.values){const ic=this.y2i(ub);Array.add(Ba,ic)}return Ba}get okb(){return this.U7c.count}rTe(Ba,ub){Ba=Ba.toUpperCase();let ic;({value:ic}=this.U7c.Gc(Ba)).returnValue||(ic=[],this.U7c.Z(Ba,ic));Array.add(ic,ub)}ACn(){this.U7c=new Gb.a}uWn(Ba){for(const ub of Ba)if(ub.clientId===this.clientId){this.l6e=ub;break}}}Object(l.a)(Xb,"UserTracker",null,[985]);class rc extends Xb{constructor(Ba,
ub){super(Ba);this.SNj=ub}keh(Ba){Ba.isAnonymous||!Ba.email?this.rTe(Ba.clientId,Ba):this.l6e&&F.a.Ri().equals(this.l6e.email,Ba.email)||this.rTe(Ba.email,Ba)}y2i(Ba){let ub=new Date(0),ic=0<Ba.length?Ba[0]:null;for(const Hc of Ba)(Ba=this.SNj(Hc.clientId))&&ub.getTime()<Ba.B$b.getTime()&&(ub=Ba.B$b,ic=Hc);return ic}}Object(l.a)(rc,"UniqueUserTracker",Xb,[]);class qb extends Xb{constructor(Ba){super(Ba)}keh(Ba){this.rTe(Ba.clientId,Ba)}y2i(Ba){return Ba[0]}}Object(l.a)(qb,"UserInstanceTracker",Xb,
[]);const Zb=(Ba,ub,ic)=>ic?new rc(Ba,ub):new qb(Ba);var Rb=c(63),Ra=c(619),ab=c(13);class fb{constructor(Ba,ub=null,ic=null){this.KC=null;this.yOe=new m.a;this.Pd=Ba;this.a4d=ub;ic&&ic.continueWith(()=>{this.KC=ic.result;this.KC.pZb(Object(e.a)(this,this.Eba,"onUsersUpdated"));this.A7d()});new fa.a(this.settings.clientId,"Anonymous user","#cccccc",new Ma.a(7));this.cTd=this.oAe=!0;this.iwe=this.eHe=!1;this.hya=Zb(this.settings.clientId,this.settings.Pgb,Ba.A6k)}get settings(){return this.Pd}get Alm(){return v.AFrameworkApplication.K?
v.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get jhi(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}lyl(){let Ba;let ub,ic,Hc,Vb;var Ud=this.myl();this.hya.okb?1===this.hya.okb?(ub=!0,ic=this.settings.vhc.cluster,Hc=this.settings.vhc.iCd,Vb=this.hya.Xdg[0].color):(ub=!0,ic=this.settings.$Zd.cluster,Hc=this.settings.$Zd.iCd,Vb=""):(ub=!1,Vb=Hc=ic="");Ba=Ud[0];Ud=Ud.slice(1);return{Gbn:Ba,Hbn:Ud,Cbn:ub,cYo:ic,Ebn:Hc,Dbn:Vb}}myl(){if(2<=
this.hya.okb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.hya.okb)];if(1===this.hya.okb){const Ba=this.hya.Xdg[0],ub=this.settings.Pgb(Ba.clientId);return ub&&2===ub.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ba.userName]:[Ba.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Ba.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}iZl(Ba){return this.jZl(Ba)}xph(Ba,
ub,ic){return ub?this.sAk(ub)?(Ba=this.settings.Pgb(Ba))&&2===Ba.status?!1:!0:(ic&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(ic&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}KUl(Ba){return Ba.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}jZl(Ba){if(!Ba.capabilities.uDa(1))return this.KUl(Ba);const ub=Ba.isReadOnly,ic=this.settings.Pgb(Ba.clientId);
Ba=this.settings.IMc(Ba.clientId);if(!ic)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(ic.status){case 1:return Ba?ub?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.HPk(Ba)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}cGl(Ba){if(this.a4d.qVd)return this.a4d.E1b(Ba.email,
"O365",v.AFrameworkApplication.Gm,0)}WYl(Ba){Ba=this.settings.Pgb(Ba.clientId);return!Ba||Ba&&1===Ba.status?!0:!1}YYl(Ba){var ub=String.format("buttonPeoplesWellUser-{0}",Ba.clientId),ic=Ba.clientId,Hc=this.iZl(Ba);const Vb=Ba.userName,Ud=Ba.color;var Cc=Object,Te=Cc.assign,Ne=new xb,Sf=this.settings.Xtd.toString(),Ie=this.settings.Zce.cluster,pg=this.settings.Zce.iCd,ak=this.YVh(),nn=Ba.isAnonymous,Sl;if(Sl=[Vb],Sl.length){var ql=new Sys.StringBuilder("STRARRY@");for(const Pj of Sl)ql.append(Pj?
Pj.length:0),ql.append(","),ql.append(Pj),ql.append(",");Sl=ql.toString().slice(0,-1)}else Sl=null;ub=Te.call(Cc,Ne,{Id:ub,Command:Sf,LabelText:"{0}",Image32by32:Ie,Image32by32Class:pg,MenuItemId:ic,CommandValueId:ic,Alt:Vb,DisplayMode:ak,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Hc,ImageBackColor:Ud,IsAnonymous:nn,LabelTextUserGeneratedPlaceholderReplacements:Sl,Upn:Ba.email});v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.a4d&&(ic=this.cGl(Ba),Hc=this.WYl(Ba),ub.ImageUrl=ic,ub.ActiveStatus=Hc,ub.JoinTimeInMS=Ba.yPa,Ba=this.xph(Ba.clientId,this.settings.IMc(Ba.clientId),!1),ub.CanJump=Ba,""===ic&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return ub}qEl(){return Object.assign(new Ib.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}YVh(){return this.Alm?"Initials":
"Menu32"}ZYl(Ba){const ub=[];for(const ic of Ba)Ba=this.YYl(ic),Array.add(ub,Ba);return ub}CSd(){return 0<this.hya.okb}Aqn(Ba){if(!this.oAe)return!0;this.cTd||(Ba[Ra.a.Visible]=!0);let ub,ic,Hc,Vb,Ud;({Gbn:ub,Hbn:ic,Cbn:Hc,Ebn:Vb,Dbn:Ud}=this.lyl());Ba[Ra.a.LabelText]=ub;ic&&ic.length&&(Ba[Ra.a.LabelTextUserGeneratedPlaceholderReplacements]=ic);Ba[Ra.a.ImageIsVisible]=Hc;Ba[Ra.a.Image16by16Class]=Vb;Ba[Ra.a.ImageBackColor]=Ud;this.oAe=!1;return!0}$hn(Ba){if(0>=this.hya.okb)return!1;var ub=this.Nco(this.hya.Xdg),
ic=this.ZYl(ub);ub=Object.assign(new pb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});ic=Object.assign(new Aa.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.YVh(),ControlList:ic});v.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.a4d&&(ic.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,ic.TitleId="menuCoauthorsTitle",ic.Theme="Light");Array.add(ub.MenuSectionList,ic);v.AFrameworkApplication.K.$("DocChatIsEnabled")&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
v.AFrameworkApplication.ta&&v.AFrameworkApplication.ta.Pb.nq&&(ic=[],Array.add(ic,this.qEl()),ic=Object.assign(new Aa.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:ic}),Array.add(ub.MenuSectionList,ic));v.AFrameworkApplication.ta&&v.AFrameworkApplication.ta.Pb.nq?Ba.MenuItems=ub:Ba.PopulationXML=Nb.q(ub);return!0}Udg(Ba){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ba=Ba.MenuItemId;if(!Ba)return!1;const ub=this.settings.IMc(Ba);if(!this.xph(Ba,ub,
!0))return!1;this.lAm(ub);return!0}txn(){const Ba=this.ysl();this.hya.S2n(Ba);this.cTd&&1<=this.hya.okb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.cTd=!1);this.oAe=!0}Eba(){this.iwe||(window.setTimeout(()=>{this.A7d();this.iwe=!1},3E3),this.iwe=!0)}ysl(){let Ba;Ba=this.xsl()||[];for(const ub of Ba)this.bPn(ub);return Ba}bPn(Ba){Ba.clientId||(Ba.clientId=O.a.create().toString());Ba.userName||(Ba.userName="Anonymous user");Ba.capabilities||(Ba.capabilities=
new Ma.a);Ba.color||(Ba.color="#cccccc");Ba.yPa||(Ba.yPa=0)}Nco(Ba){const ub=[];Array.addRange(ub,Ba);ub.sort(fb.obn);return ub}HAn(){v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.eHe&&(v.AFrameworkApplication.ya.Z6(ab.a.Uth)&&gb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||v.AFrameworkApplication.ya.gb(ab.a.Uth,Rb.a.frame,Object(e.a)(this,this.U1m,"onCoauthorGalleryFirstRender"),96));this.IAn();this.eHe=
!0;this.A7d()}U1m(Ba,ub,ic,Hc,Vb){this.yOe.QU(Vb.RenderTime);return 32}get gij(){return this.yOe.task}A7d(){if(!this.eHe&&(this.yOe.QU((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.jhi))return;this.txn();this.jhi&&this.cTd?v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Xa.a.obc("ribbon","coauthorGallery"):
(v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Xa.a.jwa("ribbon","coauthorGallery"),Xa.a.n3a("ribbon","coauthorGallery")),this.uxn())}dispose(){this.KC&&(this.KC.VXf(Object(e.a)(this,this.Eba,"onUsersUpdated")),this.KC=null)}static obn(Ba,ub){return Ba.capabilities.uDa(1)&&ub.capabilities.uDa(1)||!Ba.capabilities.uDa(1)&&!ub.capabilities.uDa(1)?Va.a.localeCompare(Ba.userName,ub.userName):Ba.capabilities.uDa(1)?
-1:1}}Object(l.a)(fb,"APeoplesWell",null,[919,9]);var bb=c(14);const Ub=()=>!0;class Oa extends fb{constructor(Ba,ub,ic=null,Hc=null){super(Ba,ic,Hc);this.omm=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,()=>this.CSd(),Ub);this.Bqn=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Sf=>this.Aqn(Sf),Ub);this.ain=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Ub,Sf=>this.$hn(Sf));this.sJk=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Ub,Ub);this.rJk=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Ub,Ub);this.jDo=(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Ub,Sf=>this.Udg(Sf));this.Wfn=
(Vb,Ud,Cc,Te,Ne)=>this.A0a(Cc,Ne,Ub,()=>{this.A7d();return!0});this.ga=ub}A0a(Ba,ub,ic,Hc){let Vb=!1;switch(Ba){case 1:Vb=ic(ub);break;case 2:Vb=Hc(ub)}return Vb?32:8}IAn(){this.ga.pa(this.settings.Rtd,bb.a.application,this.omm);this.ga.gb(this.settings.Vtd,bb.a.application,this.Bqn,96);this.ga.gb(this.settings.Ttd,bb.a.application,this.sJk,96);this.ga.gb(this.settings.Std,bb.a.application,this.rJk,96);this.ga.gb(this.settings.Utd,bb.a.application,this.ain,96);this.ga.pa(this.settings.Xtd,bb.a.application,
this.jDo);this.ga.gb(this.settings.GRe,bb.a.application,this.Wfn,96)}}Object(l.a)(Oa,"ABox4PeoplesWell",fb,[]);var Fc=c(3),xc=c(54),pd=c(10),lb=c(36),Tb=c(180);class pc{static isSupported(Ba){for(let ub=0;ub<pc.Rfj.length;ub++)if(Ba===pc.Rfj[ub])return!0;return!1}}pc.Rfj=[1];Object(l.a)(pc,"RTTDataVersion",null,[]);var Db=c(1578);const Ob=Ba=>{if("number"!==typeof Ba.RK||"number"!==typeof Ba.DK)return!1;let ub,ic=!1,Hc=!1,Vb=!1;switch(Ba.RK){case 0:Hc=ub=!0;break;case 1:Vb=ic=Hc=ub=!0;break;case 2:if(null!=
Ba.PE&&"number"!==typeof Ba.PE)return!1;ub=!0;break;case 4:ub=!0;break;case 3:Hc=ub=!0;break;case 5:ic=ub=!0;break;default:return!1}return ub&&("number"!==typeof Ba.PS||"number"!==typeof Ba.TS)||Hc&&("object"!==typeof Ba.OS||!Ba.OS||!Db.validateVersionedCpData(Ba.OS))||ic&&("number"!==typeof Ba.PE||"number"!==typeof Ba.TE)||Vb&&("object"!==typeof Ba.OE||!Ba.OE||!Db.validateVersionedCpData(Ba.OE))?!1:!0},jb=Ba=>{let ub="";if("number"!==typeof Ba.I)return{returnValue:!1,Tfa:"Invalid PacketId Type"};
if("number"!==typeof Ba.O)return{returnValue:!1,Tfa:"Invalid Operation Type"};if("string"!==typeof Ba.A)return{returnValue:!1,Tfa:"Invalid ClientId Type"};if("object"!==typeof Ba.AN)return{returnValue:!1,Tfa:"Invalid Anchor Object Type"};if(!Ba.AN)return{returnValue:!1,Tfa:"Null AnchorObject"};if(!Ob(Ba.AN)){let ic;try{ic=V.c(Ba.AN)}catch(Hc){ic=String.format("Failed to JSON-serialize payload : {0}",Hc)}8E3<ic.length&&(ic=String.format("Payload exceeds maximum length: {0} > {1}, not logging",ic.length,
8E3));ub="Invalid AnchorObject: "+ic+", Client: "+Ba.C;return{returnValue:!1,Tfa:ub}}return!Ba.O&&Ba.AN.RK?(ub="Invalid RangeKind:"+Ba.AN.RK+" for Caret",{returnValue:!1,Tfa:ub}):2===Ba.O&&("number"!==typeof Ba.TF||"undefined"!==typeof Ba.TX&&"string"!==typeof Ba.TX||1!==Ba.AN.RK&&Ba.AN.RK)?{returnValue:!1,Tfa:"Invalid TypingData"}:3!==Ba.O||"object"===typeof Ba.AP&&Ba.AP&&"number"===typeof Ba.AP.TFA&&"number"===typeof Ba.AP.PN&&"number"===typeof Ba.AP.TN&&2===Ba.AN.RK?6!==Ba.O||"object"===typeof Ba.MP&&
Ba.MP&&"number"===typeof Ba.MP.PM&&"number"===typeof Ba.MP.TM&&5===Ba.AN.RK?4!==Ba.O||"object"===typeof Ba.SP&&Ba.SP&&"number"===typeof Ba.SP.PA&&"number"===typeof Ba.SP.TA&&"number"===typeof Ba.SP.PB&&"number"===typeof Ba.SP.TBS&&3===Ba.AN.RK&&(Ba.AN.PS===Ba.SP.PA||Ba.AN.PS===Ba.SP.PB)?7!==Ba.O||"object"===typeof Ba.SPS&&Ba.SPS&&"string"===typeof Ba.SPS.SF&&"boolean"===typeof Ba.SPS.SL?null!=Ba.ISS&&"number"!==typeof Ba.ISS?{returnValue:!1,Tfa:"invalid StrictlySequentialId"}:{returnValue:!0,Tfa:ub}:
{returnValue:!1,Tfa:"Invalid SymbolData"}:{returnValue:!1,Tfa:"Invalid SplitParaData"}:{returnValue:!1,Tfa:"Invalid RemoveParaData"}:{returnValue:!1,Tfa:"Invalid AddParaData"}};var tb=c(1550);class ac{constructor(Ba,ub=null,ic=null){this.h0=this.cPf=this.l$f=null;null!=Ba&&(this.l$f=Ba);null!=ub&&(this.cPf=ub);null!=ic&&(this.h0=ic)}}Object(l.a)(ac,"AddParaData",null,[]);class zc{constructor(Ba=null,ub=null){this.Bic=this.bPf=null;null!=Ba&&(this.bPf=Ba);null!=ub&&(this.Bic=ub)}}Object(l.a)(zc,"MergeRemoveParaData",
null,[]);class yc{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc=null,Te=null,Ne=null,Sf=null,Ie=null,pg=null,ak=0,nn=null){this.h5c=this.text=this.PNb=this.iNb=this.bVc=this.aZb=this.Iia=null;this.packetId=Ba;this.client=ic;this.qt=Hc;this.clientId=ub.toLowerCase();this.vS=Vb;this.version=ak;Ud&&(this.Iia=Ud);null!=Cc&&(this.PNb=Cc);void 0!==Te&&null!==Te&&(this.text=Te);Ne&&(this.aZb=Ne);Sf&&(this.bVc=Sf);Ie&&(this.iNb=Ie);pg&&(this.h5c=pg);this.strictlySequentialId=nn}}Object(l.a)(yc,"RTTData",null,[]);class cd{constructor(Ba=
null,ub=null,ic=null,Hc=null){this.k$f=this.aPf=this.h$f=this.$Of=null;null!=Ba&&(this.$Of=Ba);null!=ub&&(this.h$f=ub);null!=ic&&(this.aPf=ic);null!=Hc&&(this.k$f=Hc)}}Object(l.a)(cd,"SplitParaData",null,[]);class Cd{constructor(Ba=null,ub=null){this.R8f=this.Q8f=null;Ba&&(this.Q8f=Ba);null!=ub&&(this.R8f=ub)}}Object(l.a)(Cd,"SymbolData",null,[]);class ud{constructor(Ba,ub=null,ic=null){null!=Ba&&(this.TFA=Ba);null!=ub&&(this.PN=ub);null!=ic&&(this.TN=ic)}}Object(l.a)(ud,"SerializableAddParaDataV1",
null,[]);class $d{constructor(Ba=null,ub=null){null!=Ba&&(this.PM=Ba);null!=ub&&(this.TM=ub)}}Object(l.a)($d,"SerializableMergeRemoveParaDataV1",null,[]);class gc{}Object(l.a)(gc,"SerializableRTTDataV1",null,[]);class kc{constructor(Ba=null,ub=null,ic=null,Hc=null){null!=Ba&&(this.PA=Ba);null!=ub&&(this.TA=ub);null!=ic&&(this.PB=ic);null!=Hc&&(this.TBS=Hc)}}Object(l.a)(kc,"SerializableSplitParaDataV1",null,[]);class Wc{constructor(Ba=null,ub=null){Ba&&(this.SF=Ba);null!=ub&&(this.SL=ub)}}Object(l.a)(Wc,
"SerializableSymbolDataV1",null,[]);const td=Ba=>{var ub;if(!({Tfa:ub}=jb(Ba)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",ub),null;let ic=ub=null,Hc=null,Vb=null,Ud=null,Cc=null,Te=null,Ne=null;Ba.WD&&(ub=Ba.WD);null!=Ba.TF&&(ic=Ba.TF);void 0!==Ba.TX&&null!==Ba.TX&&(Hc=Ba.TX);Ba.AP&&(Vb=new ac(Ba.AP.TFA,Ba.AP.PN,Ba.AP.TN));Ba.MP&&(Ud=new zc(Ba.MP.PM,Ba.MP.TM));Ba.SP&&(Cc=new cd(Ba.SP.PA,Ba.SP.TA,Ba.SP.PB,Ba.SP.TBS));Ba.SPS&&(Te=new Cd(Ba.SPS.SF,
Ba.SPS.SL));null!=Ba.ISS&&(Ne=Ba.ISS);return new yc(Ba.I,Ba.A,Ba.C,Ba.O,tb.a(Ba.AN),ub,ic,Hc,Vb,Ud,Cc,Te,1,Ne)},Fe=Ba=>{let ub=Ba;if("number"===typeof ub.V){if(1===ub.V)return td(Ba);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let ic=0,Hc=null;for(let Vb=0;Vb<Ba.length;Vb++)ub=Ba[Vb],pc.isSupported(ub.V)&&ub.V>ic&&(ic=ub.V,Hc=Ba[Vb]);return 1===ic?td(Hc):null},Cf=Ba=>{if(Ba){const ub=new gc;ub.I=Ba.packetId;ub.V=1;ub.A=Ba.clientId;ub.C=Ba.client;ub.O=Ba.qt;ub.AN=tb.c(Ba.vS);
Ba.Iia&&(ub.WD=Ba.Iia);null!=Ba.PNb&&(ub.TF=Ba.PNb);void 0!==Ba.text&&null!==Ba.text&&0<Ba.text.length&&(ub.TX=Ba.text);Ba.aZb&&(ub.AP=new ud(Ba.aZb.l$f,Ba.aZb.cPf,Ba.aZb.h0));Ba.bVc&&(ub.MP=new $d(Ba.bVc.bPf,Ba.bVc.Bic));Ba.iNb&&(ub.SP=new kc(Ba.iNb.$Of,Ba.iNb.h$f,Ba.iNb.aPf,Ba.iNb.k$f));Ba.h5c&&(ub.SPS=new Wc(Ba.h5c.Q8f,Ba.h5c.R8f));ub.ISS=Ba.strictlySequentialId;Ba=ub}else Ba=null;return Ba};var ie=c(61);class Ae{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){this.LocalCobaltSessionId=Ba;this.SkypeChatThreadId=
ub;this.ChatThreadDiscoveryUri=ic;this.InChat=Hc;this.Capabilities=Vb;this.Email=Ud;this.UserName=Cc;this.IsAnonymous=Te;this.PresenceStatus=Ne}}Object(l.a)(Ae,"SerializableWacData",null,[]);class xe{constructor(){this.Aqd=this.zqd=0}oLl(){this.Aqd===Number.MAX_VALUE&&(this.Aqd=0);this.Aqd++;return this.Aqd}nLl(){this.zqd===Number.MAX_VALUE&&(this.zqd=0);this.zqd++;return this.zqd}static get instance(){return xe.n3j}}xe.n3j=new xe;Object(l.a)(xe,"StrictlySequentialIdGenerator",null,[273]);var ng=
c(1484);class Af{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te=0){this.Ira=null;this.dryDeletion=0;this.aI=Ba;this.mKa=Ud;this.ud=Vb;this.ixb=Cc;this.Pc=ub;this.shapeId=Te;this.CFa=ic;this.q8=Cc.create(this,Hc,Vb,Ud)}clone(){return new Af(this.aI,this.Pc,this.CFa,this.q8.hpb,this.ud,this.mKa,this.ixb,this.shapeId)}get paragraphId(){return this.Ira?this.Ira:this.aI.Bgb(this.Pc)}OMf(){this.Ira||(this.Ira=this.paragraphId,this.q8.OMf())}isValid(){return 0<=this.q8.cp}getData(){const Ba=this.q8.hpb;return Ba?new ng.a(0,
this.Pc,this.CFa,Ba,null,null,null,0,this.shapeId):null}static Czb(Ba,ub,ic,Hc,Vb){return ub?new Af(ub,parseInt(Ba.FQa),Ba.f6a,Ba.KQ,ic,Hc,Vb,Ba.shapeId):null}}Object(l.a)(Af,"WordPresenceIp",null,[270,104,271]);class De{constructor(Ba,ub,ic){this.hSa=this.$aa=this.Xtc=!1;this.kab=Ba;this.gVa=ic;this.user=ub}get ip(){return this.gVa}get wac(){return this.Xtc}set wac(Ba){(this.Xtc=Ba)&&this.ip.OMf()}umf(){const Ba=xe.instance.nLl();return new yc(this.kab,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new Ae(this.user.zQ,this.user.ZCc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ba)}ZXh(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():ie.a.nil.toString())}isValid(){const Ba=!!this.user&&this.user.isValid(),ub=!this.ip||this.ip.isValid();return Ba&&ub}clone(){const Ba=new De;Ba.kab=this.kab;Ba.Xtc=this.Xtc;
Ba.user=this.user?this.user.clone():null;Ba.gVa=this.ip?this.ip.clone():null;Ba.$aa=this.$aa;Ba.hSa=this.hSa;return Ba}static p4e(Ba,ub,ic,Hc,Vb){if(!Ba||!ub)return null;if(Ba.qt)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Ba.qt),null;let Ud;Ud=void 0!==Ba.Iia&&null!==Ba.Iia?Qa.Czh(Ba.clientId,Ba.Iia.UserName,Ba.Iia.Capabilities,Ba.Iia.LocalCobaltSessionId,Ba.Iia.SkypeChatThreadId,Ba.Iia.Email,Ba.client,Ba.Iia.ChatThreadDiscoveryUri,Ba.Iia.InChat,
!1,Ba.Iia.IsAnonymous,Ba.Iia.PresenceStatus):Qa.Czh(Ba.clientId,null,0,void 0,void 0,void 0,Ba.client);return new De(Ba.packetId,Ud,Af.Czb(Ba.vS,ub,ic,Hc,Vb))}}Object(l.a)(De,"WordPresenceInfo",null,[262,104]);class Rf extends Oa{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak,nn){super(Ba,Ud,nn,ub);this.uGj=ic;this.O0j=Hc;this.n_j=Vb;this.ib=Cc;Rf.Ht=Te;this.aI=Ne;this.ud=Sf;this.mKa=Ie;this.iRe=pg;this.oIa=ak}Udg(Ba){this.oIa.$pi(Ba.CommandValueId);return super.Udg(Ba)}lAm(Ba){let ub;({JRf:ub}=
this.Cxf(Ba)).returnValue&&(this.O0j(ub.ip.paragraphId,ub.ip.q8.cp),v.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Ba=Rf.ATl(ub),void 0!==Ba&&null!==Ba?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.setSelection(Ba),ob.FocusManager.zJ()&&ob.FocusManager.instance().Dg(fc.AFrame.So)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ba=new X.a(2,1,0,
()=>{this.ga.Ub(Fc.a.zce,2,ub)}),Eb.a.instance.Xb(Ba))}e2h(Ba){return Ba?(Ba=De.p4e(Fe(Ba),this.aI,this.ud,this.mKa,this.iRe.instance))&&Ba.isValid()&&Ba.ip?Ba:null:null}sAk(Ba){return this.Ztm(Ba)?this.IAk(Ba)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}Ztm(Ba){return!!this.e2h(Ba)}Cxf(Ba){Ba=this.e2h(Ba);return{returnValue:!!Ba,
JRf:Ba}}IAk(Ba){let ub;return({JRf:ub}=this.Cxf(Ba)).returnValue?this.uGj(ub.ip.paragraphId,ub.ip.q8.cp):!1}xsl(){if(!this.KC)return[];const Ba=[];for(const ub of this.KC.A_a())ub.userName?Ba.push(ub):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Ba}HPk(Ba){let ub;return({JRf:ub}=this.Cxf(Ba)).returnValue&&ub.user&&ub.user.presenceStatus&&"0"!==ub.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,ub.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}uxn(){this.n_j(this.settings.id)}static createInstance(Ba,
ub,ic,Hc,Vb,Ud,Cc){const Te=sb.App.xa.jb,Ne=v.AFrameworkApplication.ya,Sf=xc.a.instance,Ie=Na.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Rf(Ba,ub,pg=>Te.wc.mi?Te.wc.NZe(pg,!0):!1,(pg,ak)=>{Te.wc.mi&&Te.wc.FLb(pg,ak,!0,!0)},()=>{sb.App.Bw.kI.m7c()},Ne,Sf,Te,ic,Hc,Vb,Ud,Ie,Cc)}static ATl(Ba){const ub=Rf.Ht.Yc.Bd.Db(Ba.ip.paragraphId);if(void 0===ub||null===ub)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!pd.ParagraphReader.ic(ub))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Ba=lb.a.Uc(ub,Ba.ip.q8.cp);return new Tb.Selection([Ba],!0)}}Rf.Ht=null;Object(l.a)(Rf,"WordEditorPeoplesWell",Oa,[]);class Je{constructor(){this.rx=()=>{v.AFrameworkApplication.nLi?Je.IRa.GI().continueWith(this.eXc):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.eXc=()=>{Je.pj=Je.IRa.GI().result;if(Je.pj){var Ba=()=>{const ub=sb.App.xa.jb;return ub?ub.Yc?ub.Yc.Bd:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};sb.App.Lma().continueWith(()=>{const ub=sb.App.Lma().result.mj,ic=Wa.CuiHelper.POl(v.AFrameworkApplication.Cr,v.AFrameworkApplication.Cr,v.AFrameworkApplication.Cr,v.AFrameworkApplication.Cr),Hc=Ya.createInstance(ic,ub,Object(e.a)(Je.pj.E9d,Je.pj.E9d.IMc,"getUserPresence"),Object(e.a)(Je.pj.E9d,Je.pj.E9d.Pgb,"getUserStatusInfo"),v.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Na.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Rf.createInstance(Hc,Ta.a.sq(Je.W.Za("Common.IPeopleInfoProvider")),Je.W.Pa("WordEditor.ParagraphWordIdMapping"),Je.W.Pa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ba,Je.W.Za("WordEditor.Presence.IWordPresenceCpFactory"),Je.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();Je._instance=Na.a.instance.resolve("Common.IPeoplesWell");Je._instance.HAn();k.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}xc(Ba){Je.W=Ba}init(){v.AFrameworkApplication.K.lp(this.rx)}dispose(){Je._instance&&(Je._instance.dispose(),Je._instance=null)}static get IRa(){return null!=Je.Kvg?Je.Kvg:Je.Kvg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Je._instance=null;Je.W=null;Je.pj=null;Object(l.a)(Je,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var le=c(81),dh=c(146);class lj{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne=!1){this.F7a=null;this.rue=!0;this.DHe=this.Vl=this.lne=null;this.sa=new Ha.a;this.gKa=Ba;this.XY=ub;this.O0g=ic;this.dwc=Hc;this.HBg=Ud;lj.Gb=Vb;this.rZj=Cc;this.TY=Te;this.u_j=Ne;G.Task.WAA(ub,ic).continueWith(Object(e.a)(this,this.ecm,"initOnTaskReady"))}Tgk(Ba){this.sa.addHandler("u",Ba)}aRi(){this.sa.raiseEvent("u",null,this)}ecm(){this.XY.result&&this.O0g.result&&(this.Vl=
this.XY.result,this.DHe=this.O0g.result,this.Vl.RXa(Object(e.a)(this,this.Q3,"onPresenceUpdated")),this.lne=new X.a(2,2,this.HBg,Object(e.a)(this,this.svo,"updateAwayClientsTask"),88),lj.Gb.Xb(this.lne))}Q3(Ba,ub){(this.rue||this.Wtn(ub.Tpa))&&lj.Gb.e4(this.lne,0)}Wtn(Ba){for(let ic in Ba){var ub=this.dwc.ULd({key:ic,value:Ba[ic]});if(ub&&ub.clientId&&(ub=ub.clientId.toLowerCase(),(ub=this.F7a[ub]||this.F7a[ub.toUpperCase()])&&2===ub.status))return!0}return!1}svo(Ba){var ub=this.Vl.SJc();if(ub){var ic=
new Date,Hc=!1;if(this.rue){this.F7a=ub;this.rue=!1;var Vb=this.F7a;for(var Ud in Vb){ub=Ud;var Cc=Vb[Ud];Cc.B$b<ic&&(ic=Cc.B$b);2===Cc.status&&(Hc=!0,this.DHe.j0c(ub))}Hc&&this.aRi();lj.Gb.e4(Ba,this.W_h(ic))}else{Cc=new N.a;Ud=!1;var Te=this.F7a;for(Vb in Te){Te=Vb;if(!(Te in this.F7a)||this.gKa.clientId===Te)continue;var Ne=this.F7a[Te];const Sf=ub[Te];if(Ne&&Sf){Ne=Ne.status;const Ie=Sf.status;2===Ne&&1===Ie?(Cc.add(Te),k.ULS.sendTraceTag(38052609,392,50,Te+" returned from away")):1===Ne&&2===
Ie&&(Ud=Hc=!0,this.DHe.j0c(Te),k.ULS.sendTraceTag(38052610,392,50,Te+" went away"));1===Ie&&Sf.B$b<ic&&(ic=Sf.B$b)}}this.F7a=ub;lj.Gb.e4(Ba,this.W_h(ic));(0<Cc.count||Hc)&&this.aRi();0<Cc.count&&!this.u_j?(Ba=this.uwl(Cc),this.$mo(Ba)):Ba=new N.a;(Ud||0<Ba.count)&&this.rZj(ab.a.vzd,2)}}}$mo(Ba){if(Ba.count)for(let ub of Ba)Ba=this.TY.sla(String.format(CommonUIStrings.l_EditorsToastArriving,ub),!1),Ba.image=5,Ba.Xma="CoAuth_AuthorStatus_16x16x32",this.TY.BA(Ba)}uwl(Ba){const ub=this.Vl.RBb(),ic=new N.a;
for(let Hc in ub){const Vb={key:Hc,value:ub[Hc]};if(Ba.contains(Vb.key)){const Ud=this.dwc.ULd(Vb);Ud&&(ic.add(Ud.userName),Ba.remove(Vb.key))}}ic.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return ic}W_h(Ba){const ub=new Date;return Math.max(Ba.getTime()+this.HBg-ub.getTime(),0)}}lj.Gb=null;Object(l.a)(lj,"AwayManager",null,[]);var sh=c(789);class We{constructor(Ba=0){this.updates=Ba}get Xpf(){return 0!==this.updates}uDa(Ba){return!!(this.updates&Ba)}c5a(Ba){this.updates|=
Ba}toString(){if(this.uDa(0))return"none";const Ba=new N.a;this.uDa(1)&&Ba.add("user(s) joined");this.uDa(2)&&Ba.add("user(s) disconnected");this.uDa(4)&&Ba.add("user(s) updated");return Ba.toArray().join(", ")}}Object(l.a)(We,"UserUpdateEvent",null,[]);var Fh=c(29);class cc{constructor(Ba,ub,ic,Hc,Vb=null){this.sa=new Ha.a;this.LJ=this.pj=null;this.hXg=this.DXg=this.El=!1;this.iq=new Gb.a;Ba.continueWith(()=>{this.pj=Ba.result;this.pj.RXa(Object(e.a)(this,this.PGi,"onRtcPresenceUpdate"));this.pj.Esa(Object(e.a)(this,
this.OGi,"onRtcConnectionChange"));this.sdg(null,null)});ub.continueWith(()=>{this.LJ=ub.result;this.LJ.KXa(Object(e.a)(this,this.GWc,"onEditorsTableUpdated"))});Vb&&Vb.continueWith(()=>{Vb.result.Tgk(Object(e.a)(this,this.sdg,"updateUserStatus"));this.sdg(null,null)});this.wab=ic;this.dwc=Hc}get users(){return this.iq}pZb(Ba){this.sa.addHandler("UU",Ba)}VXf(Ba){this.sa.removeHandler("UU",Ba)}sdg(){if(this.pj){var Ba=!1,ub=this.pj.SJc();for(let Hc in ub){var ic=ub[Hc];const Vb=Hc;this.users.ub(Vb)&&
(ic=this.Ujj(ic),Ba=this.users.J(Vb).Zyb!==ic||Ba,this.users.J(Vb).Zyb=ic)}Ba&&(Ba=new We(4),this.C$d(Ba))}}Ujj(Ba){return 1===Ba.status?0:1}A_a(){this.users.count||(this.DXg||(Fh.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.DXg=!0),this.yin());const Ba=[];for(let ub of this.users)Array.add(Ba,ub.value);return Ba}yin(){if(this.pj){var Ba=this.pj.RBb();this.PEf(Ba)}if(this.LJ){Ba=this.LJ.KJc();for(const ub of Ba)ub.Id&&(Ba=this.GBh(ub.Id),this.rdg(new We,Ba))}}Yui(Ba){({value:Ba}=
this.users.Gc(Ba));return Ba}dispose(){this.El||(this.pj&&(this.pj.TKb(Object(e.a)(this,this.PGi,"onRtcPresenceUpdate")),this.pj.vec(Object(e.a)(this,this.OGi,"onRtcConnectionChange"))),this.LJ&&this.LJ.gWi(Object(e.a)(this,this.GWc,"onEditorsTableUpdated")),this.El=!0)}OGi(Ba,ub){2===ub.newState&&(Ba=this.PEf(this.pj.RBb()),Ba.Xpf&&this.C$d(Ba))}GWc(Ba,ub){Ba=new We;var ic=this.LJ.KJc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
ic.length,ub.N_m,ub.cAi);const Hc=new Gb.a;for(var Vb of ic){ic=Vb.Id;const Ud=this.GBh(ic);this.rdg(Ba,Ud);Hc.Z(ic,Ud)}if((ub=ub.leaving)&&0<ub.length)for(Vb=0;Vb<ub.length;Vb++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,ub.J(Vb).Id),({value:ic}=this.users.Gc(ub.J(Vb).Id)).returnValue?ic?(this.users.remove(ub.J(Vb).Id),Ba.c5a(2),Hc.Z(ub.J(Vb).Id,ic)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",ub.J(Vb).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",ub.J(Vb).Id);ub=this.pj.RBb();for(let Ud in ub)Vb=this.dwc.ULd({key:Ud,value:ub[Ud]}),Hc.Z(Vb.clientId,Vb);for(let Ud of this.users)Hc.ub(Ud.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Ud.key),this.users.remove(Ud.key),Ba.c5a(2));Ba.Xpf&&this.C$d(Ba)}PGi(Ba,ub){Ba=this.PEf(ub.Tpa);for(const ic of ub.LDd)this.users.ub(ic)&&(Ba.c5a(2),this.users.J(ic).Zyb=
2);Ba.Xpf&&this.C$d(Ba)}PEf(Ba){const ub=new We;if(!Ba)return ub;for(let Hc in Ba){var ic=this.dwc.ULd({key:Hc,value:Ba[Hc]});ic&&(ic=ic.clone(),this.rdg(ub,ic))}return ub}rdg(Ba,ub){if(ub){var ic=ub.clientId;var Hc=this.vLn(ub);({value:ub}=this.users.Gc(ic)).returnValue?ub.equals(Hc)||(Ba.c5a(4),this.users.Z(ic,Hc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,ic),Ba.c5a(1),this.users.Z(ic,Hc))}}GBh(Ba){return this.users.ub(Ba)?this.users.J(Ba):
fa.a.pTk(Ba)}vLn(Ba){if(!Ba||!Ba.clientId||!this.LJ)return Ba;const ub=Ba.clone();ub.Zyb=this.twl(Ba);if(Ba=this.LJ.C4b(ub.clientId))ub.isReadOnly=ub.isReadOnly||Ba.IsReadOnly?!0:!1,ub.userName=this.tLn(ub,Ba),ub.capabilities=this.dUm(ub.capabilities,Ba.Capabilities),ub.email=ub.email||Ba.SIPAddress||Ba.EmailAddress,Ba.JoinCoauthTime&&(ub.yPa=Ba.JoinCoauthTime);ub.color=this.wab.HMc(new sh.a(ub.email,void 0,ub.userName,void 0,ub.isAnonymous,ub.clientId),3);return ub}twl(Ba){if(!this.pj)return 2;if(Ba&&
Ba.clientId){const ub=this.pj.SJc();if(Ba.clientId in ub)return this.Ujj(ub[Ba.clientId])}return 2}aLk(Ba,ub){ub.Name&&Ba.userName&&ub.Name!==Ba.userName&&!this.hXg&&(this.hXg=!0,Fh.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}dUm(Ba,ub){Ba=Ba||new Ma.a;ub&&(ub.SupportsRealtimeChannel&&Ba.c5a(1),ub.SupportsRename&&Ba.c5a(2),ub.SupportsChat&&Ba.c5a(4));return Ba}tLn(Ba,ub){this.aLk(Ba,ub);return ub.Name||Ba.userName||(Ba.isAnonymous||ub.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}C$d(Ba){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Ba.toString());this.sa.raiseEvent("UU")}}Object(l.a)(cc,"PeopleInfoProvider",null,[938,9]);var tc;(function(Ba){Ba[Ba.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ba[Ba.peopleImageClassName=1]="peopleImageClassName";Ba[Ba.peopleImageClusterPath=4]="peopleImageClusterPath";Ba[Ba.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ba[Ba.imageDimension=6]="imageDimension";
Ba[Ba.rtl=8]="rtl";Ba[Ba.pointerInputManager=9]="pointerInputManager";Ba[Ba.clickInputManager=10]="clickInputManager";Ba[Ba.vertical=11]="vertical";Ba[Ba.zIndex=12]="zIndex";Ba[Ba.contextMenuInputManager=13]="contextMenuInputManager";Ba[Ba.imageDomElement=14]="imageDomElement";Ba[Ba.useIdleTooltip=15]="useIdleTooltip";Ba[Ba.viewportBoundsCallback=16]="viewportBoundsCallback";Ba[Ba.flipHorizontalDirection=17]="flipHorizontalDirection";Ba[Ba.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Ba[Ba.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Ba[Ba.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(tc||(tc={}));Object(l.b)("PresenceTooltipSettingKeys",tc);class bd{constructor(){this.yq={}}get(Ba,ub=null){Ba=tc[Ba];return"number"===typeof ub?(ub=this.yq[Ba])?Number.parseInvariant(ub.toString()):0:this.yq[Ba]}add(Ba,ub){this.yq[tc[Ba]]=ub}GLa(Ba,ub){tc[Ba]in this.yq||(this.yq[tc[Ba]]=ub)}remove(Ba){delete this.yq[tc[Ba]]}}Object(l.a)(bd,"PresenceTooltipSettings",null,
[]);class vd extends Ha.a{constructor(Ba){super();this._element=null;this.element=Ba}get element(){return this._element}set element(Ba){this._element=Ba}get visible(){return"visible"===this.element.style.visibility}set visible(Ba){this.element.style.visibility=Ba?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ba){this.element.dir=Ba?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ba){this.element.style.zIndex=String(Ba)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ba){return this.element.ownerDocument.createElement(Ba)}bia(){return!0}static UAh(Ba){return"prControl"+(Ba?"Rtl":"")}}Object(l.a)(vd,"BasePresenceControl",Ha.a,[9,946]);class Tc extends Sys.EventArgs{constructor(Ba,ub){super();this.type=Ba;this.Jo=ub}}Tc.KT="InteractivityChanged";Object(l.a)(Tc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class nb{static Fzl(Ba){return nb.Gzl(Ba)}static Gzl(Ba){const ub=
document.createElementNS(nb.Tfg,"svg");ub.setAttribute("viewBox",String.format(nb.XZk,nb.Csj,nb.Bsj));ub.appendChild(nb.zVl(Ba));return ub}static zVl(Ba){const ub=nb.Csj/Ba,ic=2*ub,Hc=nb.Bsj/2;Ba=(Ba-12-8)*ub/2;const Vb=document.createElementNS(nb.Tfg,"g");Sys.UI.DomElement.addCssClass(Vb,nb.WZk);for(let Ud=1;3>=Ud;Ud++)Vb.appendChild(nb.gwl(Ud,ic,Ba+(6*Ud-2)*ub,Hc));return Vb}static gwl(Ba,ub,ic,Hc){const Vb=document.createElementNS(nb.Tfg,"circle");Sys.UI.DomElement.addCssClass(Vb,String.format("{0}-{1}",
nb.NEk,Ba));Vb.setAttribute("cx",String.format("{0}",ic));Vb.setAttribute("cy",String.format("{0}",Hc));Vb.setAttribute("r",String.format("{0}",ub));return Vb}}nb.Tfg="http://www.w3.org/2000/svg";nb.WZk="prDancingDots";nb.NEk="prAnimateCircle";nb.XZk="0 0 {0} {1}";nb.Bsj=40;nb.Csj=120;Object(l.a)(nb,"ModernPresenceTooltipDancingDots",null,[]);var Fb=c(90),Kc=c(95),sc=c(6),Oc=c(23),Ke=c(117),Re=c(49);class lf extends vd{constructor(Ba,ub){super(Ba);this.r$g=this.s9a=this.Uoe=this._img=this.ND=this.Rr=
this.qg=null;this.QKa=ub.get(8,!1);this.$8a=ub.get(6,0);this.E6j=ub.get(15,!1);this.Pd=ub;this.JJg=0;this.element=Ba;this.element.className=lf.Kdf;this._span=document.createElement("span");this.element.appendChild(this._span);this.uKj=nb.Fzl(ub.get(6,0));this.fB(ub);this._state=5}Hxb(Ba){this.addHandler(Tc.KT,Ba)}QKb(Ba){this.removeHandler(Tc.KT,Ba)}get user(){return this.r$g}get state(){return this._state}dispose(){this.element&&(this.qg.sc(sc.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.qg.sc(sc.a.IA,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),this.Rr.sc(sc.a.pointerDown,this.element,Object(e.a)(this,this.fC,"onPointerDown")),this.Rr.sc(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut")),this.Rr.sc(sc.a.pointerOver,this.element,Object(e.a)(this,this.RX,"onPointerOver")),this.ND.sc(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}fB(Ba){this.qg=Ba.get(10);this.qg.mb(sc.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.qg.mb(sc.a.IA,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior"));this.Rr=Ba.get(9);this.Rr.mb(sc.a.pointerOver,this.element,Object(e.a)(this,this.RX,"onPointerOver"));this.Rr.mb(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut"));this.Rr.mb(sc.a.pointerDown,this.element,Object(e.a)(this,this.fC,"onPointerDown"));this.ND=Ba.get(13);this.ND.mb(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior"))}hide(Ba=
null,ub=0,ic=0){this.E6j&&Ba?this.A$n(Ba,ub,ic):(3===this.state&&this.PUi(),this.visible=!1,this._state=5)}A$n(Ba,ub,ic=0){this.show(Ba,ub,15,4,void 0,ic)}Jaj(Ba,ub,ic=!1,Hc=!1,Vb=!1,Ud=0){this.show(Ba,ub,20,ic?2:Hc?1:0,Vb,Ud)}$9n(Ba,ub,ic,Hc=!1,Vb=0){this.show(Ba,ub,ic+20,3,Hc,Vb)}show(Ba,ub,ic,Hc=3,Vb=!1,Ud=0){!Ba||Hc===this.state&&this.U6l(ub,ic)||(this.U9j(Hc,Vb,Ud),this.jea(Ba,Hc,Ud),this._state=Hc,4===Ud||0===Ud&&!this.QKa?this.element.style.left=ub+"px":this.element.style.right=ub+"px",this.element.style.top=
ic+"px",this.visible=!0)}jea(Ba,ub,ic){this.r$g=Ba;Re.a.FA(this._span);Ke.a.tGk(this._span);this._span.id="fly_"+Ba.clientId;this._span.style.backgroundColor=Ba.color;4!==ub?(this._span.style.height=this.$8a+"px",this._span.style.lineHeight=this.$8a+"px",Ke.a.vgc(this._span,"border-radius",this.$8a+"px")):4===ic||0===ic&&!this.QKa?this._span.style.left="0px":this._span.style.right="0px";2!==ub&&(4===ub?Re.a.oy(this._span,""):1===ub?this._span.appendChild(this.uKj):(this._span.setAttribute("dir","auto"),
ic=Va.a.CGl(Ba.userName),(!Ba.isAnonymous||v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&ic||0!==ub?(Ba=Ba.userName,0===ub&&(Ba=ic,Ke.a.vgc(this._span,"text-align","center")),Re.a.oy(this._span,Ba)):(this._img||(this._img=this.hRk()),this._span.appendChild(this._img),Ke.a.vgc(this._span,"text-align","start"))))}onClick(Ba){if(0===this.state)return this.raiseEvent(Tc.KT,new Tc(1,Ba)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}oO(Ba){3===this.state&&this.raiseEvent(Tc.KT,new Tc(3,Ba));return!1}RX(Ba){3!==Ba.og&&this.raiseEvent(Tc.KT,new Tc(2,Ba));return!1}fC(Ba){if(3!==Ba.og)return!0;this.raiseEvent(Tc.KT,new Tc(4,Ba));return!1}hRk(){const Ba=document.createElement("img");Ba.src=Fb.a.T$("doughperson_white_glyph.svg");Ba.setAttribute("Unselectable","on");Oc.a.Tq(Ba,Oc.a.wh,Oc.a.My);return Kc.createClusteredImageFromClusterWithImageClass(this.$8a,this.$8a,null,null,lf.rml,
"",!1,"",this.element.ownerDocument,Ba)}U9j(Ba,ub=!1,ic=0){if(!this.fQc(this.state)||!this.fQc(Ba))switch(Sys.UI.DomElement.removeCssClass(this.element,this.Uoe),this.state){case 4:3===Ba?this.IXa(lf.Ldf,lf.hPh):this.fQc(Ba)&&this.IXa(lf.Jdf,lf.hPh);break;case 3:4===Ba?this.IXa(lf.Odf,lf.gPh):this.fQc(Ba)&&(ub&&this.PUi(),this.IXa(lf.Jdf,lf.gPh,ub?lf.qml:""));break;case 0:case 1:case 2:4===Ba?this.IXa(lf.Odf,lf.Mdf):3===Ba&&(ub&&this.aak(),this.IXa(lf.Ldf,lf.Mdf,ub?lf.iPh:"",3===ic?lf.uml:lf.sml));
break;default:4===Ba?this.IXa(lf.Odf):3===Ba?this.IXa(lf.Ldf):this.fQc(Ba)&&this.IXa(lf.Jdf)}}IXa(...Ba){this.Uoe=Ba.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.Uoe)}aak(){this.JJg=window.setTimeout(()=>{this.element&&(this.s9a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.s9a),this.element.style.zIndex="2",this.s9a.style.zIndex="1")},300)}PUi(){window.clearTimeout(this.JJg);this.s9a&&(Sys.UI.DomElement.removeCssClass(this.s9a,lf.Mdf+" "+lf.iPh),Sys.UI.DomElement.addCssClass(this.s9a,
lf.pml),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.s9a.parentNode&&this.element.parentNode.removeChild(this.s9a)}),Ke.a.tec(this.element,"z-index"))}fQc(Ba){return 0===Ba||1===Ba||2===Ba}U6l(Ba,ub){const ic=Ke.a.VX(this.element.style.top);return Ke.a.VX(this.element.style.left)===Ba&&ic===ub}eZf(Ba){3===Ba&&Ke.a.N$(this.element,"left")?(Ba=Ke.a.VX(this.element.style.left),Ke.a.tec(this.element,"left"),this.element.style.right=-1*Ba+"px"):4===Ba&&Ke.a.N$(this.element,
"right")&&(Ba=Ke.a.VX(this.element.style.right),Ke.a.tec(this.element,"right"),this.element.style.left=-1*Ba+"px")}}lf.Kdf="prModernFlyout UIFont";lf.Odf="flyoutIdle";lf.Ldf="flyoutExpanded";lf.Jdf="flyoutCollapsed";lf.hPh="flyoutFromIdle";lf.gPh="flyoutFromExpanded";lf.Mdf="flyoutFromCollapsed";lf.iPh="flyoutStacked";lf.qml="flyoutFromStacked";lf.pml="flyoutFadeOut";lf.rml="cui-img-cont-float cui-img-20by20";lf.sml="flyoutLtrDir";lf.uml="flyoutRtlDir";Object(l.a)(lf,"ModernPresenceTooltipFlyoutControl",
vd,[]);class Jh{constructor(Ba,ub,ic=2,Hc=4){this.offsetTop=Ba;this.offsetLeft=ub;this.zsj=ic;this.Qai=Hc}}Object(l.a)(Jh,"FlyoutsPositioningInfo",null,[]);var zg=c(35);class Kd{constructor(Ba=!1,ub=!1){this.Sl=Ba;this.Aue=ub}RHl(Ba,ub,ic,Hc,Vb){const Ud=Vb.y,Cc=Vb.height;var Te=this.Bul(Hc);const Ne=Te+ub,Sf=Ba*ic+2*(Ba-1);ic=null;1===Ba||this.iAk(Te,Sf,Ud,Cc)?Ba=new Jh(0,0,2):(Ba=this.rdf(Ne,Sf,Ud,Cc),Ba.offsetTop-=Te);this.Aue?ic=new Jh(0,0,void 0,this.Sl?4:3):(Hc=this.Aul(Hc,Vb),Te=Math.max(0,
Vb.x),Vb=Vb.width,ub=Hc+ub,this.jAk(Hc,Te,Vb)?ic=new Jh(0,0,void 0,this.Sl?3:4):this.kAk(ub,Te)&&(ic=new Jh(0,0,void 0,this.Sl?4:3)),ic||(ic=this.Wkl(Hc,ub,Te,Vb)));return new Jh(Ba.offsetTop,ic.offsetLeft,Ba.zsj,ic.Qai)}Bul(Ba){return zg.a.zNa(Ba)}Aul(Ba,ub){return this.Sl?ub.width-zg.a.dTh(Ba):zg.a.xgf(Ba)}iAk(Ba,ub,ic,Hc){return Ba+ub<=ic+Hc}rdf(Ba,ub,ic,Hc){let Vb=1,Ud=Math.max(ic,Ba-ub);ub>Ba-ic&&(Vb=2,Ud=ub<Hc?Hc-ub:ic);return new Jh(Ud,0,Vb)}jAk(Ba,ub,ic){return Ba+150<=ub+ic}kAk(Ba,ub){return 150<=
Ba-ub}Wkl(Ba,ub,ic,Hc){Hc-ub>=Ba-ic?Ba=4:(ub=Ba,Ba=3);return new Jh(0,ub,void 0,Ba)}}Object(l.a)(Kd,"ModernPresenceTooltipPositioner",null,[]);class Td{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc){this.B9=Ba;this._parent=ub;this.pEg=ic;this.kHj=Hc;this.iPj=Vb;this.HXb=Ud;this.QKa=Cc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ba,ub){if(3!==Ba)if(5!==Ba&&this.B9&&this.B9.length){if(4===Ba){var ic=this.iPj;var Hc=(this.HXb-ic)/2;
this.element.style.height=this.HXb+"px";this.element.style.width=this.HXb+"px";Ba=Ke.a.VX(this.B9[0].element.style.top);ub=Ke.a.VX(this.QKa?this.B9[0].element.style.right:this.B9[0].element.style.left)}else ic=this.pEg,Hc=(this.HXb-ic)/2,this.element.style.height=this.HXb+"px",this.element.style.width=this.xwl()+2*Hc+"px",Ba=Ke.a.VX(this.B9[this.B9.length-1].element.style.top),ub=this.kzk(this.B9[this.B9.length-1].element,ic,ub);Ke.a.vgc(this.element,"border-radius",this.HXb+"px");this.element.style.top=
Ba-Hc-ic+"px";this.QKa?this.element.style.right=ub-Hc+"px":this.element.style.left=ub-Hc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}kzk(Ba,ub,ic){return this.QKa&&!ic?Ke.a.VX(Ba.style.right):this.QKa||ic?this.QKa&&ic?-Ke.a.VX(Ba.style.left)-ub:-Ke.a.VX(Ba.style.right)-ub:Ke.a.VX(Ba.style.left)}xwl(){return this.B9&&this.B9.length?this.pEg+Math.min(this.B9.length-1,2)*
this.kHj:0}}Object(l.a)(Td,"ModernPresenceTooltipTarget",null,[]);var Gd=c(141),rf=c(200);class hf extends vd{constructor(Ba,ub,ic){super(Ba);this.kWb=this.CJa=this.tOg=this.Rrb=!1;this.iq=[];this.Tfd={};this.Pd=ic;this.Sl=ic.get(8,!1);this.qNg=ic.get(15,!1);this.kJj=ic.get(12,0);this.Scb=ic.get(6,0);this.pbb=ub;this.M$g=ic.get(16);this.Aue=ic.get(17,!1);this.lPj=ic.get(19,!1);this.hZj=ic.get(20,!1);this.Qid=0;this.bZj=new Kd(this.Sl,this.Aue);this.zlc=this.FVh();this.Oub=!1;this.ZPb=[];this.rrc=
[];this.element.id=hf.Gfb();this.element.className=vd.UAh(this.Sl);this.yZa&&(this.zIndex=this.yZa);this.rtl=this.Sl;this.Q1f(ub);this.s5=this.createElement("div");this.s5.className="prFlyoutContainer";this.element.appendChild(this.s5);this.B9=[];this.T9a=new Td(this.U2,this.element,this.Scb,4,6,32,this.Sl);this.Rr=ic.get(9);this.Rr.mb(sc.a.pointerDown,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"));this.Rr.mb(sc.a.pointerOver,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"));
this.Rr.mb(sc.a.pointerOut,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"))}get U4d(){return rf.a.clone(this.iq)}get U2(){return this.B9}get yZa(){return this.kJj}get n_a(){return this.U2?this.U2.length:0}get $Nb(){return 0<this.n_a?this.U2[0].state:5}get pvf(){return 3===this.$Nb&&!this.Rrb}Hxb(Ba){this.addHandler(Tc.KT,Ba)}QKb(Ba){this.removeHandler(Tc.KT,Ba)}dispose(){if(this.pvf)this.Oub=!0;else{if(this.U2)for(const Ba of this.U2)Ba.QKb(Object(e.a)(this,this.rQa,"onInteractivityChanged")),
le.a.kB(Ba);this.B9=null;this.Rr.sc(sc.a.pointerDown,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"));this.Rr.sc(sc.a.pointerOver,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"));this.Rr.sc(sc.a.pointerOut,this.T9a.element,Object(e.a)(this,this.Lbc,"onHitTarget"));super.dispose()}}fhc(){this.B0b();this.visible=!0}T3c(){this.visible=!0;this.FLh();this.Rrb=!0}t5f(){this.T3c()}hide(){this.wVi();this.L0a();this.T9a.update(this.$Nb,this.kWb)}jea(Ba){const ub=this.$Nb,ic=this.Rrb;Ba.clientId||
(Ba.clientId=(hf.Nrc++).toString());if(Ba.clientId in this.Tfd){var Hc=this.xBb(Ba.clientId);if(0<=Hc){Hc=this.iq[Hc];if(Hc.color===Ba.color&&Hc.userName===Ba.userName)return;this.z4a(Ba.clientId)}}this.hide();Hc=new lf(this.createElement("div"),this.Pd);Hc.Hxb(Object(e.a)(this,this.rQa,"onInteractivityChanged"));this.s5.insertBefore(Hc.element,this.s5.firstChild);this.Tfd[Ba.clientId]=Hc;Array.add(this.iq,Ba);Array.add(this.U2,Hc);this.Lqj(ub,ic);this.visible=!0}z4a(Ba){if(this.pvf)Array.add(this.rrc,
Ba);else{var ub=this.$Nb,ic=this.Rrb;this.hide();this.i0c(Ba);this.Lqj(ub,ic)}}mzi(Ba){const ub=this.xBb(Ba);if(!(0>=ub)){var ic=this.iq[ub];Ba=this.Tfd[Ba];Array.removeAt(this.iq,ub);Array.insert(this.iq,0,ic);Array.removeAt(this.U2,ub);Array.insert(this.U2,0,Ba);this.s5.removeChild(Ba.element);this.s5.appendChild(Ba.element);this.B0b()}}Lqj(Ba,ub){0>=this.iq.length?this.hide():3===Ba&&ub?this.T3c():this.fhc()}obf(Ba){if(this.pvf&&this.lPj)return!1;Ba=hf.Vlf(Ba);if(this.s5!==Ba&&Re.a.VOa(this.s5,
Ba))return!0;for(const ub of this.U2)if(Re.a.VOa(ub.element,Ba))return!0;return!1}position(Ba,ub){this.element.style.top=ub+"px";this.element.style.left=Ba+"px"}B0b(Ba=!1){if(!Ba||this.CJa){this.tOg&&this.y7i(!0);var ub=Math.min(3,this.n_a)-1;Ba=0;var ic=1,Hc=0;this.kWb&&(Ba=this.zlc,ic=-1,Hc=-this.Scb);for(let Vb=this.n_a-1;Vb>ub;Vb--)this.U2[Vb].Jaj(this.iq[Vb],-4*ub*ic+Hc,!0,!1,!0,Ba);for(;0<=ub;ub--)this.U2[ub].Jaj(this.iq[ub],-4*ub*ic+Hc,0<ub,Array.contains(this.ZPb,this.iq[ub].clientId),ub!==
this.Qid,Ba);this.Qid=0;this.T9a.update(0,this.kWb);this.zIndex=this.yZa;this.Rrb=!1;this.wVi(0);this.Oub&&this.dispose()}}FLh(){this.tOg&&this.y7i(!1);this.zIndex=this.yZa+1;let Ba,ub,ic;({offsetX:ub,offsetY:Ba,Pai:ic}=this.fZn());for(let Hc=0;Hc<this.n_a;Hc++)this.U2[Hc].$9n(this.iq[Hc],ub,Ba+(this.Scb+2)*Hc,Hc!==this.Qid,ic)}L0a(){let Ba=0,ub=0;this.kWb&&(Ba=this.zlc,ub=-6);for(let ic=0;ic<this.n_a;ic++)this.U2[ic].hide(this.iq[ic],ub,Ba);this.zIndex=this.yZa;this.visible=this.Rrb=!1;this.Oub&&
this.dispose()}d1e(Ba=0){Ba?(this.CJa=!0,G.Task.delay(Ba).continueWith(()=>{this.qNg?this.x8l():this.B0b(!0);this.CJa=!1})):this.qNg?this.hide():this.B0b()}x8l(){this.CJa&&this.hide()}Irk(){if(v.AFrameworkApplication.ta&&v.AFrameworkApplication.ta.Pb.Bna&&Gd.c()){const Ba=appChrome.selectors.getShyState();return Ba.isActive&&0!==Ba.state}return!1}rQa(Ba,ub){Ba=this.$Nb;this.Irk()||2!==ub.type&&(4!==ub.type||3===Ba)?4===ub.type&&3===Ba?(this.CJa&&(this.CJa=!1),this.d1e()):3!==ub.type||3!==Ba||this.Rrb||
(1<this.n_a?(this.CJa=!0,G.Task.delay(250).continueWith(()=>{this.B0b(!0);this.CJa=!1})):this.d1e()):(this.CJa&&(this.CJa=!1),3!==Ba&&(this.FLh(),3===ub.Jo.og&&this.d1e(2E3)));this.raiseEvent(Tc.KT,ub)}Lbc(Ba){3===Ba.og?this.rQa(this,new Tc(4,Ba)):Ba.eventName===sc.a.pointerOver?this.rQa(this,new Tc(2,Ba)):Ba.eventName===sc.a.pointerOut&&this.rQa(this,new Tc(3,Ba));return!1}Q1f(Ba){this.element.style.width=Ba+"px";this.element.style.height=this.Scb+"px"}i0c(Ba){this.qCn(Ba);Ba=this.xBb(Ba);if(!(0>
Ba)){var ub=this.iq[Ba];Array.removeAt(this.iq,Ba);delete this.Tfd[ub.clientId];ub=this.U2[Ba];this.s5.removeChild(ub.element);this.Pd.get(18,!1)&&ub.QKb(Object(e.a)(this,this.rQa,"onInteractivityChanged"));Array.removeAt(this.U2,Ba);ub.dispose()}}wVi(Ba=5){if(this.rrc.length){this.visible&&this.L0a();for(let ub=0;ub<this.rrc.length;ub++)this.i0c(this.rrc[ub]);Array.clear(this.rrc);0>=this.iq.length||5===Ba?this.hide():0===Ba&&this.fhc()}}xBb(Ba){for(let ub=0;ub<this.iq.length;ub++)if(this.iq[ub].clientId===
Ba)return ub;return-1}qCn(Ba){-1===this.xBb(Ba)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.ZPb,Ba)&&(Array.remove(this.ZPb,Ba),this.iq[0].clientId===Ba&&0<this.ZPb.length&&this.mzi(this.ZPb[this.ZPb.length-1]),this.iq[0].clientId===Ba&&1===this.$Nb&&this.B0b())}y7i(Ba){Ba?Sys.UI.DomElement.addCssClass(this.s5,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.s5,"prBackgroundSelection")}fZn(){let Ba,ub;ub=Ba=0;var ic=
this.zlc;if(this.M$g){const Hc=this.M$g(this);if(!Hc)return{offsetX:Ba,offsetY:ub,Pai:ic};const Vb=4===this.$Nb;ic=this.bZj.RHl(this.n_a,Vb?6:this.Scb,this.Scb,this.element,Hc);ub=ic.offsetTop;this.Qid=this.rGl(ic.zsj,ic.offsetTop);ic=ic.Qai;ic!==this.zlc&&(this.eZf(ic),this.element.dir=3===ic?"rtl":"ltr",this.zlc=ic);ic!==this.FVh()?(Ba=this.hZj?-2:Vb?-6:-this.Scb,this.kWb=!0):this.kWb=!1}return{offsetX:Ba,offsetY:ub,Pai:ic}}rGl(Ba,ub){if(1===Ba)return this.n_a-1;Ba=Math.abs(ub);return 0<Ba?Ba/(this.Scb+
2):0}eZf(Ba){for(let ub=0;ub<this.n_a;ub++)this.U2[ub].eZf(Ba)}FVh(){return this.Sl?3:4}static Gfb(){return String.format("{0}-{1}","presencetooltip",hf.Nrc++)}static Vlf(Ba){return Ba.Ib.rawEvent.relatedTarget}}hf.Nrc=0;Object(l.a)(hf,"ModernPresenceTooltipControl",vd,[1062,9]);var Ui=c(208),Ik=c(236);class th{constructor(Ba){this.Pd=Ba;this.Pd.GLa(10,Ui.a.instance);this.Pd.GLa(9,dh.a.instance);this.Pd.GLa(6,20);this.Pd.GLa(13,Ik.a.instance);this.Pd.GLa(17,!1)}Y3e(Ba,ub=!1){this.Pd.GLa(15,ub);return new hf(Ba,
20,this.Pd)}}Object(l.a)(th,"ModernPresenceTooltipFactory",null,[1061]);class Mi extends vd{constructor(Ba,ub){super(Ba);this.iq=null;this.QKa=ub.get(8,!1);this.$8a=ub.get(6,0);this.element=Ba;this.element.className=Mi.Kdf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.qg=ub.get(10);this.qg.mb(sc.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.Rr=ub.get(9);this.Rr.mb(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut"));this.Rr.mb(sc.a.pointerDown,
this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior"));this.ND=ub.get(13);this.ND.mb(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior"))}Hxb(Ba){this.addHandler(Tc.KT,Ba)}QKb(Ba){this.removeHandler(Tc.KT,Ba)}get users(){return this.iq}dispose(){this.element&&(this.qg.sc(sc.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.Rr.sc(sc.a.pointerDown,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),
this.Rr.sc(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut")),this.ND.sc(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ba,ub,ic){this.hide();!Ba||0>=Ba.length||(this.QKa?this.element.style.right=ub+"px":this.element.style.left=ub+"px",this.element.style.top=ic+"px",this.Edk(Ba),this.visible=!0)}Edk(Ba){this.iq=Ba;Re.a.FA(this._ul);for(let ub=Ba.length-1;0<=ub;ub--)this.jea(Ba[ub])}jea(Ba){const ub=
document.createElement("li");ub.style.backgroundColor=Ba.color;ub.style.height=this.$8a+"px";ub.id="fly_"+Ba.clientId;ub.style.lineHeight=this.$8a+"px";Re.a.oy(ub,Ba.userName);ub.setAttribute("dir","auto");this._ul.appendChild(ub)}onClick(){this.hide();return!1}oO(Ba){this.raiseEvent(Tc.KT,new Tc(3,Ba));return!1}}Mi.Kdf="prFlyout UIFont";Object(l.a)(Mi,"PresenceTooltipFlyoutControl",vd,[]);class of extends vd{constructor(Ba,ub,ic){super(Ba);this._img=null;this.iq=[];this.element.className="prGlyph";
this.Pd=ub;this.QVb=this.Pd.get(9);this.xq=this.Pd.get(10);this.ND=this.Pd.get(13);this.T8l();this.jea(ic);this.Qye=!1}get r3a(){return this.iq.length}get users(){return this.iq}Hxb(Ba){this.addHandler(Tc.KT,Ba)}QKb(Ba){this.removeHandler(Tc.KT,Ba)}dispose(){this.hto();super.dispose()}jea(Ba){Array.add(this.iq,Ba);2===this.r3a?this.Cia(!0):1===this.r3a?this.Cia(!1):this.Cia(this.Qye)}z4a(Ba){this.Yhl(Ba)&&(1<this.r3a&&this.Cia(!0),1===this.r3a?this.Cia(!1):1>this.r3a&&this.hide())}show(){this.Cia(2<=
this.r3a);this.visible=!0}hide(){this.visible=!1}aGl(Ba){return Ba?this.jUh(0,5):this.jUh(1,4)}Yhl(Ba){for(let ub=0;ub<this.r3a;ub++)if(this.iq[ub].clientId===Ba)return Ba=this.iq[ub],Array.removeAt(this.iq,ub),Ba;return null}Cia(Ba){this.Qye!==Ba&&(this._img&&this.element.removeChild(this._img),this._img=this.aGl(Ba),this.element.appendChild(this._img),this.Qye=Ba);this._img.childNodes[0].style.backgroundColor=this.iq[this.iq.length-1].color}jUh(Ba,ub){const ic=this.Pd.get(6,0),Hc=this.Pd.get(14);
return Kc.createClusteredImageFromClusterWithImageClass(ic,ic,this.Pd.get(Ba),this.Pd.get(ub),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Hc?Hc.cloneNode(!0):null)}RX(Ba){3!==Ba.og&&this.raiseEvent(Tc.KT,new Tc(2,Ba));return!1}onClick(Ba){this.raiseEvent(Tc.KT,new Tc(1,Ba));return!0}oO(Ba){3!==Ba.og&&this.raiseEvent(Tc.KT,new Tc(3,Ba));return!1}hto(){this.element&&(this.QVb.sc(sc.a.pointerDown,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),
this.QVb.sc(sc.a.pointerOver,this.element,Object(e.a)(this,this.RX,"onPointerOver")),this.QVb.sc(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut")),this.xq.sc(sc.a.IA,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),this.xq.sc(sc.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.ND.sc(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")))}T8l(){this.element&&(this.QVb.mb(sc.a.pointerDown,this.element,
Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),this.QVb.mb(sc.a.pointerOver,this.element,Object(e.a)(this,this.RX,"onPointerOver")),this.QVb.mb(sc.a.pointerOut,this.element,Object(e.a)(this,this.oO,"onPointerOut")),this.xq.mb(sc.a.IA,this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")),this.xq.mb(sc.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.ND.mb(this.element,Object(e.a)(this,this.bia,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(of,"PresenceTooltipGlyph",vd,[]);class ci extends vd{constructor(Ba,ub,ic){super(Ba);this.iq=[];this.$J=[];this.iKa=0;this.ayc=this.ZSb=!1;this.Zzg=null;this.Ufd={};this.Pd=ic;this.Sl=ic.get(8,!1);this.Eja=ic.get(11,!1);Ba=ic.get(12,0);this.imageDimension=ic.get(6,0);this.pbb=ub;this.element.id=ci.Gfb();this.element.className=vd.UAh(this.Sl);Ba&&(this.zIndex=Ba);this.rtl=this.Sl;this.Q1f(ub);this.rza=this.createElement("div");this.rza.className=this.Eja?"prContainerV":"prContainerHr";
this.element.appendChild(this.rza);this.SKg=Array(this.iKa);for(ub=0;ub<this.iKa;ub++)this.naa[ub]=new Mi(this.createElement("div"),this.Pd),this.naa[ub].Hxb(Object(e.a)(this,this.rQa,"onInteractivityChanged")),this.element.appendChild(this.naa[ub].element)}get U4d(){return rf.a.clone(this.iq)}get naa(){return this.SKg}get Ebh(){return this.Zzg}get cde(){return this.imageDimension+2}get width(){return this.Eja?this.cde:this.pbb}get height(){return this.Eja?this.pbb:this.cde}Hxb(Ba){this.addHandler(Tc.KT,
Ba)}QKb(Ba){this.removeHandler(Tc.KT,Ba)}dispose(){if(this.naa)for(const Ba of this.naa)Ba.QKb(Object(e.a)(this,this.rQa,"onInteractivityChanged")),le.a.kB(Ba);le.a.I_f(this.$J);this.$J=this.SKg=null;super.dispose()}fhc(){this.L0a();this.H5f();this.visible=!0;this.ZSb=!1}T3c(){!this.$J||1>this.$J.length||(this.L0a(),this.visible=!0,this.H5f(),this.K4d(this.$J[this.$J.length-1]),this.ZSb=!0)}t5f(){if(this.$J&&!(1>this.$J.length)){this.visible=!0;this.H5f();var Ba=0;for(const ub of this.$J)this.K4d(ub,
Ba++);this.ZSb=!1;this.ayc=!0}}hide(){this.visible=!1;this.L0a();for(let Ba=0;Ba<this.$J.length;Ba++)this.$J[Ba].hide();this.ZSb=!1}trh(){if(!this.ayc)return!1;let Ba=0;for(const ub of this.naa)ub.visible&&Ba++;return this.ayc=0<Ba&&(this.iq.length<=this.iKa?Ba===this.iq.length:Ba===this.iKa)}jea(Ba){if(!(0>=this.iKa)){Ba.clientId||(Ba.clientId=(ci.Nrc++).toString());if(Ba.clientId in this.Ufd){var ub=this.xBb(Ba.clientId);if(0<=ub){ub=this.iq[ub];if(ub.color===Ba.color&&ub.userName===Ba.userName)return;
this.z4a(Ba.clientId)}}ub=this.trh();var ic=0;if(this.iq.length<this.iKa){var Hc=new of(this.createElement("div"),this.Pd,Ba);Hc.Hxb(Object(e.a)(this,this.rQa,"onInteractivityChanged"));this.Sl&&!this.Eja&&0<this.iq.length?this.rza.insertBefore(Hc.element,this.rza.firstChild):(this.rza.appendChild(Hc.element),ic=this.$J.length);Array.add(this.$J,Hc)}else this.Sl&&!this.Eja?Hc=this.$J[0]:(ic=this.$J.length-1,Hc=this.$J[ic]),Hc.jea(Ba);Hc.show();this.Ufd[Ba.clientId]=Hc;Array.add(this.iq,Ba);this.woj(Hc,
ic);ub&&this.t5f()}}z4a(Ba){const ub=this.trh();ub&&this.L0a();this.i0c(Ba);this.iq.length>=this.iKa&&this.$J.length<this.iKa&&this.$tn();0>=this.iq.length?this.hide():ub&&this.t5f()}mzi(){}i0c(Ba){var ub=this.xBb(Ba);0>ub||(Ba=this.iq[ub],Array.removeAt(this.iq,ub),ub=this.Ufd[Ba.clientId],delete this.Ufd[Ba.clientId],ub.z4a(Ba.clientId),this.woj(ub),0>=ub.r3a&&(this.rza.removeChild(ub.element),Array.remove(this.$J,ub),ub.dispose()))}$tn(){var Ba=this.YMl();!Ba||1>=Ba.users.length||(Ba=Array.clone(this.iq),
Ba.forEach(ub=>{this.i0c(ub.clientId)}),Ba.forEach(ub=>{this.jea(ub)}))}xBb(Ba){for(let ub=0;ub<this.iq.length;ub++)if(this.iq[ub].clientId===Ba)return ub;return-1}YMl(){return this.Sl&&!this.Eja?this.$J[0]:this.$J[this.$J.length-1]}position(Ba,ub){this.element.style.top=ub+"px";this.element.style.left=Ba+"px"}H5f(){for(let Ba=0;Ba<this.$J.length;Ba++)this.$J[Ba].show()}L0a(){for(let Ba=0;Ba<this.iKa;Ba++)this.naa[Ba].hide();this.ayc=!1}K4d(Ba,ub=0){if(Ba)if(this.Zzg=Ba,this.Eja){const ic=this.imageDimension;
if(1<Ba.users.length)this.naa[ub].show(Ba.users,ic,this.height-this.imageDimension);else{const Hc=this.rza.children.length;for(let Vb=0;Vb<this.rza.children.length;Vb++)Ba.element===this.rza.children[Vb]&&this.naa[ub].show(Ba.users,ic,this.height-(Hc-Vb)*this.cde+2)}}else this.naa[ub].show(Ba.users,this.width,0)}rQa(Ba,ub){var ic=Object(w.a)(of,Ba);ic=ic?this.zNh(ic):-1;if(2===ub.type||1===ub.type&&-1!==ic&&!this.naa[ic].visible)this.K4d(Ba);else if(1===ub.type)this.L0a(),this.ZSb=!1;else if(3===
ub.type){if(this.obf(ub.Jo))return;this.ZSb||this.L0a()}this.raiseEvent(Tc.KT,ub)}obf(Ba){Ba=ci.Vlf(Ba);let ub=!1;for(const ic of this.naa)if(Re.a.VOa(ic.element,Ba)){ub=!0;break}return this.rza!==Ba&&Re.a.VOa(this.rza,Ba)||ub}woj(Ba,ub=0){const ic=this.tjm(Ba);ic&&0>=Ba.r3a?this.naa[ub].hide():ic?this.K4d(Ba):this.naa[ub].hide()}zNh(Ba){let ub=0;for(const ic of this.$J){if(Ba===ic)return ub;ub++}return-1}tjm(Ba){const ub=this.zNh(Ba);return!!this.Ebh&&Ba===this.Ebh&&-1!==ub&&this.naa[ub].visible}Q1f(Ba){this.iKa=
Ba===this.imageDimension?1:Math.floor(Ba/this.cde);this.Eja?(this.element.style.height=Ba+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Ba+"px",this.element.style.height=this.imageDimension+"px")}static Gfb(){return String.format("{0}-{1}","presencetooltip",ci.Nrc++)}static Vlf(Ba){Ba=Ba.Ib.rawEvent;return Ba.relatedTarget||Ba.toElement}}ci.Nrc=0;Object(l.a)(ci,"PresenceTooltipControl",vd,[1062,9]);class Fl{constructor(Ba){this.Pd=Ba;this.Pd.GLa(10,Ui.a.instance);
this.Pd.GLa(9,dh.a.instance);this.Pd.GLa(6,16);this.Pd.GLa(13,Ik.a.instance)}Y3e(Ba){return new ci(Ba,16,this.Pd)}}Object(l.a)(Fl,"PresenceTooltipFactory",null,[1061]);var xg=c(269),Uf=c(107),tg=c(62),sg=c(7),jh=c(5),eh=c(20),li=c(91),Oj=c(537),yk=c(307),dj=c(123);class bl extends Sys.EventArgs{constructor(Ba,ub){super();this.paragraphId=Ba;this.QCm=ub}}Object(l.a)(bl,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class mh extends vd{constructor(Ba,ub,ic,Hc,Vb,Ud=null,Cc=null){super(null);this.Kfd=
this.Qm=null;this.ETc=!1;this.Hpa=0;this.pp=Ba;this.$yc=ub;this.Rr=ic;this.Oi=Hc;this.oIa=Vb;mh.nsb=0;this.$gh=new Gb.a;this.vZi=new Gb.a;this.TV=Ud;this.Ma=Cc;this.kMj=this.Ma.pc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.Q5j=this.Ma.pc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.zqa=0}get f3a(){return v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}oek(Ba){this.addHandler("CR",Ba)}eWi(Ba){this.removeHandler("CR",Ba)}d7d(){this.raiseEvent("CR",new bl(this.pp.ip.paragraphId,
this.ETc))}DFf(){if(Object(dj.a)(hf,this.Qm)){const Ba=Object(w.a)(hf,this.Qm);mh.nsb=0<mh.nsb?mh.nsb+1:Ba.yZa+1;Ba.zIndex=mh.nsb;this.element.style.zIndex=String(mh.nsb)}}BKn(){if(Object(dj.a)(hf,this.Qm)){const Ba=Object(w.a)(hf,this.Qm);mh.nsb=Ba.yZa;Ba.zIndex=Ba.yZa;this.element.style.zIndex=String(Ba.yZa)}}jui(){this.TV&&!this.Fpo()&&this.TV.continueWith(()=>{this.TV.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.kMj)&&this.zqa++})}Fpo(){return this.zqa>=this.Q5j}static Ati(){mh.DKg||
(mh.DKg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Gfb(Ba){return mh.g$l+Ba.ZXh()}}mh.uNi="data-presence-control";mh.jJi="OverlayControlElementOwner";mh.g$l="ipId_";mh.vNi="WacPresence";mh.wcn="PresenceIpPaddingDiv";mh.DKg=!1;mh.nsb=0;Object(l.a)(mh,"APresenceControl",vd,[1254,9]);class Qk{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.t5a=!1}}Object(l.a)(Qk,"PresenceImageControlStyle",null,[1253]);class Zf extends mh{constructor(Ba,
ub,ic,Hc,Vb,Ud=null,Cc=null){super(Ba,ub,ic,Hc,Vb,Ud,Cc);this.oO=()=>{this.wyi();return!1};this.o2d=Te=>{this.Qm&&3===Te.og&&(2!==this.Hpa?(this.DFf(),this.aNb()):this.wyi());return!1}}z4a(Ba){this.Qm&&this.Qm.z4a(Ba)}lie(){return this.Qm?this.Qm.U4d.length:0}updatePosition(Ba){if(this.element&&this.element.parentNode){var ub=this.zYh(Ba);if(ub){var ic=Sys.UI.DomElement.getBounds(this.element.parentNode),Hc,Vb;({left:ic,top:Hc,height:Vb,width:ub}=this.wPl(ub,ic,this.element.parentNode,this.Oi.instance));
this.element.style.top=Hc+"px";this.element.style.left=ic+"px";this.element.style.height=Vb+"px";this.element.style.width=ub+"px";ic=this.FYh(Ba);Ke.a.n4(this.element,ic);Ba=this.zjf(Ba,this.pp.ip.shapeId);this.d8i(ic,ub,this.isSelected(Ba),v.AFrameworkApplication.isRtl);this.aNb()}}}LE(){this.element&&(Re.a.hw(this.element),this.Qm.z4a(this.pp.user.clientId),this.d7d())}Fvh(Ba,ub,ic,Hc){ub=new Qk;if(!Hc||!ic)return ub;ic=this.zYh(Ba);if(!ic)return ub;ub.top=ic.y;ub.left=ic.x;ub.height=ic.height;
ub.width=ic.width;ub.rotation=this.ZRl(Ba);ub.t5a=!0;return ub}aXi(Ba,ub,ic,Hc){mh.Ati();this.Kfd=Ba;if(Hc){const Vb=this.zjf(Ba,this.pp.ip.shapeId);if(!Vb)return;const Ud=!this.element;Ud&&this.a4e(ub.ownerDocument,Ba);Ud||!this.element.parentNode?Vb.appendChild(this.element):this.element.parentNode!==Vb&&(this.element.parentNode.removeChild(this.element),Vb.appendChild(this.element));this.Qm.jea(this.pp.user);this.element.style.borderColor=this.pp.user.color;this.element.id=mh.Gfb(this.pp);ic.t5a&&
(this.element.style.height=ic.height+"px",this.element.style.top=ic.top+"px",this.element.style.left=ic.left+"px",this.element.style.width=ic.width+"px",Ke.a.n4(this.element,ic.rotation),Ke.a.n4(this.Qm.element,-1*ic.rotation),this.d8i(ic.rotation,ic.width,this.isSelected(Vb),v.AFrameworkApplication.isRtl),this.aNb())}this.ETc=!Hc;this.d7d()}ZRl(Ba){return this.element&&this.element.parentNode&&this.z3h(Ke.a.getTransform(this.element.parentNode))?this.z3h(Ke.a.getTransform(this.element)):this.FYh(Ba)}z3h(Ba){return Ba&&
-1<Ba.indexOf("deg")&&(Ba=parseInt(Ba.substring(Ba.indexOf("(")+1,Ba.indexOf("deg"))),!isNaN(Ba))?Ba:0}Xnj(Ba){this.element.style.borderColor=this.pp.user.color;this.element.id=mh.Gfb(this.pp);this.updatePosition(Ba)}a4e(Ba,ub){this.element=Ba.createElement("div");this.element.setAttribute(mh.uNi,!0);Uf.a.rl(this.element,mh.jJi,this);this.element.className=Zf.qkn;v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",
!1)&&(Ba=ub.yb)&&Ba.GP&&(this.element.style.pointerEvents="none");this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.Qm=this.$yc.Y3e(this.createElement("div"),!0);this.Qm.jea(this.pp.user);this.Qm.hide();this.Rr.mb(sc.a.pointerOut,this.Qm.element,this.oO);this.Rr.mb(sc.a.pointerDown,this.Qm.element,this.o2d);this.Qm.element.classList.add(mh.vNi);this.element.appendChild(this.Qm.element)}wPl(Ba,ub,ic,Hc){let Vb=Ba.y,Ud=Ba.x,Cc=Ba.height;Ba=Ba.width;(1<Math.abs(ub.width-ic.offsetWidth)||
1<Math.abs(ub.height-ic.offsetHeight))&&Hc&&(Vb=Math.round(Vb/Hc.jj),Ud=Math.round(Ud/Hc.jj),Cc=Math.round(Cc/Hc.jj),Ba=Math.round(Ba/Hc.jj));return{left:Ud,top:Vb,height:Cc,width:Ba}}isSelected(Ba){return Ba.classList.contains(yk.a.a2b)}d8i(Ba,ub,ic,Hc){this.Qm.element.style.left="auto";this.Qm.element.style.top="auto";this.Qm.element.style.right="auto";this.Qm.element.style.bottom="auto";ic=ic?Math.round(.5*Zf.Gpa)+Zf.Ino:0;0<=Ba&&90>Ba||360===Ba?(this.Qm.element.style.top=-.5*Zf.Gpa-ic+"px",Hc?
this.Qm.element.style.right=ub-.5*Zf.Gpa+"px":this.Qm.element.style.left=ub-.5*Zf.Gpa+"px"):90<=Ba&&180>Ba?(this.Qm.element.style.left=-.5*Zf.Gpa-ic+"px",Hc?this.Qm.element.style.bottom=-.5*Zf.Gpa+"px":this.Qm.element.style.top=-.5*Zf.Gpa+"px"):180<=Ba&&270>Ba?(this.Qm.element.style.bottom=-.5*Zf.Gpa-ic+"px",Hc?this.Qm.element.style.left=ub-.5*Zf.Gpa+"px":this.Qm.element.style.right=ub-.5*Zf.Gpa+"px"):(this.Qm.element.style.right=-.5*Zf.Gpa-ic+"px",Hc?this.Qm.element.style.top=-.5*Zf.Gpa+"px":this.Qm.element.style.bottom=
-.5*Zf.Gpa+"px")}$h(Ba,ub){const ic=this.qKd(Ba,ub);return ic?ic.properties:(Ba=this.EYh(Ba,ub))?Ba.properties:null}zjf(Ba,ub){var ic=this.qKd(Ba,ub);return ic&&(ic=ic.oDa(Ba.Ug,Ba))?ic.element:(ub=this.EYh(Ba,ub))?Object(w.a)(Oj.a,ub).xe(Ba.Sb).htmlElement:null}qKd(Ba,ub){Ba=li.i(Ba.yb,5);for(const ic of Ba)if(ic.properties.getValue(sg.a.KAb)===ub)return ic;return null}EYh(Ba,ub){Ba=jh.GraphIterator.$a(Ba.yb);let ic=Ba.Rb(6);for(;ic;){const Hc=ic.properties.getValue(sg.a.KAb);if(eh.ImageReader.Wu(ic)&&
Hc===ub)return ic;ic=Ba.yf(6)}return null}QFl(Ba){const ub=tg.a.lf(eh.ImageReader.uE(Ba),0);Ba=tg.a.lf(eh.ImageReader.RF(Ba),1);return{Jia:ub,S7l:Ba}}FYh(Ba){Ba=this.$h(Ba,this.pp.ip.shapeId);return eh.ImageReader.MZ(Ba)}zYh(Ba){var ub=this.pp.ip;if(!ub||!ub.shapeId)return null;var ic=this.$h(Ba,ub.shapeId);const Hc=this.zjf(Ba,ub.shapeId);if(!ic||!Hc)return null;const Vb=eh.ImageReader.Ik(ic);let Ud=Ba=1,Cc;({Jia:ub,S7l:Cc}=this.QFl(ic));sb.App.instance&&sb.App.instance.pna(Vb)?(ic=eh.ImageReader.pma(ic),
Ba=tg.a.lf(ic[0],0),Ud=tg.a.lf(ic[2],1)):ic.hasProperty(sg.a.Qba)?(ic=ic.getValue(sg.a.Qba),Ba+=tg.a.lf(ic[0],0),Ud+=tg.a.lf(ic[2],1)):(Ba+=0<Hc.offsetWidth?(Hc.offsetWidth-ub)/2:2,Ud+=0<Hc.offsetHeight?(Hc.offsetHeight-Cc)/2:2);return new Sys.UI.Bounds(Math.round(Ba),Math.round(Ud),Math.round(ub),Math.round(Cc))}wyi(){this.Qm&&(this.Qm.fhc(),this.Hpa=1)}aNb(){for(const Ba of this.Qm.U4d)if(Ba.clientId===this.pp.user.clientId&&!Ba.equals(this.pp.user)){this.Qm.jea(this.pp.user);break}if(this.pp.hSa||
2===this.Hpa)this.Qm.T3c(),this.pp.hSa=!1,this.pp.$aa=!0,this.Hpa=2;this.pp.$aa&&1!==this.Hpa||(this.Qm.fhc(),this.pp.$aa=!0,this.Hpa=1)}}Zf.qkn="WACImgPresenceHighlight";Zf.Gpa=20;Zf.Ino=6;Object(l.a)(Zf,"PresenceImageControl",mh,[]);var Pl=c(290);class rh{constructor(){this.height=this.top=this.left=this.$fi=0;this.t5a=!1;this.iy=this.Ch=null}}Object(l.a)(rh,"PresenceIpControlStyle",null,[1253]);var tf=c(163),Ql=c(74);class ji extends mh{constructor(Ba,ub,ic,Hc,Vb,Ud=null,Cc=null,Te=null){super(Ba,
ub,ic,Hc,Vb,Ud,Cc);this.hyc=this.hVa=this.iXb=null;this.RX=Ne=>{!this.Qm||this.f3a&&!this.Qm.obf(Ne)||(this.DFf(),this.Z9d(Ne));this.Xnj(this.Kfd);return!1};this.oO=()=>{this.Qm&&this.iQ();return!1};this.o2d=Ne=>{this.Qm&&3===Ne.og&&(2!==this.Hpa?(this.DFf(),this.Z9d(Ne)):this.iQ());return!1};this.KC=Te}a4e(Ba){this.element=Ba.createElement("div");this.element.setAttribute(mh.uNi,!0);Uf.a.rl(this.element,mh.jJi,this);this.element.className=mh.wcn;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":
"ltr";this.Rr.mb(sc.a.pointerOver,this.element,this.RX);this.f3a&&(this.Rr.mb(sc.a.pointerOut,this.element,this.oO),this.Rr.mb(sc.a.pointerDown,this.element,this.o2d));this.hVa=this.createElement("div");this.hVa.className=ji.rkn;this.f3a||(this.hyc=this.createElement("div"),this.hyc.className=ji.ukn,this.hVa.appendChild(this.hyc));this.Qm=this.$yc.Y3e(this.createElement("div"),this.f3a);Ba=this.Ma.$("NoPresenceUserLookUpBeforeRender");this.KC&&!Ba&&(this.pp.user=this.KC.Yui(this.pp.user.clientId)||
this.pp.user);this.Qm.jea(this.pp.user);this.Qm.hide();this.Qm.element.classList.add(this.f3a?mh.vNi:ji.Nfn);this.hVa.appendChild(this.Qm.element);this.element.appendChild(this.hVa)}A1k(){this.iXb&&(Eb.a.instance.Se(this.iXb),this.iXb=null)}aNb(Ba){for(var ub of this.Qm.U4d)if(ub.clientId===this.pp.user.clientId&&!ub.equals(this.pp.user)){this.Qm.jea(this.pp.user);break}ub=!1;ji.H_k===this.pp.user.color?({value:ub}=this.$gh.Gc(this.pp.user.clientId,!1),ub||(this.$gh.Z(this.pp.user.clientId,!0),k.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.pp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:ub}=this.vZi.Gc(this.pp.user.clientId,!1),ub||(this.vZi.Z(this.pp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.pp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ba||this.pp.hSa||2===this.Hpa?(this.jui(),this.Qm.T3c(),this.pp.hSa=!1,this.pp.$aa=!0,this.Hpa=2,ji.tmo):this.pp.$aa&&1!==this.Hpa?0:(this.jui(),this.Qm.fhc(),this.pp.$aa=!0,this.Hpa=1,ji.smo)}Z9d(Ba=null){this.A1k();
const ub=this.aNb(!!Ba);this.f3a&&Ba&&Ba.eventName===sc.a.pointerOver||this.rQn(ub)}iQ(){this.Qm&&this.Hpa&&(this.BKn(),this.Qm.hide(),this.Hpa=0)}rQn(Ba){this.iXb=new X.a(2,1,Ba,()=>{this.iXb=null;this.iQ()},56);Eb.a.instance.Xb(this.iXb)}updatePosition(Ba){if(this.element&&this.element.parentNode){var ub=this.lZh(Ba);if(ub){Ba=Sys.UI.DomElement.getBounds(this.element.parentNode);ub=new Sys.UI.Bounds(ub.x-Ba.x,ub.y-Ba.y,ji.cgi,ub.height);var ic;({left:Ba,top:ub,height:ic}=this.zPl(ub,Ba,this.element.parentNode,
this.Oi.instance));this.element.style.height=2*ji.Fcc+ic+"px";this.element.style.top=ub-ji.Fcc+"px";this.element.style.left=Ba-ji.Fcc+"px";this.hVa.style.height=Math.max(ji.myi,ic)+"px";this.Z9d()}}}LE(){this.element&&(Re.a.hw(this.element),this.d7d())}Fvh(Ba,ub,ic,Hc,Vb){const Ud=new rh;if(!Hc||!ic)return Ud;Hc=this.lZh(Ba);if(!Hc)return Ud;var Cc=ic;ic=Ba;if(Ba.Lj){var Te=Ba.Yb;Cc=Ba.kg.hDb(this.pp.ip.q8.cp);0>Cc&&0==Cc;Ba.Yb.rva?Re.a.VOa(Te.editingElement,Ba.kg.pi.J(Cc))||(ic=tf.a.BO?Ql.InteractiveViewManager.instance.od.gh(Ba.source):
Ba.source.gh(Ql.InteractiveViewManager.instance.od.Sb),ub=ic.kg.pi.J(Cc)):ub=ic.kg.pi.J(Cc);Cc=ub.getBoundingClientRect()}Cc=new Sys.UI.Bounds(Hc.x-Cc.x,Hc.y-Cc.y,ji.cgi,Hc.height);Ba=Cc.y;Hc=Cc.x;Cc=Cc.height;Te=this.Oi.instance;Vb&&Te&&(Vb=Te.jj,Ba=Math.round(Ba/Vb),Hc=Math.round(Hc/Vb),Cc=Math.round(Cc/Vb));Ud.top=Ba-ji.Fcc;Ud.left=Hc-ji.Fcc;Ud.height=2*ji.Fcc+Cc;Ud.$fi=Math.max(ji.myi,Cc);Ud.t5a=!0;Ud.Ch=ub;Ud.iy=ic;return Ud}aXi(Ba,ub,ic,Hc){mh.Ati();this.Kfd=Ba;Ba=ic.Ch;ub=ic.iy;if(Ba&&ub){if(Hc){const Vb=
!this.element;Vb&&this.a4e(Ba.ownerDocument);Vb||!this.element.parentNode?Ba.appendChild(this.element):this.element.parentNode!==Ba&&(this.element.parentNode.removeChild(this.element),Ba.appendChild(this.element));this.Kfd=ub;Ba=this.pp.user.color;this.hVa.style.borderColor=Ba;this.f3a||(this.hyc.style.borderColor=Ba);this.element.id=mh.Gfb(this.pp);ic.t5a&&(this.element.style.height=ic.height+"px",this.element.style.top=ic.top+"px",this.element.style.left=ic.left+"px",this.hVa.style.height=ic.$fi+
"px",this.Z9d())}this.ETc=!Hc;this.d7d()}else k.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Ba} or paragraphViewElement is null:${!ub}`)}dispose(){this.element&&(this.LE(),this.Rr.sc(sc.a.pointerOver,this.element,this.RX),this.f3a&&(this.Rr.sc(sc.a.pointerOut,this.element,this.oO),this.Rr.sc(sc.a.pointerDown,this.element,this.o2d)),le.a.kB(this.Qm),this.element=this.Qm=null);super.dispose()}Xnj(Ba){const ub=this.pp.user.color;this.hVa.style.borderColor=
ub;this.f3a||(this.hyc.style.borderColor=ub);this.element.id=mh.Gfb(this.pp);this.updatePosition(Ba)}zPl(Ba,ub,ic,Hc){let Vb=Ba.y,Ud=Ba.x;Ba=Ba.height;(1<Math.abs(ub.width-ic.offsetWidth)||1<Math.abs(ub.height-ic.offsetHeight))&&Hc&&(Vb=Math.round(Vb/Hc.jj),Ud=Math.round(Ud/Hc.jj),Ba=Math.round(Ba/Hc.jj));return{left:Ud,top:Vb,height:Ba}}lZh(Ba){const ub=this.pp.ip;if(!ub)return null;let ic;try{const Hc=ub.q8.cp;ic=Pl.a.pZ(Hc,Ba,0<Hc,!1,!1,!1)}catch(Hc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",
Eb.a.instance.Zu,Hc.message,Hc.stack),ic=null}return ic}}ji.Nfn="WacPawn";ji.cgi=2;ji.smo=7E3;ji.tmo=2E3;ji.Fcc=5;ji.rkn="presenceIp";ji.ukn="PresenceSmallBox";ji.myi=10;ji.H_k="0xcccccc";Object(l.a)(ji,"PresenceIpControl",mh,[]);class fi{constructor(Ba,ub,ic,Hc,Vb=null,Ud=null,Cc=null){this.Snc={};this.Qnc={};this.YDg={};this.$yc=Ba;this.Rr=ub;this.Sm=ic;this.oIa=Hc;this.TV=Vb;this.Ma=Ud;this.KC=Cc}get lZk(){return this.Snc}get hCh(){return this.Qnc}vPl(Ba){const ub=!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");
return Ba.ip.shapeId&&ub?this.APl(Ba):this.BPl(Ba)}APl(Ba){const ub=Ba.ip.shapeId.toString();this.YDg[Ba.user.clientId]=ub;const ic=this.Qnc[ub];return ic?(ic.pp=Ba,{returnValue:ic,iie:!0}):{returnValue:this.Qnc[ub]=new Zf(Ba,this.$yc,this.Rr,this.Sm,this.oIa,this.TV,this.Ma),iie:!1}}BPl(Ba){const ub=Ba.user.clientId,ic=this.Snc[ub];return ic&&ic.pp.user.equals(Ba.user)?(ic.pp=Ba,{returnValue:ic,iie:!0}):{returnValue:this.Snc[ub]=new ji(Ba,this.$yc,this.Rr,this.Sm,this.oIa,this.TV,this.Ma,this.KC),
iie:!1}}mZh(Ba){return this.Snc[Ba]}MFl(Ba){return(Ba=this.Qnc[this.YDg[Ba]])&&!Ba.lie()?Ba:null}H6k(){var Ba=this.Snc;for(const ub in Ba)Ba[ub].dispose();Ba=this.Qnc;for(const ub in Ba)Ba[ub].dispose()}}Object(l.a)(fi,"PresenceControlProvider",null,[]);var Yh=c(159);class Yj{constructor(){this.kab=0}$_h(){this.kab++;this.kab===Number.MAX_VALUE&&(this.kab=1);return this.kab}static get instance(){return Yj.svc}}Yj.svc=new Yj;Object(l.a)(Yj,"PacketIdGenerator",null,[277]);var ef=c(1077);class Zj{constructor(Ba,
ub,ic){this.GQn=Ba;this.Iam=ub;this.Gqi=ic}}Object(l.a)(Zj,"SuccessfulInboundReplicationCallbackData",null,[]);class Od{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc){this.fOn=(Te,Ne)=>{Ne.type||(Te=this.Lk.pIh>=this.zKj,this.f5j&&Te?(Te=this.yve())?Te.hKh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.qE())};this.J9m=Te=>{if(Te=Object(w.a)(Zj,Te)){var Ne=Te.Iam.vi.toString(),Sf=this.yve(),Ie=Sf.zu,pg="";Ie!==Te.Gqi&&(k.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",Te.GQn.toString()),pg=this.YKl(Sf,Ie,Te.Gqi));k.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",pg,Ne)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.YNn=Ba;this.yve=ub;this.Lk=ic;this.f5j=Vb;this.zKj=Ud;this.dUb=Hc;this.rq=Cc;this.YNn.f6(this.fOn)}qE(){const Ba=this.yve();if(!Ba)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.dUb()&&Ba.EPa){let ub=-1;Object(dj.a)(ef.a,Ba)&&(ub=Ba.Zj.$Fa());const ic=this.rq.jg("Task","ShoulderTapInboundReplicationTimer");Ba.qE(this.J9m,null,new Zj(ub,ic,Ba.zu))}}YKl(Ba,ub,ic){const Hc=new Sys.StringBuilder;Ba=Ba.node.Bd.store.getRevision(ub);if(!Ba)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:ub}),"";for(Hc.append(Ba.id.Ls);ub!==ic;){Hc.append(", ");Hc.append(ub.Ls);Ba=Ba.Zl;if(!Ba)break;
ub=Ba.id}return Hc.toString()}}Object(l.a)(Od,"ContentNotificationManager",null,[]);class Sh extends Od{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc){super(Ba,ub,ic,Hc,Vb,Ud,Cc)}static get IRa(){return null!=Sh.Mvg?Sh.Mvg:Sh.Mvg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(sb.App.xa){var Ba=sb.App.xa.jb;Ba&&(Ba.kea(Sh.pWc),Ba=Ba.Yc)&&(Sh.mv=Ba.contentReplicator,Sh.mv&&sb.App.Lma().continueWith(Sh.LKf))}}static LKf(){Sh.Mad=sb.App.Lma().result;Sh.Mad&&Sh.Mad.Xp&&Sh.IRa.GI().continueWith(Sh.eXc)}static eXc(){Sh.pj=
Sh.IRa.GI().result;if(Sh.pj){var Ba=v.AFrameworkApplication.K,ub=Ba.$("Box4ThrottleInboundRequests");Ba=Ba.pc("Box4ThrottleInboundsAtUserCount",20);Sh.mv.nMd=()=>Sh.pj.UPa;Sh.Jad=Sh.Jad||new Sh(Sh.pj,()=>Sh.mv,Sh.Mad,()=>v.AFrameworkApplication.Rk,ub,Ba,sb.App.xa.tq);Sh.Jad.qE()}}static pWc(Ba){Sh.Jad||(Ba.Zlb(Sh.pWc),Sh.init())}}Sh.Jad=null;Sh.pj=null;Sh.mv=null;Sh.Mad=null;Object(l.a)(Sh,"WordContentNotificationManager",Od,[]);var qf=c(64);class Ld{constructor(Ba,ub,ic,Hc,Vb,Ud){this.Ebd=null;this.M0g=
Ba;this.ud=ic;this.mKa=Hc;this.xy=Vb;this.yh=Ud;this.hpb=ub}clone(){return new Ld(this.M0g,this.hpb.clone(),this.ud,this.mKa,this.xy,this.yh)}get cp(){if(null!=this.Ebd)return this.Ebd;var Ba=this.M0g.paragraphId;if(Ba.equals(ie.a.nil))return 0;var ub=this.mKa();if(!ub)return 0;Ba=ub.Db(Ba);if(!Ba)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;ub=this.ud.yzb(this.ud.HQa(Ba.characterData,Ba.qa),this.hpb);if(qf.a.$l&&this.xy){var ic=lb.a.Uc(Ba,ub);
this.yh&&Ba.Ms&&(ic.Fb=this.yh.lLd(Ba,ub,this.hpb.sta));ub=this.xy.X$(ic,!0)}else this.xy&&this.yh&&Ba.Ms&&(ic=lb.a.Uc(Ba,ub),ic.Fb=this.yh.lLd(Ba,ub,this.hpb.sta),ub=this.xy.X$(ic,!0));return ub}OMf(){null==this.Ebd&&(this.Ebd=this.cp)}equals(Ba){return Ba?this.hpb.isEqual(Ba.hpb,!1):!1}}Object(l.a)(Ld,"WordPresenceCp",null,[771,104,772]);class fh{constructor(Ba,ub){this.xy=Ba;this.yh=ub}create(Ba,ub,ic,Hc){return new Ld(Ba,ub,ic,Hc,this.xy,this.yh)}}Object(l.a)(fh,"Factory",null,[749]);class Vm extends Sys.EventArgs{constructor(Ba,
ub,ic){super();this.paragraphId=Ba;this.presence=ub;this.Qtf=ic}}Object(l.a)(Vm,"ParagraphChangedEventArg",Sys.EventArgs,[]);class zl{constructor(Ba){this.cp=Ba}equals(Ba){return Ba?this.cp===Ba.cp:!1}clone(){return new zl(this.cp)}}Object(l.a)(zl,"PresenceCp",null,[771,104]);class Pm{constructor(Ba,ub,ic,Hc,Vb){this.paragraphId=Ba;this.cp=ub;this.length=ic;this.shapeId=Hc;this.dryDeletion=Vb}}Object(l.a)(Pm,"SerializablePresenceIpData",null,[]);class xo{constructor(Ba,ub,ic,Hc=0,Vb=0){this.Ira=null;
Ba&&(this.Ira=ie.a.Gf(Ba));this.L0g=new zl(ub);this.CFa=ic;this.p5g=Hc;this.rIg=Vb}get paragraphId(){return this.Ira}get q8(){return this.L0g}get shapeId(){return this.p5g}get dryDeletion(){return this.rIg}isValid(){return 0<=this.q8.cp&&!!this.paragraphId&&!this.paragraphId.equals(ie.a.nil)}getData(){return new Pm(this.paragraphId.toString(),this.q8.cp,this.CFa,this.shapeId,this.dryDeletion)}clone(){const Ba=new xo;Ba.Ira=this.paragraphId;Ba.L0g=this.q8?this.q8.clone():null;Ba.CFa=this.CFa;Ba.p5g=
this.shapeId;Ba.rIg=this.dryDeletion;return Ba}static Czb(Ba){return Ba.paragraphId&&void 0!==Ba.cp&&null!==Ba.cp&&void 0!==Ba.length&&null!==Ba.length?new xo(Ba.paragraphId,Ba.cp,Ba.length,void 0,Ba.dryDeletion):null}}Object(l.a)(xo,"PresenceIp",null,[270,104]);class Vn{constructor(Ba,ub){this.ip=Ba;this.user=ub}}Object(l.a)(Vn,"SerializablePresenceData",null,[]);class zk{constructor(Ba,ub){this.hSa=this.$aa=this.wac=!1;this.gVa=ub;this.user=Ba}get ip(){return this.gVa}umf(){return new Vn(this.ip?
this.ip.getData():null,this.user.getData())}ZXh(){return this.user.clientId+(this.gVa?this.gVa.paragraphId.toString():ie.a.nil.toString())}isValid(){const Ba=!!this.user&&this.user.isValid(),ub=!this.ip||this.ip.isValid();return Ba&&ub}clone(){const Ba=new zk;Ba.user=this.user?this.user.clone():null;Ba.gVa=this.gVa?this.gVa.clone():null;Ba.$aa=this.$aa;Ba.wac=this.wac;Ba.hSa=this.hSa;return Ba}static Czb(Ba){return Ba?new zk(Qa.Czb(Ba.user),Ba.ip?xo.Czb(Ba.ip):null):null}}Object(l.a)(zk,"PresenceInfo",
null,[262,104]);class Lh extends Ha.a{constructor(){super();this.Dvc={};this.OTa={};this.xKg=!1}get zdn(){return this.Dvc}get Gli(){return!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Cfh(Ba){this.addHandler("PPC",Ba)}NWi(Ba){this.removeHandler("PPC",Ba)}NLc(Ba){return Ba.ip.paragraphId.toString()}VSe(Ba,ub=!1){this.xKg||(this.xKg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var ic=({skn:Hc}=this.oym(Ba)).returnValue;
if(Hc&&!ub)(ic=this.OTa[Ba.user.clientId])&&0<=ic.length&&(ic[ic.length-1].ip.CFa=Ba.ip.CFa);else{ic||this.BVi(Ba.user.clientId);this.Gli&&ic&&this.hyo(Ba);ub=this.NLc(Ba);var Hc=Ba.user.clientId;var Vb=this.Dvc[ub]||[],Ud=this.OTa[Hc]||[];Ud.length>=Lh.$wi&&(Ud=Ud.splice(-Lh.UZm,Lh.$wi));ic||Vb.push(Hc);Ud.push(Ba);this.Dvc[ub]=Vb;this.OTa[Hc]=Ud;Ba.ip.paragraphId.equals(ie.a.nil)||this.NUf(Ba.ip.paragraphId,Ba,!0)}}oym(Ba){var ub=this.OTa[Ba.user.clientId];const ic=!ub||0>=ub.length?null:ub[ub.length-
1],Hc=!!ic&&this.NLc(ic)===this.NLc(Ba);ub=Hc&&ic.ip.q8.equals(Ba.ip.q8)&&ic.user.equals(Ba.user);this.Gli&&ub&&ic.ip.shapeId&&Ba.ip.shapeId&&ic.ip.shapeId!==Ba.ip.shapeId&&(ub=!1);return{returnValue:Hc,skn:ub}}hyo(Ba){const ub=this.xZk(Ba);ub&&ub.ip.shapeId&&(Ba.ip.shapeId&&Ba.ip.shapeId===ub.ip.shapeId||this.NUf(ub.ip.paragraphId,ub,!1))}xZk(Ba){Ba=this.OTa[Ba.user.clientId];return!Ba||0>=Ba.length?null:Ba[Ba.length-1]}BVi(Ba){const ub=this.OTa[Ba];if(ub&&0<ub.length){const ic=ub[0].ip.paragraphId,
Hc=this.NLc(ub[0]);delete this.OTa[Ba];this.$Dn(Hc,Ba);ic.equals(ie.a.nil)||this.NUf(ic,ub[0],!1)}}cUh(Ba){return this.Dvc[Ba]}QJc(Ba,ub,ic,Hc=!1){const Vb=[],Ud=this.cUh(Ba);if(!Ud)return Vb;for(let Cc=0;Cc<Ud.length;Cc++){const Te=Ud[Cc],Ne=this.OTa[Te];let Sf=!1;for(let Ie=Ne.length-1;0<=Ie;Ie--){const pg=Ne[Ie];if(Hc){if(pg.$aa&&pg.ip.paragraphId.equals(ie.a.Gf(Ba))){Sf=!0;Vb.push(pg);break}}else if(Object(dj.a)(zk,pg)?pg.ip.CFa===ub:pg.ip.CFa===ic){Sf=!0;pg.wac=!0;Vb.push(pg);this.OTa[Te]=Ne.splice(Ie,
Ne.length);break}}!Sf&&0<Ne.length&&Ne[0].wac&&Ne[0].ip.paragraphId.equals(ie.a.Gf(Ba))&&Vb.push(Ne[0])}return Vb}msl(Ba){if(!Ba||!Ba.Qa||!Ba.Qa.node)return null;Ba=this.QJc(Ba.Qa.node.id.toString(),0,0,!0);Ba=this.mZl(Ba);Ba.sort((ub,ic)=>{if(!(ub&&ub.userName&&ic&&ic.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Ba}mZl(Ba){if(!Ba||!Ba.length)return[];const ub=[],ic=new K.a(F.a.Ri());for(let Hc=0;Hc<Ba.length;Hc++){const Vb=
Ba[Hc].user;Vb.isAnonymous&&ic.contains(Vb.clientId)||!Vb.isAnonymous&&Vb.email&&ic.contains(Vb.email)||(ub.push(Vb),ic.add(Vb.isAnonymous?Vb.clientId:Vb.email))}return ub}NUf(Ba,ub,ic){this.raiseEvent("PPC",new Vm(Ba,ub,ic))}$Dn(Ba,ub){Array.remove(this.Dvc[Ba],ub)}}Lh.$wi=10;Lh.UZm=2;Object(l.a)(Lh,"PresenceDataManager",Ha.a,[1199]);class rk extends Lh{constructor(Ba){super();this.MG=Ba}VSe(Ba,ub=!1){super.VSe(Ba,ub)}NLc(Ba){return Ba.ip.Pc.toString()}cUh(Ba){Ba=this.MG.Db(ie.a.Gf(Ba));if(!Ba)return null;
Ba=Ba.ia(sg.a.Pc,0);return this.zdn[Ba.toString()]}}Object(l.a)(rk,"WordPresenceDataManager",Lh,[]);var Jj=c(1444),Rl=c(1035),cl=c(1815),Am=c(19);class fk{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak,nn,Sl,ql,Pj,tm,mi,Wl,Ah,yd,Jd,Se){this.pLa=Array(5);this.XPe=this._started=this.YKe=!1;this.AHe=null;this.l1g=new K.a(F.a.Ri());this.kmd={};this.Sze=!1;this.gdn=()=>{if(!this.XPe&&!this.ml.Zv){var be=new X.a(0,1,20,()=>{const el=new N.a;var fj=this.yab.lZk;for(var Hh in fj){const Fm=fj[Hh];Fm.ETc&&
el.add(Fm.pp.ip.paragraphId)}if(this.R_d){fj=this.yab.hCh;for(const Fm in fj)Hh=fj[Fm],Hh.ETc&&!el.contains(Hh.pp.ip.paragraphId)&&el.add(Hh.pp.ip.paragraphId)}this.nSh(el);this.XPe=!1},72);this.Gb.Xb(be);this.XPe=!0}};this.qEi=()=>{this.YKe&&(this.P0f(),this.YKe=!1)};this.S3=(be,el)=>{this.y3i(el.Ll.kb)};this.Q3=(be,el)=>{be=el.Tpa;for(var fj in be){const Hh=be[fj];this.Ma.$("CashTelemetryIsEnabled")&&this.KHc(Hh,new Date,null);Hh.ip?this.NSe(Hh):this.j0c(Hh.user.clientId)}el=el.LDd;for(fj=0;fj<
el.length;++fj)this.l2k(el[fj]);this.s8d()};this.PMf=(be,el)=>{el.paragraphId?this.eAo(el.paragraphId.toString(),el.QCm,this.kmd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.wNi=(be,el)=>{el.paragraphId&&(be=this.wC.Db(el.paragraphId))&&((Object(dj.a)(zk,el.presence)?this.ove(be):this.pve(be))===el.presence.ip.CFa&&this.zQn(el.paragraphId),this.R_d&&this.tkn(el))};this.Hv=Ba;this.ib=Hc;this.KC=Vb;this.Vub=Ud;this.ml=Ne;this.wKj=Sf;this.yab=Ie;this.wC=ic;this.rMg=pg;this.ove=ak;this.pve=
nn;this.MCj=Cc;this.AKj=Te;this.gKa=Sl;this.Dn=ql;this.Ic=Pj;this.Gb=tm;this.x8g=yd;this.i_j=Se;this.BHe=Wl;this.Ma=Ah;this.Qld=ub;fk.Tmd=new Gb.a;for(Ba=0;Ba<this.Qld.length;Ba++)this.Qld[Ba].xAn(this);this.Vub.Cfh(this.wNi);this.Hv.RXa(this.Q3);Jd&&this.ml.Gka(this.gdn);this.Hv.H7d(this)}get R_d(){return!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled")}s8d(Ba=!1){this.x8g&&!Ba||this.XWi()}XWi(){const Ba=new N.a,ub=this.kmd;for(const ic in ub)Ba.add(ie.a.Gf(ic));this.nSh(Ba);this.kmd={}}P0f(){this.ib.hb&&
this.y3i(this.ib.hb.kb,!0)}y3i(Ba,ub=!1){this.i_j||(this.wC.Jm.Jva||ub?Ba?(ub=this.gWk(Ba))?this.Hv.X0f(ub):(this.Hv.X0f(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ba.Qa.contextId)):this.Hv.X0f(null):this.YKe=!0)}gWk(Ba){if(!this.R_d||!Ba.bjb)if(Ba=Am.SelectionEditor.Vj(Ba,!0,!1),!Am.SelectionEditor.om(Ba))return null;return this.mnh(Ba)}mnh(Ba){const ub=Ba.Qa.cpBegin,ic=Ba.Qa.node.id;Ba=this.ove(Ba.Qa.node);return new xo(ic.toString(),ub,Ba)}KHc(Ba,ub,ic){if(this.BHe)if(Ba&&
Ba.user&&Ba.user.clientId){var Hc=Ba.user.clientId;this.l1g.contains(Hc)||(this.AHe?(this.AHe.KHc(Hc,ub,null,fk.iSl(ic||Ba.user.client)),this.l1g.add(Hc)):this.BHe.continueWith(()=>{this.AHe=this.BHe.result;this.KHc(Ba,ub,ic)}))}else k.ULS.sendTraceTag(42262876,302,15,"invalid presence")}xPl(Ba){const ub=new N.a;for(let ic=0;ic<Ba.length;ic++)ub.add(this.dZl(Ba[ic]));return ub}NSe(Ba){var ub=null;Ba&&Ba.user&&(ub=Ba.user.client);Ba=Ba.clone();Ba.user=this.KC.Yui(Ba.user.clientId)||Ba.user;this.Ma.$("CashTelemetryIsEnabled")&&
this.KHc(Ba,new Date,ub);Ba.isValid()&&!Ba.user.mX()&&(ub=Ba.user.clientId,fk.Tmd.ub(ub)||this.Q8h(ub),this.Tzo(ub),Ba.user.userName=CommonUIStrings.l_AnonymousUserName);this.Vub.VSe(Ba,!1)}Tzo(Ba){const {value:ub}=fk.Tmd.Gc(Ba,!1);ub||(fk.Tmd.Z(Ba,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ba+'" , "Event" : "CreateAnonymousGrayPawn"}'))}Q8h(){}j0c(Ba){this.Vub.BVi(Ba)}l2k(Ba){this.j0c(Ba);const ub=this.yab.mZh(Ba);ub&&(ub.eWi(this.PMf),ub.dispose());this.R_d&&(Ba=this.yab.MFl(Ba))&&
(Ba.eWi(this.PMf),Ba.dispose())}u5b(Ba){if(12!==Ba.type)return new N.a;Ba=this.Vub.QJc(Ba.id.toString(),this.ove(Ba),this.pve(Ba));return 0>=Ba.length?new N.a:this.xPl(Ba)}eAo(Ba,ub,ic){!ub&&Ba in ic&&delete ic[Ba]}dispose(){this.stop();this.Vub.NWi(this.wNi);this.Hv.TKb(this.Q3);this.Hv.Nbg(this);for(let Ba=0;Ba<this.Qld.length;Ba++)this.Qld[Ba].buo(this);le.a.I_f([this.MCj,this.AKj,this.Hv]);this.yab.H6k()}dZl(Ba){let ub=!1;Ba=({iie:ub}=this.yab.vPl(Ba)).returnValue;ub||Ba.oek(this.PMf);return Ba}b7h(Ba){Ba=
this.wC.Db(Ba);if(!Ba)return this.pLa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.pLa[0]=!0),null;if(!pd.ParagraphReader.ic(Ba))return this.pLa[1]||(k.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.pLa[1]=!0),null;if(!Ba.xe(this.ml.Sb))return this.pLa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.pLa[2]=!0),null;if(!Ba.anchor)return this.pLa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.pLa[3]=
!0),null;this.pLa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.pLa[4]=!0);return Ba}eVi(Ba){Ba=this.Vub.QJc(Ba.toString(),-1,-1,!0);if(!rf.a.kf(Ba))for(const ub of Ba)(Ba=this.yab.mZh(ub.user.clientId))&&Ba.element&&Ba.LE()}nSh(Ba){if(Ba.count){var ub=new N.a;for(var ic of Ba)(Ba=this.b7h(ic))?ub.add(Ba):this.eVi(ic);if(ub.count){ic=this.Ic.Qc(2);try{ic.set(this.Dn);for(const Hc of ub)this.EGh(Hc)}finally{ic&&ic.dispose()}}}}EGh(Ba){Ba.bG(this.ml.Sb,32,
!0);Ba.bG(this.wKj,32,!0)}zQn(Ba){this.kmd[Ba.toString()]=null;this.x8g&&!this.Sze&&(Ba=new X.a(0,1,200,()=>{this.Sze=!1;this.XWi()},70),this.Gb.Xb(Ba),this.Sze=!0)}tkn(Ba){if(Ba.presence.ip.shapeId&&!Ba.Qtf){var ub=this.yab.hCh[Ba.presence.ip.shapeId.toString()];ub&&ub.z4a(Ba.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.$ba(this.S3),this.rMg.EWi(this.qEi))}start(){if(!this._started){this._started=!0;this.ib.DA(this.S3);this.rMg.LTe(this.qEi);var Ba=this.Hv.RBb();delete Ba[this.gKa.clientId];
this.Q3(null,new cl.a(Ba,[]));this.P0f()}}zce(Ba){if(Ba&&Ba.isValid()&&Ba.ip){var ub=this.Vub.QJc(Ba.ip.paragraphId.toString(),-1,-1),ic=!1,Hc=null;for(let Vb=0;Vb<ub.length;Vb++)if(Hc=ub[Vb],Hc.user.clientId===Ba.user.clientId){ic=Hc.hSa=!0;break}if(ic)if(ub=Hc.ip.paragraphId,Ba=this.b7h(ub)){ub=this.Ic.Qc(2);try{ub.Eb(Ba),this.EGh(Ba)}finally{ub&&ub.dispose()}}else this.eVi(ub)}}static iSl(Ba){return Ba?Ba?1===Ba?1:2===Ba?2:0:2:0}}fk.Tmd=null;Object(l.a)(fk,"PresenceManager",null,[1195,9,119,1196,
1197,1198]);class cf{constructor(Ba,ub,ic,Hc){this.BRb=null;this._started=this.vye=!1;this.Wwb=null;this.joa=(Vb,Ud)=>{if(!v.AFrameworkApplication.Rk&&(Vb=this.Voj(Ud.Ll),this.BRb&&Vb)){Vb=this.dre.QJc(this.BRb.toString(),-1,-1,!0);for(Ud=0;Ud<Vb.length;Ud++)this.Wwb[Vb[Ud].user.clientId]=Vb[Ud];0>=Vb.length||(Vb=this.NSk(Vb),this.Lp.sendNotification(Vb,!0))}};this.dGi=(Vb,Ud)=>{this.ib.hb&&!v.AFrameworkApplication.Rk&&this.vye&&this.BRb&&this.BRb.equals(Ud.paragraphId)&&(Vb=null,!Ud.Qtf||Ud.presence.user.clientId in
this.Wwb?Ud.Qtf||(Vb=this.IAh(Ud.presence.user.userName,!1),delete this.Wwb[Ud.presence.user.clientId]):(Vb=this.IAh(Ud.presence.user.userName,!0),this.Wwb[Ud.presence.user.clientId]=Ud.presence),Vb&&this.Lp.sendNotification(Vb,!0))};this.pj=Hc;this.ib=ub;this.dre=Ba;this.Lp=ic;this.pj.H7d(this)}start(){this._started||(this._started=!0,this.Wwb={},this.dre.Cfh(this.dGi),this.ib.DA(this.joa),this.Voj(this.ib.hb))}stop(){this._started&&(this._started=!1,this.Wwb=null,this.dre.NWi(this.dGi),this.ib.$ba(this.joa))}NSk(Ba){if(1===
Ba.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Ba[0].user.userName);const ub=[],ic=Ba.length;for(let Hc=0;Hc<ic;Hc++)ub.push(Ba[Hc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,ub.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}IAh(Ba,ub){return String.format(ub?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ba)}dispose(){this.pj.Nbg(this);this.stop()}Voj(Ba){if(!Ba)return!1;
Ba=Ba.kb;if(!Ba)return!1;Ba=Ba.Qa;if(!Ba)return!1;this.vye=Am.SelectionEditor.pf(Ba);Ba=Ba.node.id;if(Ba.equals(this.BRb)||!this.vye)return!1;this.BRb=Ba;this.Wwb={};return!0}}Object(l.a)(cf,"PresenceAccessibilityManager",null,[9,119]);class ig{constructor(Ba,ub){this._started=!1;this.LJ=null;this.Rgd=!1;this.GWc=()=>{this._started&&this.i3i()};this.pj=Ba;ub&&(this.LJ=ub,this.LJ.KXa(this.GWc));this.pj.H7d(this)}start(){this._started||(this._started=!0,this.LJ?this.i3i():this.pj.vO(1,this.rzh()))}i3i(){const Ba=
this.Rgd;(this.Rgd=!!this.LJ.gz)&&!Ba&&this.pj.vO(1,this.rzh())}rzh(){const Ba={};Ba.Id="{"+v.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ba.HQ=!1;Ba.NT=1;Ba.WEB=!0;return Ba}stop(){this._started&&(this._started=this.Rgd=!1)}dispose(){this.pj.Nbg(this);this.LJ&&this.LJ.gWi(this.GWc)}}Object(l.a)(ig,"EditorsTableNotifier",null,[9,119]);var gk=c(395),wi=c(18);class pf extends fk{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak,nn,Sl,ql,Pj,tm,mi,Wl,Ah,yd,Jd,Se,be,el,fj,Hh,Fm,ri,Mh){super(Ba,
ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,ak,nn,Sl,ql,mi,Wl,Ah,yd,Jd,Se,be,el,Fm);this.Lk=null;this.p$k=Fi=>{const rp=!!this.Lk.oB.C4b(Fi);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Fi,rp)};this.o$k=(Fi,rp)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",rp,Fi)};this.Zga=()=>{v.AFrameworkApplication.Ce("5815j879;igh2e666");if(v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.EnabledWordRTCTokenRefresh",
!1)&&2===pf.pj.connectionState&&!wa.SessionStatusManager.instance.Uaa){const Fi={};Fi.qs=v.AFrameworkApplication.rootQuerySignature;pf.pj.Gob(Fi)}};pg.gb(wi.a.hao,bb.a.application,pf.Kbk,64);pg.gb(wi.a.sXf,bb.a.application,pf.sXf,64);pg.gb(wi.a.lUf,bb.a.application,pf.lUf,96);pg.gb(Fc.a.zce,bb.a.application,pf.gao,64);this.aI=Pj;this.ud=tm;this.ixb=fj;this.gKa.rdc=Hh;this.gKa.rdc.ngk(pf.eGi);ri.continueWith(()=>{this.Lk=ri.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");
(this.N1=Mh)&&this.N1.execute(Fi=>{Fi.PXa(this.Zga)})}kDa(Ba){if(!Ba||!Ba.anchor)return null;for(Ba=Ba.anchor.gr;Ba;Ba=Ba.cB)if(Ba.kEa)return Ba.Kr.node;return null}mnh(Ba){var ub=null;ub=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var ic=Ba.Qa.cpBegin,Hc=Ba.Qa.node;ub&&eh.ImageReader.Wu(Hc)&&(Hc=this.kDa(Hc));if(!Hc)return k.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Hc=this.pve(Hc);const Vb=Ba.Qa.node.ia(sg.a.Pc,0);if(!this.aI)return k.ULS.sendTraceTag(35997152,
302,15,"paragraphWordIdMapping is null"),null;var Ud=this.aI.value.Bgb(Vb);const Cc=pf.MG.Db(Ud);if(!Cc)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Ud),null;ic=this.ud.Bkc(this.ud.HQa(Cc.characterData,Cc.qa),ic);ic.sta=-1===Ba.Qa.Fb?0:Ba.Qa.Fb;Ud=0;ub&&Ba.bjb&&(Ud=this.OTl(Ba));return ub=new Af(this.aI.value,Vb,Hc,ic,this.ud,()=>pf.MG,this.ixb,Ud)}OTl(Ba){const ub=eh.ImageReader.cDa(Ba.Qa);return ub?ub.properties.ia(sg.a.KAb,0):Ba.Qa.node.properties.ia(sg.a.KAb,0)}Q8h(Ba){this.Lk&&
this.Lk.Nla&&this.Lk.Nla.qE(this.p$k,this.o$k,Ba)}dispose(){this.N1&&this.N1.execute(Ba=>{Ba.SKb(this.Zga)});super.dispose()}static get nu(){return Na.a.instance.resolve("Common.Utils.IAriaNotifier")}static GI(){return pf.Orc.task}static get_instance(){return pf.Smd.task}static CPl(){return pf.N0g.task}static get IRa(){return null!=pf.Lvg?pf.Lvg:pf.Lvg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){pf.Smd||(pf.Smd=new m.a);pf.KKg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),
pf.KKg=!1);if(sb.App.xa){var Ba=sb.App.xa.jb;Ba?(Ba.kea(pf.pWc),pf.Dub=Ba.wc,pf.Dub&&pf.Dub.mi?(pf.bN=Ba.Yc.contentReplicator,pf.bN?(pf.MG=Ba.Yc.Bd,pf.MG?pf.IRa.GI().continueWith(pf.C8m):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):k.ULS.sendTraceTag(4006598,
302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static C8m(){pf.pj=pf.IRa.GI().result;if(pf.pj){var Ba=[pf.Dub.AXc,pf.Dub.editingView.AXc],ub=xc.a.instance,ic=Na.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Hc=new cf(ic,ub,pf.nu,pf.pj),Vb=v.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?sb.App.yd.oB:null;Vb=new ig(pf.pj,Vb);var Ud=Na.a.instance.af("WordEditor.IParagraphWordIdMapping"),Cc=Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Te=Na.a.instance.resolve("Common.IPeopleInfoProvider");pf._instance=new pf(pf.pj,Ba,pf.MG,ub,Te,ic,Hc,Vb,pf.Dub,pf.Dub.editingView.Sb,Na.a.instance.resolve("Box4.Presence.PresenceControlProvider"),v.AFrameworkApplication.ya,
pf.bN,pd.ParagraphReader.textLength,pd.ParagraphReader.Ola,Na.a.instance.resolve("Box4.Presence.MyPresenceUser"),Ud,Cc,sb.App.kk.sl,new gk.a,Eb.a.instance,Jj.a.get_instance(),Ta.a.sq(Na.a.instance.Za("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),v.AFrameworkApplication.K,v.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),v.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Na.a.instance.resolve("Common.IPresenceStatusProvider"),
!sb.App.Fs&&!sb.App.Lm,sb.App.Lma(),Na.a.instance.Za("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");pf.Smd.Cg(pf._instance);pf.Orc.Cg(pf._instance);pf.N0g.Cg(pf._instance);Ba=Na.a.instance;Ba.ha("WordEditor.Presence.WordPresenceManager",()=>pf._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();Ba.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static pWc(Ba){pf._instance||
(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ba=Object(w.a)(11,Ba))&&Ba.Zlb(pf.pWc),pf.init())}static eGi(){pf._instance.P0f()}static Kbk(Ba,ub,ic,Hc,Vb){ic=Vb.split(",");if(!ic||3!==ic.length)return 8;Ba=ic[0].trim();ub=ic[1].trim();ic=Number.parseInvariant(ic[2].trim());Ba=new zk(new Qa(Ba),new xo(ub,ic,-1));if(!pf.Orc.task.isCompleted)return 8;ub=pf.GI().result;ub.NSe(Ba);ub.s8d();return 32}static sXf(Ba,ub,ic,Hc,Vb){if(!pf.Orc.task.isCompleted)return 8;
Ba=pf.GI().result;Ba.j0c(Vb);Ba.s8d();return 32}static gao(Ba,ub,ic,Hc,Vb){if(!pf.Orc.task.isCompleted)return 8;Ba=pf.GI().result;if(!Ba)return 8;Ba.zce(Vb);return 32}static lUf(Ba,ub,ic,Hc,Vb){if(1===ic)return 32;if(!pf.IRa.GI().isCompleted)return 8;Ba=pf.IRa.GI().result;if(!Ba)return k.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;Vb[Rl.a.Value]=2===Ba.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Ba.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}pf._instance=null;pf.KKg=!0;pf.Smd=new m.a;pf.Orc=new m.a;pf.N0g=new m.a;pf.MG=null;pf.Dub=null;pf.bN=null;pf.pj=null;Object(l.a)(pf,"WordPresenceManager",fk,[]);class wn{constructor(Ba){this.sa=new Ha.a;this.DY=Ba;this.DY.CWR(()=>this.DY.result.qek(()=>{this.sa.raiseEvent("X")}))}ngk(Ba){this.sa.addHandler("X",Ba)}eGn(Ba){this.sa.removeHandler("X",Ba)}getStatus(){return this.DY.isCompleted&&this.DY.result?this.DY.result.IFc.toString():"0"}}Object(l.a)(wn,"WordPresenceStatusProvider",
null,[748]);class Gh{constructor(Ba,ub,ic,Hc){this.pj=null;this.CKg=this.RCe=!1;this.D8m=()=>{this.XY.isCompleted&&this.XY.result?(this.pj=this.XY.result,this.pj.RXa(this.Q3),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.Q3=(Vb,Ud)=>{Vb=Ud.Tpa;for(const Cc in Vb)if(Ud=Vb[Cc],!this.RCe&&Ud.user.zQ&&Ud.user.zQ!==this.E1.zQ){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",
this.E1.zQ,Ud.user.zQ);this.RCe=!0;break}this.RCe&&this.pj.TKb(this.Q3);this.CKg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.CKg=!0)};this.Lk=Ba;this.E1=ub;this.XY=ic;ic.continueWith(this.D8m);this.gVj=Hc;this.gVj.ZBf=this.E1}}Object(l.a)(Gh,"WordPresenceUpdateMonitor",null,[]);var Gl=c(451),Jk=c(1498),Ei=c(228),bc=c(1817),oe=c(1818),Me=c(1700);class Ri{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc){this.sa=new Ha.a;this.QQg=this.GSg=this.SAe=this.nVg=!1;this.bQe=this.Ssd=0;this.mYb=null;
this.gKa=Ud;this.gKa.clientId=Ba.clientId;this.Vl=Ba;this.o9=ub;this.K9=Hc;this.xMj=Vb;this.Gb=ic;this.V8a=new Ei.a;this.jn=Cc;this.o9&&this.o9.continueWith(()=>{this.o9.yo||this.o9.Di||this.o9.result.teh(Object(e.a)(this,this.xCi,"onAmIAloneChanged"))})}get connectionState(){return this.Vl.connectionState}RXa(Ba){this.sa.addHandler("PU",Ba)}TKb(Ba){this.sa.removeHandler("PU",Ba)}Esa(Ba){this.sa.addHandler("CSC",Ba)}vec(Ba){this.sa.removeHandler("CSC",Ba)}IAc(Ba){this.sa.addHandler("PSU",Ba)}s0c(Ba){this.sa.removeHandler("PSU",
Ba)}hvd(Ba){this.sa.addHandler("PSC",Ba)}o8d(Ba){this.sa.removeHandler("PSC",Ba)}t3i(){}get clientId(){return this.Vl.clientId}f6(Ba){this.sa.addHandler("UN",Ba)}zec(Ba){this.sa.removeHandler("UN",Ba)}ycm(){this.mYb=Array(12);for(let Ba=0;12>Ba;Ba++)this.mYb[Ba]=0;this.GSg=this.jn?this.jn.$("UpdateNotificationTaskExperimentIsEnabled"):!0;v.AFrameworkApplication.rJ(()=>{this.pOm()})}init(){this.Vl.Esa(Object(e.a)(this,this.Tga,"onConnectionStateChanged"));this.Vl.RXa(Object(e.a)(this,this.Q3,"onPresenceUpdated"));
this.Vl.IAc(Object(e.a)(this,this.vQa,"onPersistentStateUpdated"));this.Vl.hvd(Object(e.a)(this,this.Wbc,"onPersistentStateCleared"));this.Vl.f6(Object(e.a)(this,this.Dba,"onUpdateNotificationReceived"));this.Rvh();this.ycm()}H7d(Ba){this.V8a.contains(Ba,(ub,ic)=>ub===ic)||(this.V8a.add(Ba),2===this.connectionState&&Ba.start())}Nbg(Ba){for(let ub=0;ub<this.V8a.length;ub++)if(this.V8a.J(ub)===Ba){this.V8a.FF(ub);break}}connect(){this.SAe||this.Vl.connect()}disconnect(){this.Vl.disconnect()}get E9d(){return this.Vl}DEh(Ba){return zk.Czb(Ba)}j1f(Ba,
ub){return(new zk(Ba,ub)).umf()}X0f(Ba){Ba&&Ba.isValid()&&!this.K9()?this.Vl.t3i(this.j1f(this.gKa.EKl(),Ba)):G.Task.X6(null)}Pfc(Ba,ub){return this.Vl.Pfc(Ba,ub)}PJc(Ba){return this.Vl.PJc(Ba)}SJc(){return this.Vl.SJc()}vO(Ba,ub,ic=!1){return this.Vl.vO(Ba,ub,ic)}RBb(){return this.izh(this.Vl.RBb())}Gob(Ba){if(v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.EnabledWordRTCTokenRefresh",!1)){const ub=new m.a;Me.a.getInstance().ZQi(Ba,ub);return ub.task}return G.Task.X6(null)}get UPa(){return this.Vl.UPa}Tga(Ba,
ub){2===ub.newState&&this.V8a.forEach(ic=>{ic.start();return!0});ub.newState||this.jn.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.SAe||this.V8a.forEach(ic=>{ic.stop();return!0});this.sa.raiseEvent("CSC",ub)}udf(Ba){return Ba.toLowerCase()}Q3(Ba,ub){if(!this.K9()){Ba=this.izh(ub.Tpa);ub=this.kzh(ub.LDd);var ic=new cl.a(Ba,ub);ub=new X.a(0,1,0,()=>{this.sa.raiseEvent("PU",ic)},57);this.Gb.Xb(ub)}}izh(Ba){const ub={};for(const Hc in Ba){var ic=Hc;const Vb=this.DEh(Ba[Hc]);Vb&&Vb.isValid()?
ub[this.udf(ic)]=Vb:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",ic)}return ub}kzh(Ba){const ub=Array(Ba.length);for(let ic=0;ic<Ba.length;ic++)ub[ic]=this.udf(Ba[ic]);return ub}vQa(Ba,ub){if(!this.K9()){var ic={};Ba=ub.Tpa;for(var Hc in Ba)ic[this.udf(Hc)]=Ba[Hc];Hc=new X.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new bc.a(ub.type,ic))},80);this.Gb.Xb(Hc)}}Wbc(Ba,ub){if(!this.K9()){Ba=this.kzh(ub.gzd);var ic=new oe.a(Ba);Ba=new X.a(0,1,0,()=>{this.sa.raiseEvent("PSC",ic)},81);this.Gb.Xb(Ba)}}Dba(Ba,
ub){this.GSg?this.ZHi(ub):(Ba=new X.a(0,1,0,()=>{this.ZHi(ub)},58),this.Gb.Xb(Ba))}ZHi(Ba){var ub=Date.now();this.sa.raiseEvent("UN",Ba);ub=Date.now()-ub;500<=ub&&(this.Ssd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Ba.type,ub),this.Sjl(Ba));this.bQe++}Sjl(Ba){0>Ba.type||21<=Ba.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Ba.type):this.mYb[Ba.type]++}pOm(){if(!this.QQg){var Ba=
{};Ba.TC=this.bQe;Ba.HRC=this.Ssd;this.mYb&&0<this.Ssd&&(Ba.TBC=this.mYb);this.Ssd=this.bQe=0;this.mYb=null;k.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Ba);this.QQg=!0}}dispose(){this.V8a=new Ei.a;this.Vl.vec(Object(e.a)(this,this.Tga,"onConnectionStateChanged"));this.Vl.TKb(Object(e.a)(this,this.Q3,"onPresenceUpdated"));this.Vl.s0c(Object(e.a)(this,this.vQa,"onPersistentStateUpdated"));this.Vl.o8d(Object(e.a)(this,this.Wbc,"onPersistentStateCleared"));this.Vl.zec(Object(e.a)(this,
this.Dba,"onUpdateNotificationReceived"));this.o9&&this.o9.continueWith(()=>{this.o9.yo||this.o9.Di||this.o9.result.gFn(Object(e.a)(this,this.xCi,"onAmIAloneChanged"))});this.Vl.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}xCi(){this.Rvh()}Rvh(){let Ba=!1;this.o9?this.o9.continueWith(()=>{this.o9.yo||this.o9.Di||(Ba=!this.o9.result.amIAlone);this.Vl.connectionState||!Ba&&!this.xMj()?2!==this.Vl.connectionState||Ba||(this.disconnect(),k.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.nVg&&Ba&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.nVg=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}FGc(){this.SAe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(l.a)(Ri,
"RtcProxy",null,[1178,9,860,1179]);class Rk extends Ri{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak){super(Ba,ub,ic,Hc,Vb,Ud,ak);this.Tda=null;this.aI=Cc;this.ud=Te;this.mKa=Ne;this.svc=Sf;this.PMe=Ie;this.ixb=pg}get qJ(){return this.Tda||(this.Tda=this.PMe())}Tga(Ba,ub){2===ub.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.tAo();super.Tga(Ba,ub)}tAo(){this.qJ&&this.qJ.oU("RtcConnectionStatusLabel")}DEh(Ba){return De.p4e(Fe(Ba),this.aI,this.ud,this.mKa,this.ixb)}j1f(Ba,ub){return Object(dj.a)(Af,
ub)?(Ba=new De(this.svc.$_h(),Ba,ub),Cf(Ba.umf())):super.j1f(Ba,ub)}}Object(l.a)(Rk,"WordRtcProxy",Ri,[]);class cg{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak){this.Op=new m.a;this.X5g=!0;this.je=ub;this.Gb=ic;this.K9=Hc;this.gKa=Vb;this.aI=Ud;this.ssa=Cc;this.mKa=Te;this.svc=Ne;this.PMe=Sf;this.N1=Ie;this.ixb=pg;this.Ma=ak}GI(){this.hqo();return this.Op.task}lLc(){return Gl.a.then(this.GI(),Ba=>Ba)}hqo(){if(this.X5g)if(this.X5g=!1,sb.App.oyf()&&sb.App.pwf()){var Ba=v.AFrameworkApplication.Ve;
if(Ba){Ba=Jk.RealtimeChannel.createInstance("{"+v.AFrameworkApplication.userSessionId+"}",v.AFrameworkApplication.userSessionId,v.AFrameworkApplication.i0i,Ba,this.N1,1,this.je,this.Ma.lb("RtcEndpointUrl"),void 0,void 0,null,this.Ma.$("FindSessionOnBootIsEnabled")?Na.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ma.lb("RtcBootToken"));var ub=this.Ma.$("RtcAlwaysOnEnabled"),ic=new Rk(Ba,ub?null:sb.App.Lma(),this.Gb,this.K9,cg.Bnl,this.gKa,this.aI,this.ssa,this.mKa,this.svc,this.PMe,this.ixb,
v.AFrameworkApplication.K);sb.App.v0n(ic);this.oAn(ic);ic.init();Yh.App.Q4a=ic;this.N1.execute(Hc=>{Hc.icb(()=>{ic.FGc()})});this.Op.Cg(ic)}else k.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}oAn(Ba){const ub=Na.a.instance;ub.ha("WordEditor.Presence.WordRtcProxy",()=>Ba).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();
ub.resolve("Common.IRealtimeChannelBasic")}static Bnl(){return!1}}Object(l.a)(cg,"WordRtcProxyProvider",null,[746,747]);class af{constructor(){this.W=null;this.El=!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");sb.App.Vtj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").GI(),pf.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));sb.App.xEc&&Sh.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");
if(af.DQg){const Ba=this.W.resolve("WordEditor.IMainViewModeManager");Ba.Jxb(this.TNf);af.yze=1===Ba.Tv}}dispose(){if(!this.El){this.El=!0;pf.GI().continueWith(()=>{le.a.kB(pf.GI().result)});var Ba=this.W.resolve("Box4.Presence.MyPresenceUser");Ba&&Ba.rdc&&Ba.rdc.eGn(pf.eGi)}}xc(Ba){this.W=Ba;this.W.ha("Box4.Presence.MyPresenceUser",()=>new Ja).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();Ba.ha("WordEditor.Presence.IWordPresenceCpFactory",
()=>new fh(Ba.resolve("Box4.CpConversionManagerImpl"),Ba.resolve("Box4.IContentControlReader"))).singleInstance();Ba.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Gh(new R.a(()=>sb.App.yd),xg.a.instance,Ba.resolve("WordEditor.Presence.WordRtcProxyProvider").lLc(),Ba.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Ba.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new cg(v.AFrameworkApplication.buildVersion,sb.App.xa.tq,Eb.a.instance,()=>v.AFrameworkApplication.Rk,Na.a.instance.resolve("Box4.Presence.IMyPresenceUser"),
Na.a.instance.Pa("WordEditor.ParagraphWordIdMapping"),Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>v.AFrameworkApplication.ta&&sb.App.xa.jb&&sb.App.xa.jb.Yc?sb.App.xa.jb.Yc.Bd:null,Yj.instance,()=>Na.a.instance.Pa("WordEditor.IStatusBarUser"),Na.a.instance.Za("Common.ISessionExpirationManager"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");
Ba.ha("Box4.Presence.PresenceControlProvider",()=>new fi(af.VXk(),dh.a.instance,Na.a.instance.Za("Common.IZoomManager"),Na.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ta.a.sq(Na.a.instance.Za("Common.ISystemInitiatedFeedbackWithTimeLapse")),v.AFrameworkApplication.K,Ba.resolve("Common.IPeopleInfoProvider"))).singleInstance();Ba.ha("Common.App.Presence.AwayManager",()=>new lj(Na.a.instance.resolve("Common.IPresenceUser"),Na.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").lLc(),pf.CPl(),
Na.a.instance.resolve("Common.IPresenceConverter"),Eb.a.instance,v.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:v.AFrameworkApplication.K.pc("AwayCoauthorThresholdMs",9E5),Object(e.a)(v.AFrameworkApplication.ya,v.AFrameworkApplication.ya.processAction,"processAction"),sb.App.xa.notificationBar,v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Ba.ha("WordEditor.Presence.WordPresenceStatusProvider",()=>new wn(Ta.a.sq(Na.a.instance.Za("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();
Ba.ha("Common.App.Presence.PeopleInfoProvider",()=>new cc(Ba.resolve("WordEditor.Presence.WordRtcProxyProvider").lLc(),sb.App.Lma().CWR(()=>sb.App.Lma().result.oB),Ba.resolve("Common.App.People.IPeopleColorUtils"),Ba.resolve("Common.IPresenceConverter"),Ta.a.sq(Ba.Za("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Ba.ha("Box4.Presence.WordPresenceDataManager",()=>new rk(sb.App.xa.jb.Yc.Bd)).as("Box4.IPresenceDataManager").singleInstance()}TNf(Ba,ub){sb.App.xa&&
sb.App.xa.vC&&(af.Lld=null,af.yze=1===ub.hbc)}static get XIi(){if(!af.Lld&&sb.App.xa&&sb.App.xa.vC){const Ba=Yh.App.Fn.vC;af.Lld=af.yze&&af.DQg?Ba.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Ba.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return af.Lld}static VXk(){const Ba=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),ub=v.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),ic=v.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),
Hc=new bd;Hc.add(tc.multipleBrowsersImageClassName,Kc.getImageClassWithCluster(v.AFrameworkApplication.mQ,"MoreUsersGlyph16"));Hc.add(tc.multipleBrowserImageClusterPath,v.AFrameworkApplication.Cr);Hc.add(tc.peopleImageClassName,Kc.getImageClassWithCluster(v.AFrameworkApplication.mQ,Ba?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Hc.add(tc.peopleImageClusterPath,v.AFrameworkApplication.Cr);Hc.add(tc.zIndex,1);Hc.add(tc.rtl,v.AFrameworkApplication.isRtl);Hc.add(tc.viewportBoundsCallback,
af.PZl);Hc.add(tc.ignoreEventOnExpandedTooltip,ub);Hc.add(tc.ipWidthAdjustForFlyout,ic);return Ba?new th(Hc):new Fl(Hc)}static PZl(){return af.XIi?zg.a.getElementBounds(af.XIi):null}}af.yze=!0;af.DQg=v.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");af.Lld=null;Object(l.a)(af,"WordPresencePackage",null,[1,2]);var Zi=c(1016),si=c(1373),eo=c(1021),lk=c(133);class cn{constructor(Ba,ub){this.OSe=Ba;this.paragraphId=ub}get opType(){return 2}get operation(){return this.OSe}}Object(l.a)(cn,
"RttAppliedAddParagraphOp",null,[148]);class Al{constructor(Ba,ub){this.oIn=Ba;this.paragraphId=ub}get opType(){return 6}get operation(){return this.oIn}}Object(l.a)(Al,"RttAppliedReplaceSymbolRangeOp",null,[148]);class Vc{constructor(Ba,ub){this.sIn=Ba;this.paragraphId=ub}get opType(){return 1}get operation(){return this.sIn}}Object(l.a)(Vc,"RttAppliedReplaceTextRangeOp",null,[148]);class Sk{constructor(Ba,ub,ic){this.Ldj=Ba;this.bde=ub;this.BFc=ic}get opType(){return 4}get operation(){return this.Ldj}get c8j(){return this.Ldj.t1b()?
this.BFc:this.bde}}Object(l.a)(Sk,"RttAppliedSplitParagraphOp",null,[148]);class ne{constructor(){this.R7a=new Gb.a}Pzf(Ba){return Ba.toString()}nAc(Ba,ub){Ba=this.Pzf(Ba);this.R7a.ub(Ba)||this.R7a.Z(Ba,new N.a);this.R7a.J(Ba).add(ub)}yMf(Ba){switch(Ba.opType){case 1:var ub=Object(w.a)(Vc,Ba);this.nAc(ub.paragraphId,Ba);break;case 6:ub=Object(w.a)(Al,Ba);this.nAc(ub.paragraphId,Ba);break;case 4:ub=Object(w.a)(Sk,Ba);this.nAc(ub.bde,Ba);this.nAc(ub.BFc,Ba);break;case 2:ub=Object(w.a)(cn,Ba),this.nAc(ub.paragraphId,
Ba)}}x4m(Ba){return this.Ckb(Ba)}Ckb(Ba){Ba=this.Pzf(Ba);if(!this.R7a.ub(Ba))return new N.a;const ub=this.R7a.J(Ba);this.R7a.remove(Ba);for(const ic of ub)ic.operation&&(ic.operation.j6=null);return ub}tMl(Ba){let ub;return({value:ub}=this.R7a.Gc(this.Pzf(Ba),ub)).returnValue?ub:new N.a}xrl(Ba){for(const ub of this.R7a.values){if(!ub.count)continue;if(2!==ub.J(0).opType)continue;const ic=ub.J(0);if(ic.OSe.xIf===Ba)return ic}return null}}Object(l.a)(ne,"RttAppliedOpTracker",null,[128]);var qi=c(234),
Wf;(function(Ba){Ba[Ba.Hel=0]="expired";Ba[Ba.zSo=1]="dried"})(Wf||(Wf={}));Object(l.b)("RemoveChangeReason",Wf);class Ak{constructor(){this.nya=new qi.a}P9j(Ba){if(!Ba)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const ub=Ba.Pc,ic=Ba.wj;this.nya.ub(ub)||this.nya.add(ub,new qi.a);this.nya.J(ub).Z(ic,Ba);return this.VZk(ub,ic)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",ub),this.nya.J(ub).remove(ic),
!1):!0}Fkf(Ba,ub){if(!this.nya.ub(Ba))return null;Ba=this.nya.J(Ba);return Ba.ub(ub)?Ba.J(ub):null}rLd(Ba){const ub=new N.a;for(const ic of this.nya.keys){const Hc=this.nya.J(ic);for(const Vb of Hc.keys){const Ud=Hc.J(Vb);Ba(Ud)&&ub.add(Ud)}}return ub}tVi(Ba,ub){let ic=null;({value:ic}=this.nya.Gc(Ba.Pc,ic)).returnValue?(Ba.activity.GKf(Wf[ub]),ic.remove(Ba.wj),ic.count||this.nya.remove(Ba.Pc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Ba.Pc,ub)}aXf(Ba){this.tVi(Ba,1)}dXf(Ba){this.tVi(Ba,0)}VZk(Ba,ub){if(!this.nya.ub(Ba))return!1;Ba=this.nya.J(Ba);if(!Ba.ub(ub))return!1;for(var ic=Ba.J(ub);ic;){ic=ic.h0;if(ic===ub)return!0;if(!Ba.ub(ic))break;ic=Ba.J(ic)}return!1}}Object(l.a)(Ak,"RttDataStore",null,[126,127]);var Qf=c(300),Tk=c(99),ff=c(295),vj=c(17);class jd{constructor(Ba,ub){this.R0d=(ic,Hc)=>{4===this.gq.opType?k.ULS.shipAssertTag(9204866,355,12===Hc.node.type||11===Hc.node.type,"Unexpected graph modification detected during RTT edit"):
k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Ckb=()=>{k.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.rEi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.gq=Ba;if(this.eq=ub)Ba=this.eq.Xe(12),Ba.mu(this.R0d),Ba.Mv(this.Ckb),Ba.Ap(this.rEi)}dispose(){if(this.eq){const Ba=this.eq.Xe(12);Ba.vU(this.R0d);Ba.yha(this.Ckb);Ba.YX(this.rEi)}}}Object(l.a)(jd,
"GraphChangeValidator",null,[9]);class Uk{constructor(Ba,ub,ic,Hc){this.id=Ba;this.cpBegin=ub;this.cpEnd=ic;this.qCk=Hc}eEo(Ba){var ub=this.id===Ba.id;ub&&(ub=this.qCk.replace("\u00a0"," "),Ba=Ba.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),ub=ub===Ba);return ub}}Object(l.a)(Uk,"RttOpValidator",null,[272]);class If{constructor(Ba,ub){this.j6=this.T6a=this.activity=null;this.opType=Ba;this.metadata=ub}rnf(){return""}serialize(){return null}}Object(l.a)(If,"RttOp",
null,[147]);class zf extends If{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){super(Ne,Te);this.Pc=Ba;this.wj=ub;this.KQ=ic;this.M3=Hc;this.h0=Vb;this.aob=Ud;this.hH=Cc}aBh(){return this.KQ.isEqual(this.M3,!0)?new ng.a(0,this.Pc,this.wj,this.KQ,void 0,void 0,void 0,this.hH):new ng.a(1,this.Pc,this.wj,this.KQ,this.Pc,this.wj,this.M3,this.hH)}static Qkj(Ba){let ub,ic;var Hc=Ba.vS;if(1===Hc.j7d&&(Hc.FQa!==Hc.wFa||Hc.f6a!==Hc.Aic))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
ic=ub=null,Ba=Hc=-1,{returnValue:!1,KQ:ic,M3:ub,Pc:Ba,wj:Hc};if(Hc.hH)return ic=ub=null,Ba=Hc=-1,{returnValue:!1,KQ:ic,M3:ub,Pc:Ba,wj:Hc};ub=ic=Hc.KQ;1===Hc.j7d&&(ub=Hc.M3);Ba=Hc.FQa;Hc=Hc.f6a;return{returnValue:!0,KQ:ic,M3:ub,Pc:Ba,wj:Hc}}}Object(l.a)(zf,"RttReplaceRangeOp",If,[]);var Wn=c(1371),Kh=c(411),ti=c(591);class jg extends ti.a{constructor(){super();this.RttStatusRecords=this.FileId=null}el(){return 110}static U$(Ba,ub){const ic=new jg;ic.FileId=Ba;ic.RttStatusRecords=ub;return ic}}Object(l.a)(jg,
"RttStatusRequest",ti.a,[]);class ej{}Object(l.a)(ej,"RttStatusOp",null,[]);class dl{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(dl,"WireRttStatusOpRecord",null,[]);class ui extends Kh.a{constructor(){super();const {App:Ba}=c(159);this.DWb=new N.a;this.dKe=new N.a;this.Zj=new Wn.a(v.AFrameworkApplication.K.pc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Ba.i0.register(this)}eAj(){const Ba=Date.now();for(const ub of this.DWb)ub.TIb&&1===ub.TIb&&(ub.TIb=2,ub.timeToRender=Ba-ub.metadata.z$f)}Cje(Ba){const ub=new ej;ub.metadata=Ba.operation.metadata;ub.opType=Ba.opType;ub.TIb=1;this.DWb.add(ub)}get aoa(){return"RttStatusReplicator"}f3(){return this.ge&&2===this.ge.status?!0:1===this.enabled&&this.Zj.aX()?this.ZB():!1}ZB(){for(const Ba of this.DWb)if(Ba.TIb&&2===Ba.TIb)return!0;return!1}uRa(){if(1===this._state){this._state=3;const ub=this.DWb.toArray().filter(ic=>
2===ic.TIb);var Ba=this.mSk(ub);Ba=jg.U$(v.AFrameworkApplication.rootQuerySignature,Ba);ub.forEach(ic=>this.DWb.remove(ic));ub.forEach(ic=>this.dKe.add(ic));this.ge.ks=Ba;this.ge.vH="RttStatusRequest";this.ge.status=1}else 3===this._state&&this.ge&&2===this.ge.status&&(this.Zj.x0(),2!==this.ge.statusCode&&this.DWb.VA(0,this.dKe),this.dKe.clear(),this._state=1)}mSk(Ba){const ub=[];Ba.forEach(ic=>{const Hc=new dl;Hc.clientId=ic.metadata.clientId;Hc.clientType=ic.metadata.clientType;Hc.packetId=ic.metadata.packetId;
Hc.packetVersion=ic.metadata.packetVersion;Hc.strictlySequentialId=ic.metadata.strictlySequentialId;Hc.contentType=ic.opType;Hc.contentState=ic.TIb;Hc.timeToRender=ic.timeToRender;ub.push(Hc)});return ub}Qgc(){return!0}qE(){}forceOutbound(){}}Object(l.a)(ui,"RttStatusReplicator",Kh.a,[]);class hb{constructor(Ba,ub,ic,Hc,Vb,Ud){this.packetId=Ba;this.clientId=ub;this.clientType=ic;this.z$f=Hc;this.packetVersion=Vb;this.strictlySequentialId=Ud}static create(Ba){let ub=null;null!=Ba.strictlySequentialId&&
(ub=Ba.strictlySequentialId);return new hb(Ba.packetId,Ba.clientId,Ba.client,Date.now(),Ba.version,ub)}}Object(l.a)(hb,"RttOpMetadata",null,[]);class Ab extends If{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne){super(4,Ne);this.h0=0;this.Pc=Ba;this.wj=ub;this.offset=ic;this.hH=Hc;this.tfg=Vb;this.i$f=Ud;this.eje=Cc;this.j$f=Te;this.tfg===this.Pc?this.h0=this.i$f:this.eje===this.Pc?this.h0=this.j$f:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.h0=0)}t1b(){return this.Pc===
this.eje}get jlo(){return this.h0}get xHo(){return this.t1b()?this.tfg:this.eje}get Bhj(){return this.t1b()?this.i$f:this.j$f}serialize(){const Ba=new ng.a(3,this.Pc,this.wj,this.offset,null,null,null,this.hH),ub=new cd(this.tfg,this.i$f,this.eje,this.j$f);return new yc(this.metadata.packetId,this.metadata.clientId,1,4,Ba,null,void 0,void 0,void 0,void 0,ub,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){const ub=Ba.vS,ic=Ba.iNb;return new Ab(ub.FQa,ub.f6a,ub.KQ,ub.hH,ic.$Of,ic.h$f,
ic.aPf,ic.k$f,hb.create(Ba))}static rSl(Ba,ub,ic){if(1!==Ba.type)return null;const Hc=ic.HQa(Ba.N3.characterData,Ba.N3.qa);return new Ab(Ba.N3.Pc,Ba.N3.wj,ic.Bkc(Hc,Ba.xdj),Ba.hH,Ba.mxb.Pc,Ba.mxb.wj,Ba.UBc.Pc,Ba.UBc.wj,ub)}}Object(l.a)(Ab,"RttSplitParagraphOp",If,[124,147]);class Qb{constructor(Ba,ub,ic,Hc){this.D0m=()=>{this.Gvb.eAj()};this.Zia=Ba;this.Puc=ub;this.yja=ic;this.xwb=Hc;null!=v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.Gvb=new ui,Qf.GraphTransactionManager.instance.seh(this.D0m))}pmk(Ba,ub,ic,Hc=null){if(ub.isDirty)return Hc&&Hc.properties.Z(Qb.lKi,"1"),!1;const Vb=new jd(Ba,ub.Wi);try{if(1===Ba.opType||6===Ba.opType){const Te=Object(w.a)(zf,Ba),Ne=this.fOk(Te,ub);var Ud=Ne.node.characterData;const Sf=10<=Ne.cpBegin?Ne.cpBegin-10:0;let Ie=Ne.cpEnd+10<=Ud.length?Ne.cpEnd+10:Ud.length;const pg=Ud.substr(Sf,Ne.cpBegin-Sf),ak=Ud.substr(Ne.cpEnd,Ie-Ne.cpEnd);Ie=Ie+Te.aob.length-(Ne.cpEnd-Ne.cpBegin);var Cc=
new Uk(Ne.node.id,Sf,Ie,pg+Te.aob+ak);const nn=6===Te.opType;Ud="";nn&&(Ud=Te.font);if(!this.YHn(Ne,Te.aob,nn,Ud,Hc))return!1;let Sl;Sl=1===Ba.opType?new Vc(Te,ub.id):new Al(Te,ub.id);ub.Ola=Ba.h0;Te.T6a=Cc;Ba.j6=Sl;ic.yMf(Sl);null!=this.Gvb&&this.Gvb.Cje(Sl)}else return 4===Ba.opType?this.omk(Ba,ub,ic):!1}finally{Vb&&Vb.dispose()}return!0}omk(Ba,ub,ic){const Hc=Object(w.a)(Ab,Ba);var Vb=this.xwb.HQa(ub.characterData,ub.qa);Vb=this.xwb.yzb(Vb,Hc.offset);if(!this.nni(lb.a.createTextRange(ub,0,pd.ParagraphReader.textLength(ub))))return!1;
var Ud=jh.GraphIterator.$a(ub);Ud.Ab(10);if(this.m9b(Ud))return!1;let Cc;Ud=this.yja.Qc(3);try{Ud.Eb(ub);const Te=ub.hY();try{const Ne=jh.GraphIterator.$a(ub);Ne.Ab(10);Ne.kd(11);let Sf=Ne.currentNode;Hc.t1b()&&(Ne.uvf?Sf=null:(Ne.MI(),Sf=Ne.currentNode));Ne.qc();const Ie=this.Puc.Izb();Ne.nH(Ie,Sf,89);Ne.Ii(Ie);Cc=ub.clone();const pg=Cc.hY();try{Cc.setValue(sg.a.Pc,Hc.xHo);Cc.setValue(sg.a.wj,Hc.Bhj);Cc.isDirty=!1;Ne.Qf(Cc,2);Ne.Ii(Cc);this.YPk(ub,Cc);const ak=Hc.t1b()?Cc:ub,nn=Hc.t1b()?ub:Cc;ak.DN=
!0;nn.DN=!0;this.Zia.FYf(this.fZa(ak,Vb,pd.ParagraphReader.textLength(ak)),"",!1,"");this.Zia.FYf(this.fZa(nn,0,Vb),"",!1,"");ub.Ola=Hc.jlo;Cc.Ola=Hc.Bhj}finally{pg&&pg.dispose()}}finally{Te&&Te.dispose()}Ud.RRa()}finally{Ud&&Ud.dispose()}ub=new Sk(Hc,ub.id,Cc.id);Ba.j6=ub;ic.yMf(ub);null!=this.Gvb&&this.Gvb.Cje(ub);return!0}m9b(Ba){const ub=new jh.GraphIterator;ub.ed(Ba);ub.kd(11);return Tk.ListReader.lj(ub)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}Wil(Ba,
ub,ic){var Hc=ub.Bgb(Ba.Pc);if(Hc.equals(ie.a.nil))return null;Hc=ic.Db(Hc);if(!Hc||!pd.ParagraphReader.ic(Hc)||!Hc.isConnected)return null;const Vb=jh.GraphIterator.$a(Hc);if(!Vb.Ab(23))return null;if(Ba.sfg){Ba=ub.Bgb(Ba.sfg);if(Ba.equals(ie.a.nil))return null;ic=ic.Db(Ba);if(!ic||!pd.ParagraphReader.ic(ic)||!ic.isConnected)return null;ic=jh.GraphIterator.$a(ic);if(!ic.Ab(23))return null;ic.kd(11);ic.MI();ic.Vd();if(ic.currentNode!==Hc)return null}return this.m9b(Vb)?null:Vb}cqo(Ba,ub,ic,Hc){const Vb=
ub.currentNode,Ud=this.yja.Qc(3);try{Ud.Eb(Vb);ub.kd(11);const Cc=ub.currentNode;ub.qc();const Te=this.Puc.Izb();ub.nH(Te,Cc,89);ub.Ii(Te);const Ne=ff.a.instance.createInstance(393230),Sf=Ne.hY();try{Ne.setValue(vj.a.Co,""),Ne.lEa=!0,Hc.PKb(Ne),Hc=[0],Ne.setValue(sg.a.Sq,Hc),Ne.setValue(sg.a.rt,Hc),Ne.lEa=!1,Ne.setValue(sg.a.Pc,Ba.xIf),Ne.setValue(sg.a.wj,Ba.wIf),Ne.isDirty=!1,ub.Qf(Ne,2),Ne.DN=!0,Ne.Ola=Ba.wIf}finally{Sf&&Sf.dispose()}Ud.RRa();Ba.j6=new cn(Ba,Ne.id);ic.yMf(Ba.j6);null!=this.Gvb&&
this.Gvb.Cje(Ba.j6)}finally{Ud&&Ud.dispose()}return!0}fZa(Ba,ub,ic){return ub===ic?lb.a.Uc(Ba,ub):lb.a.createTextRange(Ba,ub,ic)}YHn(Ba,ub,ic,Hc,Vb=null){const Ud=Ba.node;if(Ba.cpBegin!==Ba.cpEnd&&!this.nni(Ba))return Vb&&Vb.properties.Z(Qb.Pmj,"1"),!1;Vb=this.yja.Qc(3);try{Vb.Eb(Ud);const Cc=Ud.hY();try{Ud.DN=!0,this.Zia.FYf(Ba,ub,ic,Hc)}finally{Cc&&Cc.dispose()}Vb.RRa()}finally{Vb&&Vb.dispose()}return!0}YPk(Ba,ub){ub.lEa=!0;ub.vxa(Ba.characterData);ub.Ola=Ba.Ola;ub.qa.clear();for(var ic=0;ic<Ba.qa.length;ic++){const Hc=
Ba.qa.J(ic).ita(ub);ub.qa.add(Hc)}ub.Cn();if(ub.wordRunProperties.length)for(Ba=0;Ba<ub.qa.length;Ba++){if((ic=ub.qa.J(Ba).formatting)&&-1!==ic.Je)for(;ub.wordRunProperties.length<=ic.Je;)ub.wordRunProperties.WZ(ub.wordRunProperties.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");ub.lEa=!1}nzf(Ba){Ba=jh.GraphIterator.$a(Ba);Ba.Ab(23);Ba.qc();return{returnValue:89===Ba.role,iterator:Ba}}KXf(Ba){const ub=new jh.GraphIterator;ub.ed(Ba);
ub.qc();const ic=this.yja.Qc(3);try{ic.Eb(ub.currentNode),Ba.Jg()}finally{ic&&ic.dispose()}}CCn(Ba){if(Ba.anchor)if(({iterator:ub}=this.nzf(Ba)).returnValue)this.KXf(ub);else{var ub=Ba.Jc.Jm;var ic=this.yja.Qc(3);try{ic.Eb(Ba),Ba.load(ub.Db(Ba.id)),Ba.anchor.kX(4)}finally{ic&&ic.dispose()}}}a_f(Ba,ub,ic){for(let Ud=ub.count-1;0<=Ud;Ud--){var Hc=ub.J(Ud);switch(Hc.opType){case 4:Hc=Object(w.a)(Sk,Hc);if(!Ba.id.equals(Hc.bde)){k.ULS.shipAssertTag(9204885,355,Ba.id.equals(Hc.BFc));continue}Hc=ic.Db(Hc.BFc);
if(!Hc)break;if(!Hc||!pd.ParagraphReader.ic(Hc)){k.ULS.shipAssertTag(9204886,355,!1);break}if(!Hc.isConnected)continue;var Vb=({iterator:Hc}=this.nzf(Hc)).returnValue;k.ULS.shipAssertTag(9204887,355,Vb);Vb&&this.KXf(Hc);break;case 2:(Hc=Object(w.a)(cn,Hc),Ba.id.equals(Hc.paragraphId))?Ba.isConnected&&(Vb=({iterator:Hc}=this.nzf(Ba)).returnValue,k.ULS.shipAssertTag(16820002,355,Vb),Vb&&this.KXf(Hc)):k.ULS.shipAssertTag(16820001,355,!1)}}}fOk(Ba,ub){const ic=this.xwb.HQa(ub.characterData,ub.qa),Hc=
this.xwb.yzb(ic,Ba.KQ);Ba=this.xwb.yzb(ic,Ba.M3);return Hc===Ba?lb.a.Uc(ub,Hc):lb.a.createTextRange(ub,Hc,Ba)}nni(Ba){const ub=Ba.node.qa,ic=Ba.cpBegin;Ba=Ba.cpEnd;for(let Hc=0;Hc<ub.length;Hc++){const Vb=ub.J(Hc);if(Vb.cp>=Ba)break;if(Vb.cp>=ic){if(Vb.zf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(Vb.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(Vb.ff||Vb.Tib||Vb.y8b)return k.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Qb.lKi="ParagraphAlreadyDirty";Qb.Pmj="UnsafeWetChange";Object(l.a)(Qb,"RttEditor",null,[123]);var uc=c(15),Xc=c(1414),xd=c(250);class de{constructor(){this.c$c=new N.a}add(Ba){this.c$c.add(Ba);return!0}rLd(Ba){const ub=new N.a;for(const ic of this.c$c)Ba(ic)&&ub.add(ic);return ub}aXf(Ba){Ba.activity.GKf("dried");this.c$c.remove(Ba)}dXf(Ba){Ba.activity.GKf("expired");this.c$c.remove(Ba)}}Object(l.a)(de,"RttAddParagraphDataStore",
null,[]);class Dd extends If{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te){super(2,Te);this.Pc=Ba;this.wj=ub;this.h0=ic;this.sfg=Hc;this.xIf=Vb;this.wIf=Ud;this.hH=Cc}serialize(){const Ba=new ng.a(2,this.Pc,this.wj,null,this.sfg,null,null,this.hH),ub=new ac(this.h0,this.xIf,this.wIf);return new yc(this.metadata.packetId,this.metadata.clientId,1,3,Ba,null,void 0,void 0,ub,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){const ub=Ba.vS,ic=Ba.aZb;let Hc=null;null!=Ba.vS.wFa&&
(Hc=Ba.vS.wFa);return new Dd(ub.FQa,ub.f6a,ic.l$f,Hc,ic.cPf,ic.h0,ub.hH,hb.create(Ba))}static nSl(Ba,ub){return 3!==Ba.type?null:new Dd(Ba.eoa.Pc,Ba.eoa.wj,Ba.qXm.wj,Ba.mQa?Ba.mQa.Pc:null,Ba.fwa.Pc,Ba.fwa.wj,Ba.hH,ub)}}Object(l.a)(Dd,"RttAddParagraphOp",If,[]);class ee{constructor(Ba){this.XU=Ba}fSi(){this.XU&&this.XU.properties.Z(ee.iMh,"1")}tun(Ba){this.XU&&(this.XU.properties.ub(ee.PFf)||this.XU.properties.Z(ee.PFf,(Ba-this.XU.startTime).toString()))}GKf(Ba){this.XU&&(this.XU.properties.Z(ee.RWi,
Ba),this.XU.end())}Tvn(Ba){this.XU&&this.XU.properties.Z(ee.pJi,Ba.toString())}Svn(Ba){this.XU&&this.XU.properties.Z(ee.HIi,Ba)}static Urf(Ba){Ba.j4(wi.a.xLb,ee.iMh,Xc.a.Mfj);Ba.j4(wi.a.xLb,ee.Yfl,Xc.a.Mfj);Ba.j4(wi.a.xLb,ee.PFf,Xc.a.dqk);Ba.j4(wi.a.xLb,ee.RWi,Xc.a.xta);Ba.j4(wi.a.xLb,ee.pJi,Xc.a.xta);Ba.j4(wi.a.xLb,ee.HIi,Xc.a.xta)}static create(Ba){if(!Ba)return null;Ba=Ba.Xo(wi.a.xLb,ee.sGo);return new ee(Ba)}}ee.iMh="FailedToFindInitialParaID";ee.Yfl="FailedToFindInitialTextID";ee.PFf="MsecUntilApplied";
ee.RWi="RemovedBecause";ee.pJi="PacketVersions";ee.HIi="OperationType";ee.sGo=48E4;Object(l.a)(ee,"RttOpActivity",null,[]);var vf;(function(Ba){Ba[Ba.unknown=0]="unknown";Ba[Ba.dZo=1]="replaceTextRangeOp";Ba[Ba.$Po=2]="addParagraphOp";Ba[Ba.ZRo=3]="deleteParagraphOp";Ba[Ba.c0o=4]="splitParagraphOp";Ba[Ba.BWo=5]="mergeParagraphOp";Ba[Ba.cZo=6]="replaceSymbolRangeOp"})(vf||(vf={}));Object(l.b)("RttOpType",vf);var eg=c(140);class $b extends zf{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie){super(Hc,Vb,
Ud,Cc,Te,Ne,Sf,Ie,6);this.font=Ba;this.legacy=ub}rnf(){return"OffsetStart: "+this.KQ+"OffsetEnd: "+this.M3}serialize(){const Ba=this.aBh();return new yc(this.metadata.packetId,this.metadata.clientId,1,7,Ba,null,this.h0,this.aob,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){let ub,ic,Hc,Vb;if(!({KQ:ub,M3:ic,Pc:Hc,wj:Vb}=zf.Qkj(Ba)).returnValue)return null;let Ud,Cc;if(1===Ba.text.length)Ud=!1,Cc=eg.AParagraphNode.UB;else if(2===Ba.text.length)if(Va.a.Pji(Ba.text,
0)&&Va.a.az(Ba.text,1))Ud=!0,Cc=Ba.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Ba.qt),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ba.qt),null;const Te=Ba.h5c,Ne=hb.create(Ba);return new $b(Te.Q8f,Te.R8f,Ud,Hc,Vb,ub,ic,Ba.PNb,Cc,Ba.vS.hH,Ne)}}Object(l.a)($b,"RttReplaceSymbolRangeOp",zf,[124,147]);class Hd extends zf{constructor(Ba,ub,ic,Hc,
Vb,Ud,Cc,Te){super(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,1)}rnf(){return"OffsetStart: "+this.KQ+"OffsetEnd: "+this.M3+"TextAddedLength: "+this.aob.length}serialize(){const Ba=this.aBh();return new yc(this.metadata.packetId,this.metadata.clientId,1,2,Ba,null,this.h0,this.aob,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){let ub,ic,Hc,Vb;if(!({KQ:ub,M3:ic,Pc:Hc,wj:Vb}=zf.Qkj(Ba)).returnValue)return null;let Ud="";Ba.text&&(Ud=Ba.text);const Cc=hb.create(Ba);return new Hd(Hc,
Vb,ub,ic,Ba.PNb,Ud,Ba.vS.hH,Cc)}static mRl(Ba,ub,ic){if(Ba.type)return null;const Hc=ic.HQa(Ba.N3.characterData,Ba.N3.qa);return new Hd(Ba.N3.Pc,Ba.N3.wj,ic.Bkc(Hc,Ba.cpBegin),ic.Bkc(Hc,Ba.cpEnd),Ba.fwa.wj,Ba.gwa,Ba.hH,ub)}}Object(l.a)(Hd,"RttReplaceTextRangeOp",zf,[124,147]);class $f{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te,Ne,Sf,Ie,pg,ak,nn,Sl,ql,Pj,tm,mi,Wl){this.Vl=null;this.Tze=this.iah=!1;this.Wcd=!0;this.lYg=0;this.M4g=this.ZKe=this.O4g=this.L4g=this.N4g=this.q6g=!1;this.gNf=()=>{k.ULS.sendTraceTag(7685328,
355,50,"All prerequisite ready for RttManager");this.Vl=this.XY.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Vl.f6(this.Dba)};this.Dba=(Ah,yd)=>{if(3===yd.type||10===yd.type)if(10===yd.type)this.lYg="boolean"===typeof yd.FM?yd.FM?1:0:yd.FM;else if(this.MUb.value&&!this.MUb.value.dPd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(yd.FM){if(this.fwn(),(Ah=this.G2k(yd.FM))&&1!==Ah.metadata.clientType){this.ewn();if(this.Oo&&
!this.Oo.bba&&!uc.a.QOa&&!uc.a.aba&&(v.AFrameworkApplication.Ce("1i00j689;ba0dg262"),this.q6g&&!uc.a.QOa&&!uc.a.aba))return;if(2!==this.lYg)switch(this.Wcd&&(this.CWb.nSi(),this.Wcd=!1),this.iah||this.Acm(),Ah.opType){case 1:case 6:case 4:if(!({Bg:Ah}=this.Q9j(Ah)).returnValue)break;this.y8g?this.D1i(Ah):this.Vlj(Ah);break;case 2:this.Flc.add(Ah),this.Uci(Ah),this.y8g?this.D1i(ie.a.nil):this.Ulj(Ah)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Gel=()=>{const Ah=this.Ci.value;
if(Ah){var yd=this.sA()-$f.OCn,Jd=this.Tqb.rLd(be=>be.metadata.z$f<yd);0<Jd.count&&this.uun();var Se=new xd.a;for(const be of Jd)if(this.Tqb.dXf(be),be.j6)switch(be.j6.opType){case 1:Se.add(be.j6.paragraphId.toString());break;case 6:Se.add(be.j6.paragraphId.toString());break;case 4:Se.add(be.j6.bde.toString()),Se.add(be.j6.BFc.toString())}Jd=this.Flc.rLd(be=>be.metadata.z$f<yd);for(const be of Jd)this.Flc.dXf(be),be.j6&&Se.add(be.j6.paragraphId.toString());for(const be of Se)(Se=Ah.Db(ie.a.Gf(be)))?
Se.DN?(this.Fvb.CCn(Se),Se.DN||this.Etc.value.bWi(Se)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Ci.Ypf&&k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.Fvb=Ba;this.Tqb=ub;this.Etc=ic;this.MUb=Hc;this.aI=Vb;this.XY=Ud;this.Ci=Cc;this.Gb=Te;this.sA=Ne;this.xwb=Sf;this.rd=Ie;this.EHe=ak;this.Ic=nn;this.y8g=
Sl;this.CWb=ql;this.Rpb=Pj;this.iRe=tm;this.Evc=new K.a(F.a.Ri());this.Flc=new de;pg.execute($f.Urf);this.q6g=mi;this.Oo=Wl}Acm(){const Ba=new X.a(3,2,$f.OEn,this.Gel);this.Gb.Xb(Ba);this.iah=!0}init(){return this.XY?this.XY.continueWith(this.gNf):G.Task.X6(!1)}G2k(Ba){Ba=Fe(Ba);if(!Ba)return null;switch(Ba.qt){case 2:return Hd.create(Ba);case 7:return $b.create(Ba);case 4:return Ab.create(Ba);case 3:return Dd.create(Ba);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",
Ba.qt),null}}Q9j(Ba){let ub=ie.a.nil;if(!this.Tqb.P9j(Ba))return{returnValue:!1,Bg:ub};this.Uci(Ba);if(!this.aI)return{returnValue:!1,Bg:ub};const ic=this.aI.Bgb(Ba.Pc);if(ic.equals(ie.a.nil)||!this.Ci.value.Db(ic))return Ba.activity.fSi(),{returnValue:!1,Bg:ub};this.pSi();return{returnValue:!0,Bg:ic}}D1i(Ba){Ba.equals(ie.a.nil)||this.Evc.add(Ba.toString());this.Tze||(Ba=new X.a(0,1,200,()=>{this.Qro();this.Tze=!1},71),this.Gb.Xb(Ba),this.Tze=!0)}nQn(Ba){Ba=new X.a(0,1,0,Ba,71);this.Gb.Xb(Ba)}Uci(Ba){Ba.activity=
ee.create(this.rd);Ba.activity.Tvn(Ba.metadata.packetVersion);Ba.activity.Svn(vf[Ba.opType])}Qro(){var Ba=this.Flc.rLd(ic=>!ic.j6);for(const ic of Ba)this.Ulj(ic);if(this.Evc.count){Ba=null;for(var ub of this.Evc){ub=ie.a.Gf(ub);Ba=this.Ci.value.Db(ub);break}ub=this.Ic.Qc(3);try{ub.Eb(Ba);for(const ic of this.Evc)this.Vlj(ie.a.Gf(ic))}finally{ub&&ub.dispose()}this.Evc.clear()}}Vlj(Ba){Ba=this.Ci.value.Db(Ba);let ub;const ic=this.Ic.Qc(3);try{ic.Eb(Ba);ub=this.rd.Xo(wi.a.Lih);const Hc=this.Pih(Ba,
ub);ub.end();Hc&&this.Jbk(Hc)}finally{ic&&ic.dispose(),this.CWb.yVf(1),this.Wcd=!0}}Ulj(Ba){var ub=this.Fvb.Wil(Ba,this.aI,this.Ci.value);ub&&(this.pSi(),this.Fvb.cqo(Ba,ub,this.Rpb,Na.a.instance.resolve("Box4.IParagraphEditor"))&&(ub=this.Ci.value.Db(Ba.j6.paragraphId),this.ijh(ub,Ba),this.CWb.yVf(1),this.Wcd=!0))}Jbk(Ba){this.EHe.continueWith(()=>{if(1===Ba.opType){var ub=this.yPl(Ba);ub&&(this.EHe.result.NSe(ub),this.EHe.result.s8d(!0))}})}yPl(Ba){const ub=Ba.serialize();if(2!==ub.qt||ub.vS.wFa&&
ub.vS.FQa!==ub.vS.wFa)return null;const ic=Ba.KQ.clone();0<Ba.aob.length&&(ic.Ush(),ic.cp+=Ba.aob.length);ub.qt=0;ub.text=null;ub.vS.j7d=0;ub.vS.KQ=ic;ub.vS.f6a=ub.PNb;ub.vS.wFa=null;ub.vS.Aic=null;ub.vS.M3=null;ub.PNb=null;return De.p4e(ub,this.aI,this.xwb,()=>this.Ci.value,this.iRe.instance)}ijh(Ba,ub){return this.Etc.value?this.Etc.value.F8j(Ba,ub.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.Etc.value,
"Unable to apply wet changes as LockManager unavailable"),!1)}Oih(Ba,ub){this.Pih(Ba,ub)}Pih(Ba,ub){if(!Ba)return null;if(!Ba.anchor)return ub&&ub.properties.Z($f.NAi,"1"),null;if(!Ba.hasProperty(sg.a.Pc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Ba.hasProperty(sg.a.wj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Ba.hasProperty(sg.a.RFh)&&Ba.getValue(sg.a.RFh))return k.ULS.sendTraceTag(16815506,355,
50,"RTT edit disabled in paragraph"),null;const ic=Ba.getValue(sg.a.Pc);var Hc=Ba.Ola;ub&&(ub.properties.Z($f.oYm,Hc.toString()),ub.properties.Z($f.qYm,ic.toString()));Hc=this.Tqb.Fkf(ic,Hc);if(!Hc)return ub&&ub.properties.Z($f.BAi,"1"),null;if(!this.ijh(Ba,Hc))return ub&&ub.properties.Z($f.lyh,"1"),null;let Vb=0,Ud=null;for(;Hc;){if(!this.Fvb.pmk(Hc,Ba,this.Rpb,ub)){ub&&ub.properties.Z($f.htj,"1");break}Vb++;Hc.activity.tun(this.sA());Ud=Hc;Hc=Ba.Ola;Hc=this.Tqb.Fkf(ic,Hc)}0<Vb&&this.NRi();ub&&ub.properties.add($f.itj,
Vb.toString());return Ud}$7d(Ba){if(Ba.hasProperty(sg.a.Pc)&&Ba.hasProperty(sg.a.wj)){var ub=Ba.getValue(sg.a.Pc),ic=Ba.ia(sg.a.wj,0),Hc=this.rd.Xo(wi.a.gUi),Vb=this.Rpb.x4m(Ba.id);0<Vb.count&&(this.Fvb.a_f(Ba,Vb,this.Ci.value),this.kDn(Ba,Vb,ic));var Ud=this.Rpb.xrl(ub);if(Ud&&!Ba.id.equals(Ud.paragraphId)){const Cc=this.Ci.value;this.nQn(()=>{const Te=this.Rpb.Ckb(Ud.paragraphId),Ne=Cc.Db(Ud.paragraphId);k.ULS.shipAssertTag(16820032,355,!!Ne,"Could not find added graph node");Ne&&(this.Fvb.a_f(Ne,
Te,Cc),this.Flc.aXf(Ud.OSe))})}this.Tqb.Fkf(ub,ic)||this.Etc.value.bWi(Ba);this.Oih(Ba,Hc);Hc.end()}}kDn(Ba,ub,ic){let Hc=!1;for(let Ud=ub.count-1;0<=Ud;Ud--){var Vb=ub.J(Ud);switch(Vb.opType){case 1:case 6:case 4:Vb=Object(w.a)(124,Vb.operation);break;default:continue}Vb.h0===ic&&(Hc=!0,Vb.T6a&&!Vb.T6a.eEo(Ba)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",Vb.opType,
Vb.rnf(),Ba.id,Vb.T6a.id,Vb.T6a.cpBegin,Vb.T6a.cpEnd));Hc&&this.Tqb.aXf(Vb)}Hc&&this.NRi()}TWc(Ba){const ub=this.Rpb.Ckb(Ba.id);0<ub.count&&(2===ub.J(0).opType&&ub.removeAt(0),this.Fvb.a_f(Ba,ub,this.Ci.value))}Bbe(Ba){var ub=this.Rpb.tMl(Ba.id);for(const ic of ub)if(4===ic.opType&&(ub=Object(w.a)(Sk,ic),Ba.id.equals(ub.c8j)))return!0;return!1}fwn(){this.N4g||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.N4g=!0)}ewn(){this.L4g||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.L4g=!0)}pSi(){this.O4g||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.O4g=!0)}NRi(){this.ZKe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.ZKe=!0)}uun(){this.ZKe||this.M4g||(k.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.M4g=!0)}static Urf(Ba){const ub=[wi.a.Lih,wi.a.gUi];for(const ic of ub)Ba.j4(ic,$f.itj,Xc.a.xta),Ba.j4(ic,$f.BAi,Xc.a.xta),Ba.j4(ic,$f.NAi,Xc.a.xta),Ba.j4(ic,$f.lyh,Xc.a.xta),Ba.j4(ic,
$f.htj,Xc.a.xta),Ba.j4(ic,Qb.lKi,Xc.a.xta),Ba.j4(ic,Qb.Pmj,Xc.a.xta);ee.Urf(Ba)}}$f.OEn=6E4;$f.OCn=18E4;$f.itj="WetChangeCount";$f.BAi="NoChangesToApply";$f.NAi="NodeNotConnected";$f.lyh="CouldNotGetLock";$f.htj="WetChangeBlocked";$f.qYm="NodeWordId";$f.oYm="NodeTextId";Object(l.a)($f,"RttManager",null,[125]);class xi{constructor(Ba,ub){this.k0i=0;this.yj=Ba;this.iOn=ub}nSi(){this.k0i=this.yj()}yVf(Ba){const ub=this.yj()-this.k0i;0<=ub&&this.iOn.track(Math.round(ub),0===Ba?"CTB":"RTP")}}Object(l.a)(xi,
"RttPerfCounter",null,[121]);var Qe=c(1890);class Wm{constructor(){this.gxc=new Qe.a}qck(Ba,ub){this.gxc.back()&&ub&&this.gxc.back().sdb(Ba)||this.gxc.enqueue(Ba)}bLl(){return this.gxc.isEmpty?null:this.gxc.dequeue()}}Object(l.a)(Wm,"RttSendDataStore",null,[120]);class ph extends If{constructor(Ba,ub,ic,Hc){super(3,Hc);this.Pc=Ba;this.wj=ub;this.hH=ic}get h0(){return 0}serialize(){const Ba=new ng.a(4,this.Pc,this.wj,null,null,null,null,this.hH);return new yc(this.metadata.packetId,this.metadata.clientId,
1,5,Ba,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){const ub=Ba.vS;return new ph(ub.FQa,ub.f6a,ub.hH,hb.create(Ba))}static oSl(Ba,ub){return 4!==Ba.type?null:new ph(Ba.f2b.Pc,Ba.f2b.wj,Ba.hH,ub)}}Object(l.a)(ph,"RttDeleteParagraphOp",If,[124,147]);class mj extends If{constructor(Ba,ub,ic,Hc,Vb,Ud,Cc,Te){super(5,Te);this.rfg=Ba;this.Ahj=ub;this.wHo=ic;this.klo=Hc;this.hH=Vb;this.Xtj=Ud;this.Bic=Cc}get Pc(){return this.rfg}get wj(){return this.Ahj}get h0(){return this.rfg===
this.Xtj?this.Bic:0}serialize(){const Ba=new ng.a(5,this.rfg,this.Ahj,null,this.wHo,this.klo,null,this.hH),ub=new zc(this.Xtj,this.Bic);return new yc(this.metadata.packetId,this.metadata.clientId,1,6,Ba,null,void 0,void 0,void 0,ub,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ba){const ub=Ba.vS,ic=Ba.bVc;return new mj(ub.FQa,ub.f6a,ub.wFa,ub.Aic,ub.hH,ic.bPf,ic.Bic,hb.create(Ba))}static pSl(Ba,ub){return 2!==Ba.type?null:new mj(Ba.eoa.Pc,Ba.eoa.wj,Ba.mQa.Pc,Ba.mQa.wj,Ba.hH,
Ba.nZd.Pc,Ba.nZd.wj,ub)}}Object(l.a)(mj,"RttMergeParagraphOp",If,[124,147]);class Xn{constructor(Ba,ub,ic,Hc,Vb,Ud){this.Lxc=this.pj=null;this.wda=!1;this.$Oe=this.W8g=0;this.Vqd=this.g$g=!1;this.bKe=0;this.gNf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.pj=this.XY.result;this.pj.H7d(this)};this.PFi=(Cc,Te)=>{if(this.pj&&2===this.pj.connectionState&&(Cc=Te.ZF,Cc.length))if(Te.H$)100>this.$Oe&&(this.$Oe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",
Te.Lrk,this.W8g,this.$Oe));else{for(Te=0;Te<Cc.length;Te++)if(!this.Fym(Cc[Te]))return;for(Te=0;Te<Cc.length;Te++){const Ne=Cc[Te];this.N3g.qck(Ne,!Ne.type&&!Te)}this.Lxc||this.uFi(this.Lxc,this.pj)}};this.XY=Ba;this.N3g=ub;this.VJa=ic;this.Ht=Hc;this.ssa=Vb;this.CWb=Ud}get wo(){return this.VJa.value}init(){return this.XY?this.XY.continueWith(this.gNf):G.Task.X6(!1)}start(){this.wda||(this.Ht.Yc?(this.Ht.Yc.ZF.hgk(this.PFi),this.wda=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.wda&&
(this.wda=!1,this.Ht.Yc.ZF.aGn(this.PFi))}Fym(Ba){return Ba&&-1!==Ba.hH?Ba.type&&3!==Ba.type&&1!==Ba.type?!1:!0:!1}mNm(){this.Vqd||(this.g$g||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.g$g=!0),!this.Vqd&&5>=this.bKe&&this.bKe++)}CNm(){!this.Vqd&&5>=this.bKe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.Vqd=!0)}uFi(Ba,ub){this.mNm();Ba&&(Ba.Di||Ba.yo)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Ba.exception);this.CWb.nSi();
(Ba=this.qSl(this.N3g.bLl()))?(this.W8g++,this.Lxc=ub.vO(3,Cf(Ba.serialize())),this.CNm(),this.CWb.yVf(0),this.Lxc.continueWith(ic=>{this.uFi(ic,ub)})):this.Lxc=null}qSl(Ba){if(!Ba)return null;if(!this.wo)return k.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const ub=new hb(Yj.instance.$_h(),this.wo.mj,1,0,0,xe.instance.oLl());let ic=null;switch(Ba.type){case 0:ic=Hd.mRl(Ba,ub,this.ssa);break;case 4:ic=ph.oSl(Ba,ub);break;case 3:ic=
Dd.nSl(Ba,ub);break;case 2:ic=mj.pSl(Ba,ub);break;case 1:ic=Ab.rSl(Ba,ub,this.ssa)}return ic}}Object(l.a)(Xn,"RttSendManager",null,[119]);class mf{constructor(){this.W=null;this.dJl=()=>sb.App.yd&&sb.App.yd.Vq?sb.App.yd.Vq:(k.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}xc(Ba){const ub=Ta.a.sq(Ba.Za("Box4.IOutlineElementEditor")),ic=Ta.a.sq(Ba.Za("Box4.IFeatureHelper")),Hc=Ta.a.sq(Ba.Za("Common.IActivityAggregationInfo")),Vb=
Ta.a.sq(Ba.Za("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Ud=Ta.a.sq(Ba.Za("Box4.CompositionStateManager"));this.W=Ba;const Cc=new gk.a;G.Task.WAA.call(null,ub,ic,Hc,Vb,Ud).continueWith(()=>{Ba.ha("WordEditor.RealTimeTyping.IRttEditor",()=>new Qb(Ba.resolve("Box4.ICharacterPropertiesEditor"),Ba.resolve("Box4.IOutlineElementEditor"),Cc,Ba.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Ba.register(xi,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Xd(()=>
new xi(zg.a.Ye,Zi.a.sE(17,1,new si.a(new eo.a(.25)))));Ba.ha("WordEditor.RealTimeTyping.RttManager",()=>new $f(Ba.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Ak(lk.a.instance),new R.a(this.dJl),new R.a(()=>sb.App.j0),Ba.resolve("WordEditor.ParagraphWordIdMapping"),Ba.resolve("Box4.Presence.IRtcProxyProvider").GI(),new R.a(()=>sb.App.xa.jb&&sb.App.xa.jb.Yc?sb.App.xa.jb.Yc.Bd:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Eb.a.instance,()=>Date.now(),Ba.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
lk.a.instance,Ba.Za("Common.IActivityAggregationInfo"),pf.GI(),Cc,v.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Ba.resolve("WordEditor.IRttPerfCounter"),new ne,Ba.Za("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.SkipUpdateGraphWhenComposing",!1),Ba.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Ba.ha("WordEditor.RealTimeTyping.RttSendManager",
()=>new Xn(Ba.resolve("Box4.Presence.IRtcProxyProvider").GI(),new Wm,new R.a(()=>sb.App.yd),sb.App.xa.jb,Ba.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ba.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.Vrf()})}Vrf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){na.a.instance.Kc(new mf)}}Object(l.a)(mf,"WordEditorRealTimeTypingPackage",null,
[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");Fa.main();Type.registerNamespace("Common.App.CollabControls");Qa.prototype.toString=fa.a.prototype.toString;Ja.prototype.toString=fa.a.prototype.toString;
na.a.instance.Kc(new af);mf.main();Type.registerNamespace("RealtimePresenceUI");na.a.instance.Kc(new Je);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");sa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/18198024/wdjs/WordEditorDS.collab.js.map